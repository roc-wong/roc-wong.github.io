<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>fly high</title>
  <subtitle>九万里风鹏正举</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://roc-wong.github.io/"/>
  <updated>2018-01-11T02:04:24.472Z</updated>
  <id>https://roc-wong.github.io/</id>
  
  <author>
    <name>roc</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>极光推送java-sdk-V3.2.15堵塞BUG</title>
    <link href="https://roc-wong.github.io/blog/2018/01/%E6%9E%81%E5%85%89%E6%8E%A8%E9%80%81java-sdk-V3-2-15%E5%A0%B5%E5%A1%9EBUG.html"/>
    <id>https://roc-wong.github.io/blog/2018/01/极光推送java-sdk-V3-2-15堵塞BUG.html</id>
    <published>2018-01-11T01:36:56.000Z</published>
    <updated>2018-01-11T02:04:24.472Z</updated>
    
    <content type="html"><![CDATA[<h2 id="案发现场"><a href="#案发现场" class="headerlink" title="案发现场"></a>案发现场</h2><ul>
<li>从RabbitMQ Server端获取消息的线程运行正常，读到数据后放到本地的BlockQueue中，等待消费者线程消费。</li>
<li>消费者线程堵塞，不再消费本地BlockQueue中的消息。</li>
<li>使用jstack进行Thread Dump分析。由于自定义消费者线程名称，所以直接筛选前缀为MessageConsumer线程，结果如下：</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="string">"MessageConsumer-1"</span> prio=<span class="number">10</span> tid=<span class="number">0</span>x00007f39309f6000 nid=<span class="number">0</span>x1047 waiting on condition [<span class="number">0</span>x00007f39052d3000]</div><div class="line">   java<span class="selector-class">.lang</span><span class="selector-class">.Thread</span><span class="selector-class">.State</span>: WAITING (parking)</div><div class="line">	at sun<span class="selector-class">.misc</span><span class="selector-class">.Unsafe</span><span class="selector-class">.park</span>(Native Method)</div><div class="line">	- parking to wait <span class="keyword">for</span>  &lt;<span class="number">0</span>x00000000a4b994d0&gt; (<span class="selector-tag">a</span> java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.CountDownLatch</span><span class="variable">$Sync</span>)</div><div class="line">	at java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.locks</span><span class="selector-class">.LockSupport</span><span class="selector-class">.park</span>(LockSupport<span class="selector-class">.java</span>:<span class="number">186</span>)</div><div class="line">	at java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.locks</span><span class="selector-class">.AbstractQueuedSynchronizer</span><span class="selector-class">.parkAndCheckInterrupt</span>(AbstractQueuedSynchronizer<span class="selector-class">.java</span>:<span class="number">834</span>)</div><div class="line">	at java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.locks</span><span class="selector-class">.AbstractQueuedSynchronizer</span><span class="selector-class">.doAcquireSharedInterruptibly</span>(AbstractQueuedSynchronizer<span class="selector-class">.java</span>:<span class="number">994</span>)</div><div class="line">	at java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.locks</span><span class="selector-class">.AbstractQueuedSynchronizer</span><span class="selector-class">.acquireSharedInterruptibly</span>(AbstractQueuedSynchronizer<span class="selector-class">.java</span>:<span class="number">1303</span>)</div><div class="line">	at java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.CountDownLatch</span><span class="selector-class">.await</span>(CountDownLatch<span class="selector-class">.java</span>:<span class="number">236</span>)</div><div class="line">	at cn<span class="selector-class">.jiguang</span><span class="selector-class">.common</span><span class="selector-class">.connection</span><span class="selector-class">.NettyHttpClient</span><span class="selector-class">.sendHttpRequest</span>(NettyHttpClient<span class="selector-class">.java</span>:<span class="number">193</span>)</div><div class="line">	at cn<span class="selector-class">.jiguang</span><span class="selector-class">.common</span><span class="selector-class">.connection</span><span class="selector-class">.NettyHttpClient</span><span class="selector-class">.sendPost</span>(NettyHttpClient<span class="selector-class">.java</span>:<span class="number">134</span>)</div><div class="line">	at cn<span class="selector-class">.jpush</span><span class="selector-class">.api</span><span class="selector-class">.push</span><span class="selector-class">.PushClient</span><span class="selector-class">.sendPush</span>(PushClient<span class="selector-class">.java</span>:<span class="number">194</span>)</div><div class="line">	at cn<span class="selector-class">.jpush</span><span class="selector-class">.api</span><span class="selector-class">.JPushClient</span><span class="selector-class">.sendPush</span>(JPushClient<span class="selector-class">.java</span>:<span class="number">205</span>)</div><div class="line">	at hbec<span class="selector-class">.app</span><span class="selector-class">.platform</span><span class="selector-class">.push</span><span class="selector-class">.service</span><span class="selector-class">.impl</span><span class="selector-class">.JPushService</span><span class="selector-class">.push</span>(JPushService<span class="selector-class">.java</span>:<span class="number">66</span>)</div><div class="line">	at hbec<span class="selector-class">.app</span><span class="selector-class">.platform</span><span class="selector-class">.push</span><span class="selector-class">.service</span><span class="selector-class">.impl</span><span class="selector-class">.PushFacadeService</span><span class="selector-class">.jpush</span>(PushFacadeService<span class="selector-class">.java</span>:<span class="number">113</span>)</div><div class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeMethodAccessorImpl</span><span class="selector-class">.invoke0</span>(Native Method)</div><div class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeMethodAccessorImpl</span><span class="selector-class">.invoke</span>(NativeMethodAccessorImpl<span class="selector-class">.java</span>:<span class="number">57</span>)</div><div class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.DelegatingMethodAccessorImpl</span><span class="selector-class">.invoke</span>(DelegatingMethodAccessorImpl<span class="selector-class">.java</span>:<span class="number">43</span>)</div><div class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Method</span><span class="selector-class">.invoke</span>(Method<span class="selector-class">.java</span>:<span class="number">606</span>)</div><div class="line">	at hbec<span class="selector-class">.app</span><span class="selector-class">.mc</span><span class="selector-class">.RpcService</span><span class="selector-class">.send</span>(RpcService<span class="selector-class">.java</span>:<span class="number">38</span>)</div><div class="line">	at hbec<span class="selector-class">.app</span><span class="selector-class">.mc</span><span class="selector-class">.NotifySendService</span><span class="selector-class">.send</span>(NotifySendService<span class="selector-class">.java</span>:<span class="number">40</span>)</div><div class="line">	at hbec<span class="selector-class">.app</span><span class="selector-class">.mc</span><span class="selector-class">.NotifyService</span><span class="selector-class">.notifyPerson</span>(NotifyService<span class="selector-class">.java</span>:<span class="number">151</span>)</div><div class="line">	at hbec<span class="selector-class">.app</span><span class="selector-class">.mc</span><span class="selector-class">.NotifyService</span><span class="selector-class">.notify</span>(NotifyService<span class="selector-class">.java</span>:<span class="number">83</span>)</div><div class="line">	at hbec<span class="selector-class">.app</span><span class="selector-class">.mc</span><span class="selector-class">.rabbitmq</span><span class="selector-class">.RealTimeConsumer</span><span class="selector-class">.onMessage</span>(RealTimeConsumer<span class="selector-class">.java</span>:<span class="number">29</span>)</div><div class="line">	at org<span class="selector-class">.springframework</span><span class="selector-class">.amqp</span><span class="selector-class">.rabbit</span><span class="selector-class">.listener</span><span class="selector-class">.adapter</span><span class="selector-class">.MessageListenerAdapter</span><span class="selector-class">.onMessage</span>(MessageListenerAdapter<span class="selector-class">.java</span>:<span class="number">273</span>)</div><div class="line">	at org<span class="selector-class">.springframework</span><span class="selector-class">.amqp</span><span class="selector-class">.rabbit</span><span class="selector-class">.listener</span><span class="selector-class">.AbstractMessageListenerContainer</span><span class="selector-class">.doInvokeListener</span>(AbstractMessageListenerContainer<span class="selector-class">.java</span>:<span class="number">848</span>)</div><div class="line">	at org<span class="selector-class">.springframework</span><span class="selector-class">.amqp</span><span class="selector-class">.rabbit</span><span class="selector-class">.listener</span><span class="selector-class">.AbstractMessageListenerContainer</span><span class="selector-class">.invokeListener</span>(AbstractMessageListenerContainer<span class="selector-class">.java</span>:<span class="number">771</span>)</div><div class="line">	at org<span class="selector-class">.springframework</span><span class="selector-class">.amqp</span><span class="selector-class">.rabbit</span><span class="selector-class">.listener</span><span class="selector-class">.SimpleMessageListenerContainer</span><span class="selector-class">.access</span>$<span class="number">001</span>(SimpleMessageListenerContainer<span class="selector-class">.java</span>:<span class="number">102</span>)</div><div class="line">	at org<span class="selector-class">.springframework</span><span class="selector-class">.amqp</span><span class="selector-class">.rabbit</span><span class="selector-class">.listener</span><span class="selector-class">.SimpleMessageListenerContainer</span>$<span class="number">1</span>.invokeListener(SimpleMessageListenerContainer<span class="selector-class">.java</span>:<span class="number">198</span>)</div><div class="line">	at org<span class="selector-class">.springframework</span><span class="selector-class">.amqp</span><span class="selector-class">.rabbit</span><span class="selector-class">.listener</span><span class="selector-class">.SimpleMessageListenerContainer</span><span class="selector-class">.invokeListener</span>(SimpleMessageListenerContainer<span class="selector-class">.java</span>:<span class="number">1311</span>)</div><div class="line">	at org<span class="selector-class">.springframework</span><span class="selector-class">.amqp</span><span class="selector-class">.rabbit</span><span class="selector-class">.listener</span><span class="selector-class">.AbstractMessageListenerContainer</span><span class="selector-class">.executeListener</span>(AbstractMessageListenerContainer<span class="selector-class">.java</span>:<span class="number">752</span>)</div><div class="line">	at org<span class="selector-class">.springframework</span><span class="selector-class">.amqp</span><span class="selector-class">.rabbit</span><span class="selector-class">.listener</span><span class="selector-class">.SimpleMessageListenerContainer</span><span class="selector-class">.doReceiveAndExecute</span>(SimpleMessageListenerContainer<span class="selector-class">.java</span>:<span class="number">1254</span>)</div><div class="line">	at org<span class="selector-class">.springframework</span><span class="selector-class">.amqp</span><span class="selector-class">.rabbit</span><span class="selector-class">.listener</span><span class="selector-class">.SimpleMessageListenerContainer</span><span class="selector-class">.receiveAndExecute</span>(SimpleMessageListenerContainer<span class="selector-class">.java</span>:<span class="number">1224</span>)</div><div class="line">	at org<span class="selector-class">.springframework</span><span class="selector-class">.amqp</span><span class="selector-class">.rabbit</span><span class="selector-class">.listener</span><span class="selector-class">.SimpleMessageListenerContainer</span><span class="selector-class">.access</span>$<span class="number">1600</span>(SimpleMessageListenerContainer<span class="selector-class">.java</span>:<span class="number">102</span>)</div><div class="line">	at org<span class="selector-class">.springframework</span><span class="selector-class">.amqp</span><span class="selector-class">.rabbit</span><span class="selector-class">.listener</span><span class="selector-class">.SimpleMessageListenerContainer</span><span class="variable">$AsyncMessageProcessingConsumer</span>.run(SimpleMessageListenerContainer<span class="selector-class">.java</span>:<span class="number">1470</span>)</div><div class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.Thread</span><span class="selector-class">.run</span>(Thread<span class="selector-class">.java</span>:<span class="number">745</span>)</div><div class="line"></div><div class="line">   Locked ownable synchronizers:</div><div class="line">	- None</div><div class="line">……</div></pre></td></tr></table></figure>
<p>从上可以发现，消费者线程大都处于WAITING状态，线程阻塞在NettyHttpClient.sendHttpRequest的CountDownLatch.await()方法。<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">at java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.CountDownLatch</span><span class="selector-class">.await</span>(CountDownLatch<span class="selector-class">.java</span>:<span class="number">236</span>)</div><div class="line">at cn<span class="selector-class">.jiguang</span><span class="selector-class">.common</span><span class="selector-class">.connection</span><span class="selector-class">.NettyHttpClient</span><span class="selector-class">.sendHttpRequest</span>(NettyHttpClient<span class="selector-class">.java</span>:<span class="number">193</span>)</div></pre></td></tr></table></figure></p>
<p>##预测案件</p>
<p>通过对应用中各线程运行的状态情况，推测是极光推送SDK代码BUG导致。深入源码进行问题排查：</p>
<ul>
<li><p>1&gt; cn.jpush.api.JPushClient.java</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function">PushResult <span class="title">sendPush</span><span class="params">(PushPayload pushPayload)</span> <span class="keyword">throws</span> APIConnectionException, APIRequestException </span>&#123;</div><div class="line">	    <span class="function"><span class="keyword">return</span> _pushClient.<span class="title">sendPush</span><span class="params">(pushPayload)</span></span>;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>2&gt; cn.jpush.api.push.PushClient.java</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public PushResult sendPush(PushPayload pushPayload) throws APIConnectionException, APIRequestException &#123;</div><div class="line">        Preconditions.checkArgument(! (null == pushPayload), <span class="string">"pushPayload should not be null"</span>);</div><div class="line">        <span class="keyword">if</span> (<span class="variable">_apnsProduction</span> &gt; <span class="number">0</span>) &#123;</div><div class="line">            pushPayload.resetOptionsApnsProduction(<span class="literal">true</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">_apnsProduction</span> == <span class="number">0</span>) &#123;</div><div class="line">            pushPayload.resetOptionsApnsProduction(<span class="literal">false</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (<span class="variable">_timeToLive</span> &gt;= <span class="number">0</span>) &#123;</div><div class="line">            pushPayload.resetOptionsTimeToLive(<span class="variable">_timeToLive</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//该版本默认使用NettyHttpClient，进入源码</span></div><div class="line">        ResponseWrapper response = <span class="variable">_httpClient</span>.sendPost(<span class="variable">_baseUrl</span> + <span class="variable">_pushPath</span>, pushPayload.<span class="built_in">toString</span>());</div><div class="line">        return BaseResult.fromResponse(response, PushResult.class);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>3&gt; cn.jiguang.common.connection.NettyHttpClient.java</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">    <span class="keyword">public</span> ResponseWrapper sendPost(<span class="keyword">String</span> url, <span class="keyword">String</span> content) throws APIConnectionException, APIRequestException &#123;</div><div class="line">        ResponseWrapper wrapper = <span class="keyword">new</span> <span class="type">ResponseWrapper</span>();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> sendHttpRequest(HttpMethod.POST, url, content);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> wrapper;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> ResponseWrapper sendHttpRequest(HttpMethod method, <span class="keyword">String</span> url, <span class="keyword">String</span> body) throws Exception &#123;</div><div class="line">        <span class="comment">// 此处实例化CountDownLatch并传递给NettyClientInitializer, 继续跟踪  </span></div><div class="line">        CountDownLatch latch = <span class="keyword">new</span> <span class="type">CountDownLatch</span>(<span class="number">1</span>);</div><div class="line">        NettyClientInitializer initializer = <span class="keyword">new</span> <span class="type">NettyClientInitializer</span>(_sslCtx, <span class="literal">null</span>, latch);</div><div class="line">        b.handler(initializer);</div><div class="line">        ResponseWrapper wrapper = <span class="keyword">new</span> <span class="type">ResponseWrapper</span>();</div><div class="line">        URI uri = <span class="keyword">new</span> <span class="type">URI</span>(url);</div><div class="line">        <span class="keyword">String</span> scheme = uri.getScheme() == <span class="literal">null</span> ? <span class="string">"http"</span> : <span class="type">uri</span>.getScheme();</div><div class="line">        <span class="keyword">String</span> host = uri.getHost() == <span class="literal">null</span> ? <span class="string">"127.0.0.1"</span> : <span class="type">uri</span>.getHost();</div><div class="line">        int port = uri.getPort();</div><div class="line">        <span class="keyword">if</span> (port == <span class="number">-1</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="string">"http"</span>.equalsIgnoreCase(scheme)) &#123;</div><div class="line">                port = <span class="number">80</span>;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"https"</span>.equalsIgnoreCase(scheme)) &#123;</div><div class="line">                port = <span class="number">443</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            ChannelFuture connect = b.connect(host, port);</div><div class="line">            _channel = connect.sync().channel();</div><div class="line">            FullHttpRequest request;</div><div class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != body) &#123;</div><div class="line">                ByteBuf byteBuf = Unpooled.copiedBuffer(body.getBytes(CharsetUtil.UTF_8));</div><div class="line">                request = <span class="keyword">new</span> <span class="type">DefaultFullHttpRequest</span>(HttpVersion.HTTP_1_1, method, uri.getRawPath(), byteBuf);</div><div class="line">                request.headers().<span class="keyword">set</span>(HttpHeaderNames.CONTENT_LENGTH, (long) byteBuf.readableBytes());</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                request = <span class="keyword">new</span> <span class="type">DefaultFullHttpRequest</span>(HTTP_1_1, method, uri.getRawPath());</div><div class="line">            &#125;</div><div class="line">            request.headers().<span class="keyword">set</span>(HttpHeaderNames.HOST, uri.getHost());</div><div class="line">            request.headers().<span class="keyword">set</span>(HttpHeaderNames.AUTHORIZATION, _authCode);</div><div class="line">            request.headers().<span class="keyword">set</span>(<span class="string">"Content-Type"</span>,<span class="string">"application/json;charset=utf-8"</span>);</div><div class="line">            connect.awaitUninterruptibly();</div><div class="line">            LOG.info(<span class="string">"Sending request. "</span> + request);</div><div class="line">            LOG.info(<span class="string">"Send body: "</span> + body);</div><div class="line">            _channel.writeAndFlush(request);</div><div class="line">            <span class="comment">//调用latch.await()后主线程阻塞，等待netty异步网络调用。如果异步线程执行后不调用countDown()，主线程将永远阻塞，此为问题主要原因。  </span></div><div class="line">            latch.await();</div><div class="line">            wrapper = initializer.getResponse();</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> wrapper;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>4&gt; cn.jiguang.common.connection.NettyClientInitializer.java</p>
</li>
</ul>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">       <span class="comment">//使用_latch创建HttpResponseHandler</span></div><div class="line">       <span class="keyword">this</span>._handler = <span class="keyword">new</span> HttpResponseHandler(_callback, _latch);</div><div class="line">       socketChannel.pipeline().addLast(_sslCtx.newHandler(socketChannel.alloc()), <span class="keyword">new</span> HttpClientCodec(), _handler);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<ul>
<li>5&gt; cn.jiguang.common.connection.HttpResponseHandler.java<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(ChannelHandlerContext ctx, HttpObject msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">       <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> HttpResponse) &#123;</div><div class="line">           HttpResponse response = (HttpResponse) msg;</div><div class="line">           status = response.status().code();</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> HttpContent) &#123;</div><div class="line">           HttpContent content = (HttpContent) msg;</div><div class="line">           LOG.info(content.content().toString());</div><div class="line">           <span class="keyword">if</span> (content <span class="keyword">instanceof</span> LastHttpContent) &#123;</div><div class="line">               <span class="comment">//断点跟踪发现，程序运行到该分支后，直接close，并未调用_latch.countDown(); 此为问题的主要爆发点</span></div><div class="line">               LOG.info(<span class="string">"closing connection"</span>);</div><div class="line">               ctx.close();</div><div class="line">           &#125; <span class="keyword">else</span> &#123;</div><div class="line">               String responseContent = content.content().toString(CharsetUtil.UTF_8);</div><div class="line">               _wrapper.responseCode = status;</div><div class="line">               _wrapper.responseContent = responseContent;</div><div class="line">               LOG.info(<span class="string">"Got Response code: "</span> + status + <span class="string">" content: "</span> + responseContent);</div><div class="line">               System.err.println(<span class="string">"Got Response code: "</span> + status + <span class="string">" content: "</span> + responseContent);</div><div class="line">               System.err.flush();</div><div class="line">               <span class="keyword">if</span> (<span class="keyword">null</span> != _callback) &#123;</div><div class="line">                   _callback.onSucceed(_wrapper);</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">if</span> (<span class="keyword">null</span> != _latch) &#123;</div><div class="line">                   <span class="comment">//正常情况下</span></div><div class="line">                   _latch.countDown();</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> </span>&#123;</div><div class="line">       LOG.<span class="keyword">error</span>(<span class="string">"error:"</span>, cause);</div><div class="line">       <span class="keyword">try</span> &#123;</div><div class="line">           <span class="comment">//模拟网络异常，发现此处也存在bug，未调用_latch.countDown(); 隐藏爆发点</span></div><div class="line">           ctx.close();</div><div class="line">       &#125;<span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">           LOG.<span class="keyword">error</span>(<span class="string">"close error:"</span>, ex);</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>翻阅源码发现HttpResponseHandler.java类内部存在两个隐患：</p>
<ul>
<li>程序运行到if (content instanceof LastHttpContent) {……}分支后，未调用_latch.countDown();</li>
<li>当出现网络异常时，exceptionCaught方法内部也未调用_latch.countDown();</li>
</ul>
<p>只要其中任意一个隐患爆发，主线程就会阻塞，进入WAITING状态。消费者线程就此堵塞，不再消费BlockQueue中的消息。</p>
<p>##恢复现场</p>
<ul>
<li>Maven pom.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></div><div class="line">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sky-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.sky<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jpush-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- jpush --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.jpush.api<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jpush-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- utils begin --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.jpush.api<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jiguang-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.6.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- LOGGING begin --&gt;</span></div><div class="line">        <span class="comment">&lt;!-- slf4j --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- logback --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- 代码直接调用log4j会被桥接到slf4j --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- 代码直接调用commons-logging会被桥接到slf4j --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- 代码直接调用java.util.logging会被桥接到slf4j --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jul-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- log4jdbc --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.googlecode.log4jdbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- LOGGING end --&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.testng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>testng<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>测试代码</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.sky.jpush;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.jiguang.common.ClientConfig;</div><div class="line"><span class="keyword">import</span> cn.jiguang.common.resp.APIConnectionException;</div><div class="line"><span class="keyword">import</span> cn.jiguang.common.resp.APIRequestException;</div><div class="line"><span class="keyword">import</span> cn.jpush.api.JPushClient;</div><div class="line"><span class="keyword">import</span> cn.jpush.api.<span class="keyword">push</span>.PushResult;</div><div class="line"><span class="keyword">import</span> cn.jpush.api.<span class="keyword">push</span>.model.<span class="keyword">Options</span>;</div><div class="line"><span class="keyword">import</span> cn.jpush.api.<span class="keyword">push</span>.model.Platform;</div><div class="line"><span class="keyword">import</span> cn.jpush.api.<span class="keyword">push</span>.model.PushPayload;</div><div class="line"><span class="keyword">import</span> cn.jpush.api.<span class="keyword">push</span>.model.audience.Audience;</div><div class="line"><span class="keyword">import</span> cn.jpush.api.<span class="keyword">push</span>.model.audience.AudienceTarget;</div><div class="line"><span class="keyword">import</span> cn.jpush.api.<span class="keyword">push</span>.model.notification.IosAlert;</div><div class="line"><span class="keyword">import</span> cn.jpush.api.<span class="keyword">push</span>.model.notification.IosNotification;</div><div class="line"><span class="keyword">import</span> cn.jpush.api.<span class="keyword">push</span>.model.notification.Notification;</div><div class="line"><span class="keyword">import</span> org.slf4j.Logger;</div><div class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</div><div class="line"><span class="keyword">import</span> org.testng.annotations.Test;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * @author roc</div><div class="line"> * @date 2018/01/09</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> JPushServiceTest &#123;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(JPushServiceTest.<span class="keyword">class</span>);</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String APP_KEY = <span class="string">"b11314807507e2bcfdeebe2e"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MASTER_SECRET = <span class="string">"2c88a01e073a0fe4fc7b167c"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String GROUP_MASTER_SECRET = <span class="string">"b11314807507e2bcfdeebe2e"</span>;</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String GROUP_PUSH_KEY = <span class="string">"2c88a01e073a0fe4fc7b167c"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ALERT = <span class="string">"JPush Test - alert"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MSG_CONTENT = <span class="string">"JPush Test - msgContent"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String REGISTRATION_ID1 = <span class="string">"0900e8d85ef"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String REGISTRATION_ID2 = <span class="string">"0a04ad7d8b4"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String REGISTRATION_ID3 = <span class="string">"18071adc030dcba91c0"</span>;</div><div class="line"></div><div class="line">    @Test</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> testNettyClient() &#123;</div><div class="line"></div><div class="line">        ClientConfig clientConfig = ClientConfig.getInstance();</div><div class="line"></div><div class="line">        JPushClient jpushClient = <span class="keyword">new</span> JPushClient(MASTER_SECRET, APP_KEY, <span class="keyword">null</span>, clientConfig);</div><div class="line">        <span class="comment">/*String authCode = ServiceHelper.getBasicAuthorization(APP_KEY, MASTER_SECRET);</span></div><div class="line">        ApacheHttpClient apacheHttpClient = new (authCode, null, clientConfig);</div><div class="line">        jpushClient.getPushClient().setHttpClient(apacheHttpClienApacheHttpClientt);</div><div class="line">        */</div><div class="line">        PushPayload payload = buildTestPayload();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            PushResult result = jpushClient.sendPush(payload);</div><div class="line">            <span class="keyword">int</span> status = result.getResponseCode();</div><div class="line">            LOG.info(<span class="string">"Got result - "</span> + result);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (APIConnectionException e) &#123;</div><div class="line">            LOG.error(<span class="string">"Connection error. Should retry later. "</span>, e);</div><div class="line">            LOG.error(<span class="string">"Sendno: "</span> + payload.getSendno());</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (APIRequestException e) &#123;</div><div class="line">            LOG.error(<span class="string">"Error response from JPush server. Should review and fix it. "</span>, e);</div><div class="line">            LOG.info(<span class="string">"HTTP Status: "</span> + e.getStatus());</div><div class="line">            LOG.info(<span class="string">"Error Code: "</span> + e.getErrorCode());</div><div class="line">            LOG.info(<span class="string">"Error Message: "</span> + e.getErrorMessage());</div><div class="line">            LOG.info(<span class="string">"Msg ID: "</span> + e.getMsgId());</div><div class="line">            LOG.error(<span class="string">"Sendno: "</span> + payload.getSendno());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> PushPayload buildTestPayload() &#123;</div><div class="line">        String title = <span class="string">"hello world, roc"</span>;</div><div class="line">        String subTitle = <span class="string">"低头前行了这么久，我只是在找一个抬头的机会"</span>;</div><div class="line">        String body = <span class="string">"人这一生，浪费了太多的时间在毫无意义的事情上，担忧、抱怨、埋怨、比较……"</span>;</div><div class="line"></div><div class="line">        IosAlert iosAlert = IosAlert.newBuilder()</div><div class="line">                .setTitleAndBody(title, subTitle, body).build();</div><div class="line">        IosNotification iosNotification = IosNotification.newBuilder()</div><div class="line">                .setAlert(iosAlert).incrBadge(<span class="number">1</span>)</div><div class="line">                .setSound(<span class="string">"happy"</span>).build();</div><div class="line">        Notification notification = Notification.newBuilder().addPlatformNotification(iosNotification).build();</div><div class="line"></div><div class="line">        PushPayload pushPayload = PushPayload</div><div class="line">                .newBuilder()</div><div class="line">                .setPlatform(Platform.android_ios())</div><div class="line">                .setAudience(</div><div class="line">                        Audience.newBuilder()</div><div class="line">                                .addAudienceTarget(</div><div class="line">                                        AudienceTarget.alias(<span class="string">"TEST303644"</span>))</div><div class="line">                                .build())</div><div class="line">                .setNotification(notification)</div><div class="line">                .setOptions(<span class="keyword">Options</span>.newBuilder().setApnsProduction(<span class="keyword">true</span>).build())</div><div class="line">                .build();</div><div class="line">        <span class="keyword">return</span> pushPayload;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>Thread Dump</li>
</ul>
<p>Debug跟踪，发现程序进入if分支，调用close()关闭连接后，主线程阻塞进入wait状态。使用IDEA生成thread dump：<br><img src="http://olml6iu96.bkt.clouddn.com/%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8Cif%E5%88%86%E6%94%AF.png" alt="此处输入图片的描述"><br><img src="http://olml6iu96.bkt.clouddn.com/get%20thread%20dump.png" alt="此处输入图片的描述"></p>
<ul>
<li>日志输出</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">2018-01-09</span> <span class="selector-tag">21</span><span class="selector-pseudo">:12</span><span class="selector-pseudo">:19.064</span> <span class="selector-attr">[nioEventLoopGroup-2-1]</span> <span class="selector-tag">DEBUG</span> <span class="selector-tag">io</span><span class="selector-class">.netty</span><span class="selector-class">.handler</span><span class="selector-class">.ssl</span><span class="selector-class">.SslHandler</span> <span class="selector-tag">-</span> <span class="selector-attr">[id: 0x6f019129, L:/10.0.31.70:55848 - R:api.jpush.cn/103.40.232.116:443]</span> <span class="selector-tag">HANDSHAKEN</span>: <span class="selector-tag">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA</span></div><div class="line"><span class="selector-tag">2018-01-09</span> <span class="selector-tag">21</span><span class="selector-pseudo">:12</span><span class="selector-pseudo">:29.324</span> <span class="selector-attr">[nioEventLoopGroup-2-1]</span> <span class="selector-tag">INFO</span>  <span class="selector-tag">c</span><span class="selector-class">.j</span><span class="selector-class">.c</span><span class="selector-class">.connection</span><span class="selector-class">.HttpResponseHandler</span> <span class="selector-tag">-</span> <span class="selector-tag">PooledSlicedByteBuf</span>(<span class="attribute">ridx</span>: <span class="number">0</span>, <span class="attribute">widx</span>: <span class="number">44</span>, <span class="attribute">cap</span>: <span class="number">44</span>/<span class="number">44</span>, <span class="attribute">unwrapped</span>: PooledUnsafeDirectByteBuf(<span class="attribute">ridx</span>: <span class="number">324</span>, <span class="attribute">widx</span>: <span class="number">324</span>, <span class="attribute">cap</span>: <span class="number">373</span>))</div><div class="line"><span class="comment">//此为HttpResponseHandler.java类log输出，与源代码吻合</span></div><div class="line"><span class="selector-tag">2018-01-09</span> <span class="selector-tag">21</span><span class="selector-pseudo">:12</span><span class="selector-pseudo">:49.010</span> <span class="selector-attr">[nioEventLoopGroup-2-1]</span> <span class="selector-tag">INFO</span>  <span class="selector-tag">c</span><span class="selector-class">.j</span><span class="selector-class">.c</span><span class="selector-class">.connection</span><span class="selector-class">.HttpResponseHandler</span> <span class="selector-tag">-</span> <span class="selector-tag">closing</span> <span class="selector-tag">connection</span></div></pre></td></tr></table></figure>
<p>主线程处于WAIT状态，Netty异步线程已运行完毕，现场恢复成功。</p>
<p>##解决方案</p>
<ol>
<li>升级极光SDK版本，升级后发现最新版已解决该问题。</li>
<li>增加熔断处理，调用外部服务时，使用Guava SimpleTimeLimiter设置超时熔断。</li>
</ol>
]]></content>
    
    <summary type="html">
    
      极光推送java-sdk-V3.2.15 CountDownLatch使用不当导致线程堵塞
    
    </summary>
    
      <category term="java" scheme="https://roc-wong.github.io/categories/java/"/>
    
    
      <category term="java后端" scheme="https://roc-wong.github.io/tags/java%E5%90%8E%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>Notepad++-regular-expression</title>
    <link href="https://roc-wong.github.io/blog/2017/08/NotePad-regular-expression.html"/>
    <id>https://roc-wong.github.io/blog/2017/08/NotePad-regular-expression.html</id>
    <published>2017-08-04T12:26:41.000Z</published>
    <updated>2018-01-11T02:04:31.348Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>低头前行了这么久，我只是在找一个抬头的机会</p>
</blockquote>
<p>Notepad++ 正则表达式用法归档</p>
<p>注意: 不支持多行表达式 (involving \n, \r, etc).</p>
<a id="more"></a>
<h2 id="基本表达式"><a href="#基本表达式" class="headerlink" title="基本表达式"></a>基本表达式</h2><table>
<thead>
<tr>
<th>符号</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>.</td>
<td>匹配任意字符，除了新一行(\n)。也就是说 “.”可以匹配 \r ，当文件中同时含有\r and \n时，会引起混乱。要匹配所有的字符，使用\s\S。</td>
</tr>
<tr>
<td>(…)</td>
<td>这个匹配一个标签区域. 这个标签可以被访问，通过语法 \1访问第一个标签, \2 访问第二个, 同理 \3 \4 … \9。 这些标签可以用在当前正则表达式中，或则替search和replace中的换字符串。</td>
</tr>
<tr>
<td>\1, \2, etc</td>
<td>在替换中代表1到9的标签区域(\1 to \9)。例如, 查找字符串 Fred([1-9])XXX 并替换为字符串 Sam\1YYY的方法，当在文件中找到Fred2XXX的字符串时，会替换为Sam2YYY。注意: 只有9个区域能使用，所以我们在使用时很安全，像\10\2 表示区域1和文本”0”以及区域2。</td>
</tr>
<tr>
<td>[…]</td>
<td>表示一个字符集合, 例如 [abc]表示任意字符 a, b or c.我们也可以使用范围例如[a-z] 表示所以的小写字母。</td>
</tr>
<tr>
<td>[^…]</td>
<td>表示字符补集. 例如, [^A-Za-z] 表示任意字符除了字母表。</td>
</tr>
<tr>
<td>^</td>
<td>匹配一行的开始(除非在集合中, 如下).</td>
</tr>
<tr>
<td>$</td>
<td>匹配行尾.</td>
</tr>
<tr>
<td>*</td>
<td>匹配0或多次, 例如 Sa*m 匹配 Sm, Sam, Saam, Saaam 等等.</td>
</tr>
<tr>
<td>+</td>
<td>匹配1次或多次,例如 Sa+m 匹配 Sam, Saam, Saaam 等等.</td>
</tr>
<tr>
<td>?</td>
<td>匹配0或者1次, 例如 Sa?m 匹配 Sm, Sam.</td>
</tr>
<tr>
<td>{n}</td>
<td>匹配确定的 n 次.例如, ‘Sa{2}m’ 匹配 Saam.</td>
</tr>
<tr>
<td>{m,n}</td>
<td>匹配至少m次，至多n次(如果n缺失，则任意次数).例如, ‘Sa{2,3}m’ 匹配 Saam or Saaam. ‘Sa{2,}m’ 与 ‘Saa+m’相同</td>
</tr>
<tr>
<td>*?, +?, ??, {n,m}?</td>
<td>非贪心匹配，匹配第一个有效的匹配，通常 ‘&lt;.&gt;’ 会匹配整个 ‘content’字符串 –但 ‘&lt;.?&gt;’ 只匹配 ” .这个标记一个标签区域，这些区域可以用语法\1 \2 等访问多个对应1-9区域。</td>
</tr>
</tbody>
</table>
<h2 id="标记和分组"><a href="#标记和分组" class="headerlink" title="标记和分组"></a>标记和分组</h2><table>
<thead>
<tr>
<th>符号</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>(…)</td>
<td>一组捕获. 可以通过\1 访问第一个组, \2 访问第二个.</td>
</tr>
<tr>
<td>(?:…)</td>
<td>非捕获组.</td>
</tr>
<tr>
<td>(?=…)</td>
<td>非捕获组 – 向前断言. 例如’(.*)(?=ton)’ 表达式，当 遇到’Appleton’字符串时，会匹配为’Apple’.</td>
</tr>
<tr>
<td>(?&lt;=…)</td>
<td>非捕获组 – 向后断言. 例如’(?&lt;=sir) (.*)’ 表示式，当遇到’sir William’ 字符串时，匹配为’ William’.</td>
</tr>
<tr>
<td>(?!…)</td>
<td>非捕获组 – 消极的向前断言. 例如’.(?!e)’ 表达式，当遇到’Apple’时，会找到每个字母除了 ‘l’，因为它紧跟着 ‘e’.</td>
</tr>
<tr>
<td>(?</td>
<td>非捕获组 – 消极向后断言. 例如 ‘(?</td>
</tr>
<tr>
<td>(?P…)</td>
<td>命名所捕获的组. 提交一个名称到组中供后续使用，例如’(?PA[^\s]+)\s(?P=first)’ 会找到 ‘Apple Apple’. 类似的 ‘(A[^\s]+)\s\1’ 使用组名而不是数字.</td>
</tr>
<tr>
<td>(?=name)</td>
<td>匹配名为name的组. (?P…).</td>
</tr>
<tr>
<td>(?#comment)</td>
<td>批注 –括号中的内容在匹配时将被忽略。</td>
</tr>
</tbody>
</table>
<h2 id="特殊符号"><a href="#特殊符号" class="headerlink" title="特殊符号"></a>特殊符号</h2><table>
<thead>
<tr>
<th>符号</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>\s</td>
<td>匹配空格. 注意，会匹配标记的末尾. 使用 [[:blank:]] 来避免匹配新一行。</td>
</tr>
<tr>
<td>\S</td>
<td>匹配非空白</td>
</tr>
<tr>
<td>\w</td>
<td>匹配单词字符</td>
</tr>
<tr>
<td>\W</td>
<td>匹配非单词字符</td>
</tr>
<tr>
<td>\d</td>
<td>匹配数字字符</td>
</tr>
<tr>
<td>\D</td>
<td>匹配非数字字符</td>
</tr>
<tr>
<td>\b</td>
<td>匹配单词边界. ‘\bW\w+’ 找到W开头的单词</td>
</tr>
<tr>
<td>\B</td>
<td>匹配非单词边界. ‘\Be\B+’ – 找到位于单子中间的字母’e’</td>
</tr>
<tr>
<td>\&lt;</td>
<td>This matches the start of a word using Scintilla’s definitions of words.</td>
</tr>
<tr>
<td>&gt;</td>
<td>This matches the end of a word using Scintilla’s definition of words.</td>
</tr>
<tr>
<td>\x</td>
<td>运行用x来表达可能具有其他意思的字符。例如, [ 用来插入到文本中作为[ 而不是作为字符集的开始.</td>
</tr>
</tbody>
</table>
<h2 id="字符类"><a href="#字符类" class="headerlink" title="字符类"></a>字符类</h2><table>
<thead>
<tr>
<th>符号</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>[[:alpha:]]</td>
<td>匹配字母字符: [A-Za-z]</td>
</tr>
<tr>
<td>[[:digit:]]</td>
<td>匹配数字字符: [0-9]</td>
</tr>
<tr>
<td>[[:xdigit:]]</td>
<td>匹配16进制字符: [0-9A-Fa-f]</td>
</tr>
<tr>
<td>[[:alnum:]]</td>
<td>匹配字母数字字符: [0-9A-Za-z]</td>
</tr>
<tr>
<td>[[:lower:]]</td>
<td>匹配小写字符: [a-z]</td>
</tr>
<tr>
<td>[[:upper:]]</td>
<td>匹配大写字符: [A-Z]</td>
</tr>
<tr>
<td>[[:blank:]]</td>
<td>匹配空白 (空格 or tab):[ \t]</td>
</tr>
<tr>
<td>[[:space:]]</td>
<td>匹配空白字符:[ \t\r\n\v\f]</td>
</tr>
<tr>
<td>[[:punct:]]</td>
<td>匹配标点字符: [-!”#$%&amp;’()*+,./:;&lt;=&gt;?@[]_`{</td>
</tr>
<tr>
<td>[[:graph:]]</td>
<td>匹配图形字符: [\x21-\x7E]</td>
</tr>
<tr>
<td>[[:print:]]</td>
<td>匹配可打印的字符 (graphical characters and spaces)</td>
</tr>
<tr>
<td>[[:cntrl:]]</td>
<td>匹配控制字符</td>
</tr>
</tbody>
</table>
<h2 id="替换操作"><a href="#替换操作" class="headerlink" title="替换操作"></a>替换操作</h2><p>使用正则表达式的标记，通过（）来包围想要用的字符，然后用\1 来替换字符串，第一个匹配文本。</p>
<p>例如:</p>
<p>Text body    Search string    Replace string    Result<br>Hi my name is Fred    my name is (.+)    my name is not \1    Hi my name is not Fred<br>The quick brown fox jumped over the fat lazy dog    brown (.+) jumped over the (.+)    brown \2 jumped over the \1    The quick brown fat jumped over the fox lazy dog</p>
<h2 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h2><p>Support for regular expressions in PN2 is currently limited, the supported patterns and syntax are a very small subset of the powerful expressions supported by perl. 最大的限制是正则表达式只能匹配单行，不能用多行匹配表达。可以用Backslash Expressions代替.</p>
<p>准备计划是使用PCRE库 library (used elsewhere in PN2) 来支持文档搜索.</p>
<p>原文：<a href="http://www.pnotepad.org/docs/search/regular_expressions/" target="_blank" rel="external">http://www.pnotepad.org/docs/search/regular_expressions/</a></p>
<h2 id="应用举例"><a href="#应用举例" class="headerlink" title="应用举例"></a>应用举例</h2><h3 id="删除空白行的方法"><a href="#删除空白行的方法" class="headerlink" title="删除空白行的方法"></a>删除空白行的方法</h3><p>选择替换，把查找模式设置为正则表达式，在查找框中输入 ^\s+  ,替换框留空，点“全部替换”，即可(先全选)。</p>
<h3 id="删除所有行s字符开始后面的所有字符"><a href="#删除所有行s字符开始后面的所有字符" class="headerlink" title="删除所有行s字符开始后面的所有字符"></a>删除所有行s字符开始后面的所有字符</h3><p>选择替换，把查找模式设置为正则表达式，在查找框中输入 ^([^:]<em>):.</em>$，替换框填写$1，点“全部替换”，即可(先全选)。</p>
]]></content>
    
    <summary type="html">
    
      Notepad++ regular expression 正则表达式
    
    </summary>
    
      <category term="IDE" scheme="https://roc-wong.github.io/categories/IDE/"/>
    
    
      <category term="Notepad++" scheme="https://roc-wong.github.io/tags/Notepad/"/>
    
  </entry>
  
  <entry>
    <title>svn-sqliteS10-disk-IO-error</title>
    <link href="https://roc-wong.github.io/blog/2017/08/svn-sqliteS10-disk-IO-error.html"/>
    <id>https://roc-wong.github.io/blog/2017/08/svn-sqliteS10-disk-IO-error.html</id>
    <published>2017-08-04T12:23:50.000Z</published>
    <updated>2018-01-11T02:04:11.800Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>低头前行，莫问前程。</p>
</blockquote>
<p>在使用svn提交项目时，遇到报错：svn: E200030: sqlite[S10]: disk I/O error</p>
<a id="more"></a>
<p>在使用svn提交项目时，遇到报错：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="string">svn:</span> <span class="string">E155004:</span> Run <span class="string">'svn cleanup'</span> to remove locks (type <span class="string">'svn help cleanup'</span> <span class="keyword">for</span> details)</div><div class="line"><span class="string">svn:</span> <span class="string">E155004:</span> Failed to lock working copy <span class="string">'F:\workspace-new\idea-workspace\hbec-app-stock-project'</span>.</div><div class="line"><span class="string">svn:</span> <span class="string">E200030:</span> sqlite[S10]: disk I/O error</div><div class="line"><span class="string">svn:</span> <span class="string">E200042:</span> Additional <span class="string">errors:</span></div><div class="line"><span class="string">svn:</span> <span class="string">E200030:</span> sqlite[S10]: disk I/O error</div><div class="line"><span class="string">svn:</span> <span class="string">E200030:</span> sqlite[S1]: no such <span class="string">savepoint:</span> svn</div><div class="line"><span class="string">svn:</span> <span class="string">E200030:</span> sqlite[S1]: no such <span class="string">savepoint:</span> svn</div><div class="line"><span class="string">svn:</span> <span class="string">E200030:</span> sqlite[S1]: no such <span class="string">savepoint:</span> svn</div><div class="line"><span class="string">svn:</span> <span class="string">E200030:</span> sqlite[S1]: no such <span class="string">savepoint:</span> svn</div></pre></td></tr></table></figure>
<p>此时可通过sqlite3工具来修复，具体步骤为：</p>
<ul>
<li>下载sqlite3工具，下载地址为：<a href="http://www.sqlite.org/download.html" target="_blank" rel="external">http://www.sqlite.org/download.html</a></li>
<li>将sqlite3.exe文件解压缩到.svn目录的同级目录</li>
<li>打开命令行工具，切换到.svn的同级目录<br>  执行命令：<br>  sqlite3.exe .svn/wc.db “reindex nodes”<br>  sqlite3.exe .svn/wc.db “reindex pristine”</li>
</ul>
]]></content>
    
    <summary type="html">
    
      svn E200030 sqlite[S10] disk I/O error
    
    </summary>
    
      <category term="SVN" scheme="https://roc-wong.github.io/categories/SVN/"/>
    
    
      <category term="SVN" scheme="https://roc-wong.github.io/tags/SVN/"/>
    
  </entry>
  
  <entry>
    <title>deadlock-found-when-trying-to-get-lock</title>
    <link href="https://roc-wong.github.io/blog/2017/07/deadlock-found-when-trying-to-get-lock.html"/>
    <id>https://roc-wong.github.io/blog/2017/07/deadlock-found-when-trying-to-get-lock.html</id>
    <published>2017-07-24T04:33:22.000Z</published>
    <updated>2018-01-11T02:04:08.297Z</updated>
    
    <content type="html"><![CDATA[<p>mysql锁机制分为表级锁和行级锁：</p>
<p>共享锁又称为读锁，简称S锁，顾名思义，共享锁就是多个事务对于同一数据可以共享一把锁，都能访问到数据，但是只能读不能修改。</p>
<p>排他锁又称为写锁，简称X锁，顾名思义，排他锁就是不能与其他所并存，如一个事务获取了一个数据行的排他锁，其他事务就不能再获取该行的其他锁，包括共享锁和排他锁，但是获取排他锁的事务是可以对数据就行读取和修改。</p>
<a id="more"></a>
<p>对于共享锁大家可能很好理解，就是多个事务只能读数据不能改数据，对于排他锁大家的理解可能就有些差别，我当初就犯了一个错误，以为排他锁锁住一行数据后，其他事务就不能读取和修改该行数据，其实不是这样的。排他锁指的是一个事务在一行数据加上排他锁后，其他事务不能再在其上加其他的锁。mysql InnoDB引擎默认的修改数据语句，update,delete,insert都会自动给涉及到的数据加上排他锁，select语句默认不会加任何锁类型，如果加排他锁可以使用select …for update语句，加共享锁可以使用select … lock in share mode语句。所以加过排他锁的数据行在其他事务种是不能修改数据的，也不能通过for update和lock in share mode锁的方式查询数据，但可以直接通过select …from…查询数据，因为普通查询没有任何锁机制。</p>
<p><img src="http://olml6iu96.bkt.clouddn.com/mysql-lock.png" alt="死锁"></p>
<h2 id="案发现场"><a href="#案发现场" class="headerlink" title="案发现场"></a>案发现场</h2><p>API网关在30ms内收到6次相同请求，错误日志：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.754</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1379</span>] INFO  h<span class="selector-class">.a</span><span class="selector-class">.a</span><span class="selector-class">.f</span><span class="selector-class">.AppPlatformRateLimiterFilter</span> - parameter=_appCrypt_=VDzT76Hdrp9QAO4lSbQuJeIaKnQ8VZnqljK+YmN2W1tyBSv1JqIhTrDHrBlWM9K8yg3kcLOUmENr1OUc+<span class="number">6</span>xWSL13Z2jaBhCJDrMYWad/H971ilDd4eQMrakZP84dCbXC&amp;_t_=HBStockWarningIos_3.<span class="number">6.4</span>&amp;ticket=<span class="number">7</span>.BdzpPOeP2_7JV6IYArPBIOC36NO2PoCMhVPHiISIEM_tAo7-unTlp_baBhZ79TZskD-HBIBmSnk-<span class="number">7</span>y_tv24wD2IiSgTHlj7x5DTHEV7CacwVdw9jmTCuVdePd4mUaM11k5XGRSsPzqzQmomKMu7aGm8R48Nq-ECE7WpSNtQmExU&amp;</div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.756</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1379</span>] INFO  hbec<span class="selector-class">.app</span><span class="selector-class">.api</span><span class="selector-class">.filter</span><span class="selector-class">.RateLimiter</span> - userId:<span class="number">3245964</span>, 在 <span class="number">5s</span> 内第<span class="number">1</span>次 执行操作 http:<span class="comment">//api.*.com/followStockService.follow, 通过流速控制器, 阀值(5s最高40次)</span></div><div class="line"></div><div class="line"></div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.756</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1319</span>] INFO  hbec<span class="selector-class">.app</span><span class="selector-class">.api</span><span class="selector-class">.filter</span><span class="selector-class">.RateLimiter</span> - userId:<span class="number">3245964</span>, 在 <span class="number">5s</span> 内第<span class="number">2</span>次 执行操作 http:<span class="comment">//api.*.com/followStockService.follow, 通过流速控制器, 阀值(5s最高40次)</span></div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.757</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1319</span>] DEBUG h<span class="selector-class">.p</span><span class="selector-class">.commons</span><span class="selector-class">.web</span><span class="selector-class">.HbecApiHandleAdapter</span> - param-sha1 : null, appCrypt&lt;<span class="number">1</span>&gt; : VDzT76Hdrp9QAO4lSbQuJeIaKnQ8VZnqljK+YmN2W1tyBSv1JqIhTrDHrBlWM9K8yg3kcLOUmENr1OUc+<span class="number">6</span>xWSL13Z2jaBhCJDrMYWad/H971ilDd4eQMrakZP84dCbXC, dataKey=l7g19q1<span class="variable">$g</span>#*o9v-<span class="number">1</span></div><div class="line"></div><div class="line"></div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.755</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1414</span>] INFO  h<span class="selector-class">.a</span><span class="selector-class">.a</span><span class="selector-class">.f</span><span class="selector-class">.AppPlatformRateLimiterFilter</span> - http request=http:<span class="comment">//api.*.com/followStockService.follow</span></div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.755</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1414</span>] INFO  h<span class="selector-class">.a</span><span class="selector-class">.a</span><span class="selector-class">.f</span><span class="selector-class">.AppPlatformRateLimiterFilter</span> - </div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.757</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1414</span>] INFO  hbec<span class="selector-class">.app</span><span class="selector-class">.api</span><span class="selector-class">.filter</span><span class="selector-class">.RateLimiter</span> - userId:<span class="number">3245964</span>, 在 <span class="number">5s</span> 内第<span class="number">3</span>次 执行操作 http:<span class="comment">//api.*.com/followStockService.follow, 通过流速控制器, 阀值(5s最高40次)</span></div><div class="line"></div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.756</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1457</span>] INFO  h<span class="selector-class">.a</span><span class="selector-class">.a</span><span class="selector-class">.f</span><span class="selector-class">.AppPlatformRateLimiterFilter</span> - http request=http:<span class="comment">//api.*.com/followStockService.follow</span></div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.756</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1457</span>] INFO  h<span class="selector-class">.a</span><span class="selector-class">.a</span><span class="selector-class">.f</span><span class="selector-class">.AppPlatformRateLimiterFilter</span> - </div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.757</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1457</span>] INFO  hbec<span class="selector-class">.app</span><span class="selector-class">.api</span><span class="selector-class">.filter</span><span class="selector-class">.RateLimiter</span> - userId:<span class="number">3245964</span>, 在 <span class="number">5s</span> 内第<span class="number">4</span>次 执行操作 http:<span class="comment">//api.*.com/followStockService.follow, 通过流速控制器, 阀值(5s最高40次)</span></div><div class="line"></div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.757</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1334</span>] INFO  h<span class="selector-class">.a</span><span class="selector-class">.a</span><span class="selector-class">.f</span><span class="selector-class">.AppPlatformRateLimiterFilter</span> - http request=http:<span class="comment">//api.*.com/followStockService.follow</span></div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.757</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1334</span>] INFO  h<span class="selector-class">.a</span><span class="selector-class">.a</span><span class="selector-class">.f</span><span class="selector-class">.AppPlatformRateLimiterFilter</span> - parameter=_appCrypt_=VDzT76Hdrp9QAO4lSbQuJeIaKnQ8VZnqljK+YmN2W1tyBSv1JqIhTrDHrBlWM9K8yg3kcLOUmENr1OUc+<span class="number">6</span>xWSL13Z2jaBhCJDrMYWad/H971ilDd4eQMrakZP84dCbXC&amp;_t_=HBStockWarningIos_3.<span class="number">6.4</span>&amp;ticket=<span class="number">7</span>.BdzpPOeP2_7JV6IYArPBIOC36NO2PoCMhVPHiISIEM_tAo7-unTlp_baBhZ79TZskD-HBIBmSnk-<span class="number">7</span>y_tv24wD2IiSgTHlj7x5DTHEV7CacwVdw9jmTCuVdePd4mUaM11k5XGRSsPzqzQmomKMu7aGm8R48Nq-ECE7WpSNtQmExU&amp;</div><div class="line">Jul <span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ23qpg65e4Z api_qianqian1 <span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50.759</span> [http-apr-<span class="number">8080</span>-exec-<span class="number">1334</span>] INFO  hbec<span class="selector-class">.app</span><span class="selector-class">.api</span><span class="selector-class">.filter</span><span class="selector-class">.RateLimiter</span> - userId:<span class="number">3245964</span>, 在 <span class="number">5s</span> 内第<span class="number">5</span>次 执行操作 http:<span class="comment">//api.*.com/followStockService.follow, 通过流速控制器, 阀值(5s最高40次)</span></div></pre></td></tr></table></figure>
<p>业务日志</p>
<p>追踪到业务节点后，发现mysql出现死锁问题：Deadlock found when trying to get lock; try restarting transaction</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="number">17</span>-07-23 <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span>.<span class="number">779</span> ERROR[DubboServerHandler-10.<span class="number">253</span>.<span class="number">17</span>.<span class="number">105</span>:<span class="number">20880</span>-thread-193 DbService.execute:<span class="number">1247</span>] &#123;&#125;</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 hbec.platform.commons.exceptions.HbecDbServiceException: service=db,message=hbec.platform.commons.exceptions.HbecDbServiceException: service=db,message=</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### Error updating database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLTransactionRollbackException: Deadlock found when trying to get lock; try restarting transaction</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### The error may involve WarnFollowMapper.follow-Inline</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### The error occurred while setting parameters</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### SQL: insert into warn_follow (user_id, security_type, stock_code, exchange, stock_name, sub_fund_type, sort)         values (?, ?,  ?,                 ?,?, ?,                 (select max(IFNULL(t1.sort,0)) + 1 from WARN_FOLLOW t1 where t1.user_id = ?) )         on duplicate key update sort= (select max(IFNULL(t2.sort,0)) + 1 from warn_follow t2 where t2.user_id= ?)</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLTransactionRollbackException: Deadlock found when trying to get lock; try restarting transaction</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.platform.runtime.DbServiceInterceptor$<span class="number">1</span>.execute(DbServiceInterceptor.<span class="keyword">java:39) </span>~[hbec-platform-commons-0.<span class="number">0</span>.<span class="number">32</span>-SNAPSHOT.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.platform.runtime.DbService.execute(DbService.<span class="keyword">java:1242) </span>~[hbec-platform-commons-0.<span class="number">0</span>.<span class="number">32</span>-SNAPSHOT.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.platform.runtime.DbServiceInterceptor.intercept(DbServiceInterceptor.<span class="keyword">java:33) </span>[hbec-platform-commons-0.<span class="number">0</span>.<span class="number">32</span>-SNAPSHOT.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.app.stock.follow.service.impl.WarnFollowServiceImpl$$EnhancerByCGLIB$$<span class="number">41</span>e28e09.follow(&lt;generated&gt;) [spring-core-4.<span class="number">0</span>.<span class="number">2</span>.RELEASE.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.app.stock.follow.controller.impl.FollowStockControllerImpl.follow(FollowStockControllerImpl.<span class="keyword">java:304) </span>[hbec-app-stock-follow-1.<span class="number">0</span>.<span class="number">2</span>-SNAPSHOT.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.common.<span class="keyword">bytecode.Wrapper94.invokeMethod(Wrapper94.java) </span>[na:<span class="number">2</span>.<span class="number">5</span>.<span class="number">3</span>]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.proxy.<span class="keyword">javassist.JavassistProxyFactory$1.doInvoke(JavassistProxyFactory.java:46) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.proxy.AbstractProxyInvoker.invoke(AbstractProxyInvoker.<span class="keyword">java:72) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.InvokerWrapper.invoke(InvokerWrapper.<span class="keyword">java:53) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.filter.ExceptionFilter.invoke(ExceptionFilter.<span class="keyword">java:64) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.ProtocolFilterWrapper$<span class="number">1</span>.invoke(ProtocolFilterWrapper.<span class="keyword">java:91) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.filter.TimeoutFilter.invoke(TimeoutFilter.<span class="keyword">java:42) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.ProtocolFilterWrapper$<span class="number">1</span>.invoke(ProtocolFilterWrapper.<span class="keyword">java:91) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.monitor.support.MonitorFilter.invoke(MonitorFilter.<span class="keyword">java:75) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.ProtocolFilterWrapper$<span class="number">1</span>.invoke(ProtocolFilterWrapper.<span class="keyword">java:91) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.dubbo.filter.TraceFilter.invoke(TraceFilter.<span class="keyword">java:78) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.ProtocolFilterWrapper$<span class="number">1</span>.invoke(ProtocolFilterWrapper.<span class="keyword">java:91) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.app.eagleeye.dubbo.EagleeyeFilter.invoke(EagleeyeFilter.<span class="keyword">java:155) </span>[hbec-platform-runtime-app-0.<span class="number">0</span>.<span class="number">32</span>-SNAPSHOT.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.ProtocolFilterWrapper$<span class="number">1</span>.invoke(ProtocolFilterWrapper.<span class="keyword">java:91) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.filter.ContextFilter.invoke(ContextFilter.<span class="keyword">java:60) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.ProtocolFilterWrapper$<span class="number">1</span>.invoke(ProtocolFilterWrapper.<span class="keyword">java:91) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.filter.GenericFilter.invoke(GenericFilter.<span class="keyword">java:112) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.ProtocolFilterWrapper$<span class="number">1</span>.invoke(ProtocolFilterWrapper.<span class="keyword">java:91) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.filter.ClassLoaderFilter.invoke(ClassLoaderFilter.<span class="keyword">java:38) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.ProtocolFilterWrapper$<span class="number">1</span>.invoke(ProtocolFilterWrapper.<span class="keyword">java:91) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.filter.EchoFilter.invoke(EchoFilter.<span class="keyword">java:38) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.ProtocolFilterWrapper$<span class="number">1</span>.invoke(ProtocolFilterWrapper.<span class="keyword">java:91) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.rpc.protocol.dubbo.DubboProtocol$<span class="number">1</span>.reply(DubboProtocol.<span class="keyword">java:108) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.remoting.exchange.support.header.HeaderExchangeHandler.handleRequest(HeaderExchangeHandler.<span class="keyword">java:84) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.remoting.exchange.support.header.HeaderExchangeHandler.received(HeaderExchangeHandler.<span class="keyword">java:170) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.remoting.transport.DecodeHandler.received(DecodeHandler.<span class="keyword">java:52) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.alibaba.dubbo.remoting.transport.<span class="keyword">dispatcher.ChannelEventRunnable.run(ChannelEventRunnable.java:82) </span>[dubbo-2.<span class="number">5</span>.<span class="number">3</span>.<span class="keyword">jar:2.5.3]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) </span>[na:<span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_55]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) </span>[na:<span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_55]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">java.lang.Thread.run(Thread.java:745) </span>[na:<span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_55]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 Caused <span class="keyword">by: </span><span class="keyword">java.lang.RuntimeException: </span>hbec.platform.commons.exceptions.HbecDbServiceException: service=db,message=</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### Error updating database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLTransactionRollbackException: Deadlock found when trying to get lock; try restarting transaction</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### The error may involve WarnFollowMapper.follow-Inline</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### The error occurred while setting parameters</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### SQL: insert into warn_follow (user_id, security_type, stock_code, exchange, stock_name, sub_fund_type, sort)         values (?, ?,  ?,                 ?,?, ?,                 (select max(IFNULL(t1.sort,0)) + 1 from WARN_FOLLOW t1 where t1.user_id = ?) )         on duplicate key update sort= (select max(IFNULL(t2.sort,0)) + 1 from warn_follow t2 where t2.user_id= ?)</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLTransactionRollbackException: Deadlock found when trying to get lock; try restarting transaction</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.app.stock.follow.repository.impl.WarnFollowRepository.follow(WarnFollowRepository.<span class="keyword">java:238) </span>~[hbec-app-stock-follow-1.<span class="number">0</span>.<span class="number">2</span>-SNAPSHOT.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.app.stock.follow.service.impl.WarnFollowServiceImpl.follow(WarnFollowServiceImpl.<span class="keyword">java:87) </span>~[hbec-app-stock-follow-1.<span class="number">0</span>.<span class="number">2</span>-SNAPSHOT.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.app.stock.follow.service.impl.WarnFollowServiceImpl$$EnhancerByCGLIB$$<span class="number">41</span>e28e09.CGLIB$follow$<span class="number">0</span>(&lt;generated&gt;) [spring-core-4.<span class="number">0</span>.<span class="number">2</span>.RELEASE.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.app.stock.follow.service.impl.WarnFollowServiceImpl$$EnhancerByCGLIB$$<span class="number">41</span>e28e09$$FastClassByCGLIB$$cf<span class="number">1f</span>7d<span class="number">1b</span>.invoke(&lt;generated&gt;) ~[spring-core-4.<span class="number">0</span>.<span class="number">2</span>.RELEASE.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:228) </span>~[spring-core-4.<span class="number">0</span>.<span class="number">2</span>.RELEASE.<span class="keyword">jar:4.0.2.RELEASE]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.platform.runtime.DbServiceInterceptor$<span class="number">1</span>.execute(DbServiceInterceptor.<span class="keyword">java:37) </span>~[hbec-platform-commons-0.<span class="number">0</span>.<span class="number">32</span>-SNAPSHOT.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	... <span class="number">34</span> common frames omitted</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 Caused <span class="keyword">by: </span>hbec.platform.commons.exceptions.HbecDbServiceException: service=db,message=</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### Error updating database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLTransactionRollbackException: Deadlock found when trying to get lock; try restarting transaction</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### The error may involve WarnFollowMapper.follow-Inline</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### The error occurred while setting parameters</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### SQL: insert into warn_follow (user_id, security_type, stock_code, exchange, stock_name, sub_fund_type, sort)         values (?, ?,  ?,                 ?,?, ?,                 (select max(IFNULL(t1.sort,0)) + 1 from WARN_FOLLOW t1 where t1.user_id = ?) )         on duplicate key update sort= (select max(IFNULL(t2.sort,0)) + 1 from warn_follow t2 where t2.user_id= ?)</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLTransactionRollbackException: Deadlock found when trying to get lock; try restarting transaction</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.platform.runtime.DbService.myInsert(DbService.<span class="keyword">java:2345) </span>~[hbec-platform-commons-0.<span class="number">0</span>.<span class="number">32</span>-SNAPSHOT.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.app.stock.follow.repository.impl.WarnFollowRepository.follow(WarnFollowRepository.<span class="keyword">java:236) </span>~[hbec-app-stock-follow-1.<span class="number">0</span>.<span class="number">2</span>-SNAPSHOT.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	... <span class="number">39</span> common frames omitted</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 Caused <span class="keyword">by: </span><span class="keyword">org.apache.ibatis.exceptions.PersistenceException: </span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### Error updating database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLTransactionRollbackException: Deadlock found when trying to get lock; try restarting transaction</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### The error may involve WarnFollowMapper.follow-Inline</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### The error occurred while setting parameters</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### SQL: insert into warn_follow (user_id, security_type, stock_code, exchange, stock_name, sub_fund_type, sort)         values (?, ?,  ?,                 ?,?, ?,                 (select max(IFNULL(t1.sort,0)) + 1 from WARN_FOLLOW t1 where t1.user_id = ?) )         on duplicate key update sort= (select max(IFNULL(t2.sort,0)) + 1 from warn_follow t2 where t2.user_id= ?)</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="comment">### Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLTransactionRollbackException: Deadlock found when trying to get lock; try restarting transaction</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">org.apache.ibatis.exceptions.ExceptionFactory.wrapException(ExceptionFactory.java:26) </span>~[mybatis-3.<span class="number">2</span>.<span class="number">8</span>.<span class="keyword">jar:3.2.8]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:154) </span>~[mybatis-3.<span class="number">2</span>.<span class="number">8</span>.<span class="keyword">jar:3.2.8]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:141) </span>~[mybatis-3.<span class="number">2</span>.<span class="number">8</span>.<span class="keyword">jar:3.2.8]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> hbec.platform.runtime.DbService.myInsert(DbService.<span class="keyword">java:2331) </span>~[hbec-platform-commons-0.<span class="number">0</span>.<span class="number">32</span>-SNAPSHOT.<span class="keyword">jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	... <span class="number">40</span> common frames omitted</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 Caused <span class="keyword">by: </span>com.mysql.<span class="keyword">jdbc.exceptions.jdbc4.MySQLTransactionRollbackException: </span>Deadlock found when trying to get lock<span class="comment">; try restarting transaction</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) ~[na:<span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_55]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.<span class="keyword">java:57) </span>~[na:<span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_55]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.<span class="keyword">java:45) </span>~[na:<span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_55]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">java.lang.reflect.Constructor.newInstance(Constructor.java:526) </span>~[na:<span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_55]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.mysql.<span class="keyword">jdbc.Util.handleNewInstance(Util.java:411) </span>~[mysql-connector-<span class="keyword">java-5.1.28.jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.mysql.<span class="keyword">jdbc.Util.getInstance(Util.java:386) </span>~[mysql-connector-<span class="keyword">java-5.1.28.jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.mysql.<span class="keyword">jdbc.SQLError.createSQLException(SQLError.java:1066) </span>~[mysql-connector-<span class="keyword">java-5.1.28.jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.mysql.<span class="keyword">jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:4237) </span>~[mysql-connector-<span class="keyword">java-5.1.28.jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.mysql.<span class="keyword">jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:4169) </span>~[mysql-connector-<span class="keyword">java-5.1.28.jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.mysql.<span class="keyword">jdbc.MysqlIO.sendCommand(MysqlIO.java:2617) </span>~[mysql-connector-<span class="keyword">java-5.1.28.jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.mysql.<span class="keyword">jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2778) </span>~[mysql-connector-<span class="keyword">java-5.1.28.jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.mysql.<span class="keyword">jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2825) </span>~[mysql-connector-<span class="keyword">java-5.1.28.jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.mysql.<span class="keyword">jdbc.PreparedStatement.executeInternal(PreparedStatement.java:2156) </span>~[mysql-connector-<span class="keyword">java-5.1.28.jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.mysql.<span class="keyword">jdbc.PreparedStatement.execute(PreparedStatement.java:1379) </span>~[mysql-connector-<span class="keyword">java-5.1.28.jar:na]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> sun.reflect.GeneratedMethodAccessor199.invoke(Unknown Source) ~[na:na]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.<span class="keyword">java:43) </span>~[na:<span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_55]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">java.lang.reflect.Method.invoke(Method.java:606) </span>~[na:<span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_55]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:62) </span>~[mybatis-3.<span class="number">2</span>.<span class="number">8</span>.<span class="keyword">jar:3.2.8]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> com.sun.proxy.$Proxy28.execute(Unknown Source) ~[na:na]</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:44) </span>~[mybatis-3.<span class="number">2</span>.<span class="number">8</span>.<span class="keyword">jar:3.2.8]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:69) </span>~[mybatis-3.<span class="number">2</span>.<span class="number">8</span>.<span class="keyword">jar:3.2.8]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:48) </span>~[mybatis-3.<span class="number">2</span>.<span class="number">8</span>.<span class="keyword">jar:3.2.8]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:105) </span>~[mybatis-3.<span class="number">2</span>.<span class="number">8</span>.<span class="keyword">jar:3.2.8]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:71) </span>~[mybatis-3.<span class="number">2</span>.<span class="number">8</span>.<span class="keyword">jar:3.2.8]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	<span class="built_in">at</span> <span class="keyword">org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:152) </span>~[mybatis-3.<span class="number">2</span>.<span class="number">8</span>.<span class="keyword">jar:3.2.8]</span></div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 	... <span class="number">42</span> common frames omitted</div><div class="line"><span class="keyword">Jul </span><span class="number">23</span> <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span> iZ2360o6lpyZ warn1 <span class="number">17</span>-07-23 <span class="number">17</span>:<span class="number">12</span>:<span class="number">50</span>.<span class="number">780</span> <span class="built_in">DEBUG</span>[DubboServerHandler-10.<span class="number">253</span>.<span class="number">17</span>.<span class="number">105</span>:<span class="number">20880</span>-thread-192 follow.debug:<span class="number">139</span>]MYBATIS &lt;==    Updates: <span class="number">2</span></div></pre></td></tr></table></figure>
<p>查看数据库引擎状态</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">show</span> <span class="keyword">engine</span> <span class="keyword">innodb</span> <span class="keyword">status</span></div></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">------------------------</div><div class="line">LATEST DETECTED DEADLOCK</div><div class="line">------------------------</div><div class="line"><span class="number">2017</span>-<span class="number">07</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">58</span> <span class="number">2</span>afc664c2700</div><div class="line">*** (<span class="number">1</span>) TRANSACTION:</div><div class="line">TRANSACTION <span class="number">730441984</span>, ACTIVE <span class="number">0.003</span> sec inserting</div><div class="line">mysql tables <span class="keyword">in</span> use <span class="number">3</span>, <span class="keyword">locked</span> <span class="number">3</span></div><div class="line">LOCK WAIT <span class="number">8</span> lock struct(s), heap size <span class="number">2936</span>, <span class="number">37</span> row lock(s), undo log entries <span class="number">1</span></div><div class="line">LOCK BLOCKING MySQL thread id: <span class="number">12246957</span> <span class="keyword">block</span> <span class="number">12256080</span></div><div class="line">MySQL thread id <span class="number">12256080</span>, OS thread handle <span class="number">0</span>x2afc48c40700, query id <span class="number">3543571324</span> <span class="number">10.253</span>.<span class="number">17.105</span> warn_app Sending data</div><div class="line">insert <span class="keyword">into</span> warn_follow (user_id, security_type, stock_code, exchange, stock_name, sub_fund_type, sort)</div><div class="line">        values (<span class="number">3245964</span>, <span class="number">4</span>,  <span class="string">'601318'</span>,</div><div class="line">                <span class="string">'SH'</span>,<span class="string">'中国平安'</span>, null,</div><div class="line">                (<span class="keyword">select</span> max(IFNULL(t1.sort,<span class="number">0</span>)) + <span class="number">1</span> <span class="keyword">from</span> WARN_FOLLOW t1 <span class="keyword">where</span> t1.user_id = <span class="number">3245964</span>) )</div><div class="line">        <span class="keyword">on</span> duplicate key update sort= (<span class="keyword">select</span> max(IFNULL(t2.sort,<span class="number">0</span>)) + <span class="number">1</span> <span class="keyword">from</span> warn_follow t2 <span class="keyword">where</span> t2.user_id= <span class="number">3245964</span>)</div><div class="line">*** (<span class="number">1</span>) WAITING <span class="keyword">FOR</span> THIS LOCK <span class="keyword">TO</span> BE GRANTED:</div><div class="line"><span class="keyword">RECORD</span> LOCKS space id <span class="number">1198</span> page no <span class="number">842</span> n bits <span class="number">696</span> <span class="keyword">index</span> `unique_index` <span class="keyword">of</span> table `wndb`.`warn_follow` trx id <span class="number">730441984</span> lock_mode X waiting</div><div class="line"><span class="keyword">Record</span> lock, heap no <span class="number">624</span> PHYSICAL <span class="keyword">RECORD</span>: n_fields <span class="number">4</span>; compact format; info bits <span class="number">0</span></div><div class="line"> <span class="number">0</span>: len <span class="number">4</span>; hex <span class="number">8031878</span>c; <span class="keyword">asc</span>  <span class="number">1</span>  ;;</div><div class="line"> <span class="number">1</span>: len <span class="number">1</span>; hex <span class="number">84</span>; <span class="keyword">asc</span>  ;;</div><div class="line"> <span class="number">2</span>: len <span class="number">6</span>; hex <span class="number">363031333138</span>; <span class="keyword">asc</span> <span class="number">601318</span>;;</div><div class="line"> <span class="number">3</span>: len <span class="number">4</span>; hex <span class="number">800399</span>cb; <span class="keyword">asc</span>     ;;</div><div class="line"></div><div class="line">*** (<span class="number">2</span>) TRANSACTION:</div><div class="line">TRANSACTION <span class="number">730441985</span>, ACTIVE <span class="number">0.001</span> sec inserting</div><div class="line">mysql tables <span class="keyword">in</span> use <span class="number">3</span>, <span class="keyword">locked</span> <span class="number">3</span></div><div class="line"><span class="number">8</span> lock struct(s), heap size <span class="number">2936</span>, <span class="number">37</span> row lock(s), undo log entries <span class="number">1</span></div><div class="line">MySQL thread id <span class="number">12246957</span>, OS thread handle <span class="number">0</span>x2afc664c2700, query id <span class="number">3543571329</span> <span class="number">10.253</span>.<span class="number">17.105</span> warn_app Sending data</div><div class="line">insert <span class="keyword">into</span> warn_follow (user_id, security_type, stock_code, exchange, stock_name, sub_fund_type, sort)</div><div class="line">        values (<span class="number">3245964</span>, <span class="number">4</span>,  <span class="string">'601318'</span>,</div><div class="line">                <span class="string">'SH'</span>,<span class="string">'中国平安'</span>, null,</div><div class="line">                (<span class="keyword">select</span> max(IFNULL(t1.sort,<span class="number">0</span>)) + <span class="number">1</span> <span class="keyword">from</span> WARN_FOLLOW t1 <span class="keyword">where</span> t1.user_id = <span class="number">3245964</span>) )</div><div class="line">        <span class="keyword">on</span> duplicate key update sort= (<span class="keyword">select</span> max(IFNULL(t2.sort,<span class="number">0</span>)) + <span class="number">1</span> <span class="keyword">from</span> warn_follow t2 <span class="keyword">where</span> t2.user_id= <span class="number">3245964</span>)</div><div class="line">*** (<span class="number">2</span>) HOLDS THE LOCK(S):</div><div class="line"><span class="keyword">RECORD</span> LOCKS space id <span class="number">1198</span> page no <span class="number">842</span> n bits <span class="number">696</span> <span class="keyword">index</span> `unique_index` <span class="keyword">of</span> table `wndb`.`warn_follow` trx id <span class="number">730441985</span> lock mode S locks rec but <span class="keyword">not</span> gap</div><div class="line"><span class="keyword">Record</span> lock, heap no <span class="number">624</span> PHYSICAL <span class="keyword">RECORD</span>: n_fields <span class="number">4</span>; compact format; info bits <span class="number">0</span></div><div class="line"> <span class="number">0</span>: len <span class="number">4</span>; hex <span class="number">8031878</span>c; <span class="keyword">asc</span>  <span class="number">1</span>  ;;</div><div class="line"> <span class="number">1</span>: len <span class="number">1</span>; hex <span class="number">84</span>; <span class="keyword">asc</span>  ;;</div><div class="line"> <span class="number">2</span>: len <span class="number">6</span>; hex <span class="number">363031333138</span>; <span class="keyword">asc</span> <span class="number">601318</span>;;</div><div class="line"> <span class="number">3</span>: len <span class="number">4</span>; hex <span class="number">800399</span>cb; <span class="keyword">asc</span>     ;;</div><div class="line"></div><div class="line">*** (<span class="number">2</span>) WAITING <span class="keyword">FOR</span> THIS LOCK <span class="keyword">TO</span> BE GRANTED:</div><div class="line"><span class="keyword">RECORD</span> LOCKS space id <span class="number">1198</span> page no <span class="number">842</span> n bits <span class="number">696</span> <span class="keyword">index</span> `unique_index` <span class="keyword">of</span> table `wndb`.`warn_follow` trx id <span class="number">730441985</span> lock_mode X waiting</div><div class="line"><span class="keyword">Record</span> lock, heap no <span class="number">624</span> PHYSICAL <span class="keyword">RECORD</span>: n_fields <span class="number">4</span>; compact format; info bits <span class="number">0</span></div><div class="line"> <span class="number">0</span>: len <span class="number">4</span>; hex <span class="number">8031878</span>c; <span class="keyword">asc</span>  <span class="number">1</span>  ;;</div><div class="line"> <span class="number">1</span>: len <span class="number">1</span>; hex <span class="number">84</span>; <span class="keyword">asc</span>  ;;</div><div class="line"> <span class="number">2</span>: len <span class="number">6</span>; hex <span class="number">363031333138</span>; <span class="keyword">asc</span> <span class="number">601318</span>;;</div><div class="line"> <span class="number">3</span>: len <span class="number">4</span>; hex <span class="number">800399</span>cb; <span class="keyword">asc</span>     ;;</div><div class="line"></div><div class="line">*** WE ROLL BACK TRANSACTION (<span class="number">2</span>)</div></pre></td></tr></table></figure>
<p>从中可以看到两个事务在等待X锁<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">WAITING FOR THIS <span class="keyword">LOCK</span> <span class="keyword">TO</span> BE GRANTED:</div><div class="line"><span class="built_in">RECORD</span> LOCKS <span class="keyword">space</span> <span class="keyword">id</span> <span class="number">1198</span> page <span class="keyword">no</span> <span class="number">842</span> n bits <span class="number">696</span> <span class="keyword">index</span> <span class="string">`unique_index`</span> <span class="keyword">of</span> <span class="keyword">table</span> <span class="string">`wndb`</span>.<span class="string">`warn_follow`</span> trx <span class="keyword">id</span> <span class="number">730441984</span> lock_mode X waiting</div><div class="line"><span class="built_in">Record</span> <span class="keyword">lock</span></div><div class="line"></div><div class="line">(<span class="number">2</span>) HOLDS THE <span class="keyword">LOCK</span>(S):</div><div class="line"><span class="built_in">RECORD</span> LOCKS <span class="keyword">space</span> <span class="keyword">id</span> <span class="number">1198</span> page <span class="keyword">no</span> <span class="number">842</span> n bits <span class="number">696</span> <span class="keyword">index</span> <span class="string">`unique_index`</span> <span class="keyword">of</span> <span class="keyword">table</span> <span class="string">`wndb`</span>.<span class="string">`warn_follow`</span> trx <span class="keyword">id</span> <span class="number">730441985</span> <span class="keyword">lock</span> <span class="keyword">mode</span> S locks rec but <span class="keyword">not</span> gap</div><div class="line"><span class="built_in">Record</span> <span class="keyword">lock</span>, <span class="keyword">heap</span> <span class="keyword">no</span> <span class="number">624</span> <span class="keyword">PHYSICAL</span> <span class="built_in">RECORD</span></div><div class="line"></div><div class="line">(<span class="number">2</span>) WAITING <span class="keyword">FOR</span> THIS <span class="keyword">LOCK</span> <span class="keyword">TO</span> BE GRANTED:</div><div class="line"><span class="built_in">RECORD</span> LOCKS <span class="keyword">space</span> <span class="keyword">id</span> <span class="number">1198</span> page <span class="keyword">no</span> <span class="number">842</span> n bits <span class="number">696</span> <span class="keyword">index</span> <span class="string">`unique_index`</span> <span class="keyword">of</span> <span class="keyword">table</span> <span class="string">`wndb`</span>.<span class="string">`warn_follow`</span> trx <span class="keyword">id</span> <span class="number">730441985</span> lock_mode X waiting</div><div class="line"><span class="built_in">Record</span> <span class="keyword">lock</span>, <span class="keyword">heap</span> <span class="keyword">no</span> <span class="number">624</span> <span class="keyword">PHYSICAL</span> <span class="built_in">RECORD</span></div></pre></td></tr></table></figure></p>
<h2 id="重现"><a href="#重现" class="headerlink" title="重现"></a>重现</h2><h3 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1.准备工作"></a>1.准备工作</h3><ul>
<li>同时开启三个command prompt，远程连接mysql服务器：mysql -uroc -proc -h10.0.30.59 wndb</li>
<li>关闭自动提交：set autocommit=0</li>
</ul>
<h3 id="2-模拟请求"><a href="#2-模拟请求" class="headerlink" title="2.模拟请求"></a>2.模拟请求</h3><p>Session A<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">begin</span>;</div><div class="line"></div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> warn_follow (user_id, security_type, stock_code, <span class="keyword">exchange</span>, stock_name, sub_fund_type, <span class="keyword">sort</span>) <span class="keyword">values</span> (<span class="number">3245964</span>, <span class="number">4</span>, <span class="string">'600628'</span>, <span class="string">'SH'</span>,<span class="string">'新世界'</span>, <span class="literal">null</span>, (<span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">IFNULL</span>(t1.sort,<span class="number">0</span>)) + <span class="number">1</span> <span class="keyword">from</span> WARN_FOLLOW t1 <span class="keyword">where</span> t1.user_id = <span class="number">3245964</span>) ) <span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span> <span class="keyword">sort</span>= (<span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">IFNULL</span>(t2.sort,<span class="number">0</span>)) + <span class="number">1</span> <span class="keyword">from</span> warn_follow t2 <span class="keyword">where</span> t2.user_id= <span class="number">3245964</span>);</div></pre></td></tr></table></figure></p>
<p>Session B<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">begin</span>;</div><div class="line"></div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> warn_follow (user_id, security_type, stock_code, <span class="keyword">exchange</span>, stock_name, sub_fund_type, <span class="keyword">sort</span>) <span class="keyword">values</span> (<span class="number">3245964</span>, <span class="number">4</span>, <span class="string">'600628'</span>, <span class="string">'SH'</span>,<span class="string">'新世界'</span>, <span class="literal">null</span>, (<span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">IFNULL</span>(t1.sort,<span class="number">0</span>)) + <span class="number">1</span> <span class="keyword">from</span> WARN_FOLLOW t1 <span class="keyword">where</span> t1.user_id = <span class="number">3245964</span>) ) <span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span> <span class="keyword">sort</span>= (<span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">IFNULL</span>(t2.sort,<span class="number">0</span>)) + <span class="number">1</span> <span class="keyword">from</span> warn_follow t2 <span class="keyword">where</span> t2.user_id= <span class="number">3245964</span>);</div></pre></td></tr></table></figure></p>
<p>Session C<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">begin</span>;</div><div class="line"></div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> warn_follow (user_id, security_type, stock_code, <span class="keyword">exchange</span>, stock_name, sub_fund_type, <span class="keyword">sort</span>) <span class="keyword">values</span> (<span class="number">3245964</span>, <span class="number">4</span>, <span class="string">'600628'</span>, <span class="string">'SH'</span>,<span class="string">'新世界'</span>, <span class="literal">null</span>, (<span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">IFNULL</span>(t1.sort,<span class="number">0</span>)) + <span class="number">1</span> <span class="keyword">from</span> WARN_FOLLOW t1 <span class="keyword">where</span> t1.user_id = <span class="number">3245964</span>) ) <span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span> <span class="keyword">sort</span>= (<span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">IFNULL</span>(t2.sort,<span class="number">0</span>)) + <span class="number">1</span> <span class="keyword">from</span> warn_follow t2 <span class="keyword">where</span> t2.user_id= <span class="number">3245964</span>);</div></pre></td></tr></table></figure></p>
<p>commit Session A，session B与session C竞争X锁，直接报错:</p>
<p><img src="http://olml6iu96.bkt.clouddn.com/%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98.png" alt="死锁"></p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>首先这是个添加操作，APP端不应该对同一用户、同一只股票执行多次并发添加操作<br>，APP端需要解决单设备、多并发问题。后台针对同一用户、同一股票的添加操作，需要使用分布式锁控制并发。</p>
]]></content>
    
    <summary type="html">
    
      Deadlock found when trying to get lock; try restarting transaction
    
    </summary>
    
      <category term="Mysql" scheme="https://roc-wong.github.io/categories/Mysql/"/>
    
    
      <category term="Mysql" scheme="https://roc-wong.github.io/tags/Mysql/"/>
    
  </entry>
  
  <entry>
    <title>micro-services</title>
    <link href="https://roc-wong.github.io/blog/2017/07/micro-services.html"/>
    <id>https://roc-wong.github.io/blog/2017/07/micro-services.html</id>
    <published>2017-07-21T12:11:00.000Z</published>
    <updated>2018-01-11T02:04:37.659Z</updated>
    
    <content type="html"><![CDATA[<p>微服务是一种架构风格，一个大型复杂软件应用由一个或多个微服务组成。系统中的各个微服务可被独立部署，各个微服务之间是松耦合的。每个微服务仅关注于完成一件任务并很好地完成该任务。在所有情况下，每个任务代表着一个小的业务能力。</p>
<a id="more"></a>
<p>MicroServices、Docker、SOA、Agile、Cloud、DevOps等等这类名词的最大特点就是： 一解释就懂，一问就不知，一讨论就打架。 </p>
<p><img src="http://ogu4xc937.bkt.clouddn.com/what-do-you-mean.png" alt="你再装逼我弄死你"></p>
<p>微服务是当前互联网业界的一个技术热点，可提到这个词，大家都有共同的疑问：</p>
<ul>
<li>一个微服务架构有哪些技术关注点(technical concerns)？</li>
<li>需要哪些基础框架或组件来支持微服务架构？</li>
<li>这些框架或组件该如何选型？</li>
</ul>
<p>本篇博客整理自</p>
<ul>
<li><a href="http://www.infoq.com/cn/articles/basis-frameworkto-implement-micro-service/" target="_blank" rel="external">实施微服务，我们需要哪些基础框架？</a></li>
<li><a href="https://www.ibm.com/developerworks/community/blogs/3302cc3b-074e-44da-90b1-5055f1dc0d9c/entry/%E8%A7%A3%E6%9E%90%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84_%E4%B8%80_%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1?lang=es" target="_blank" rel="external">解析微服务架构(一)：什么是微服务</a></li>
</ul>
<p>##服务注册、发现、负载均衡和健康检查</p>
<p>和单块(Monolithic)架构不同，微服务架构是由一系列职责单一的细粒度服务构成的分布式网状结构，服务之间通过轻量机制进行通信，这时候必然引入一个服务注册发现问题，也就是说服务提供方要注册通告服务地址，服务的调用方要能发现目标服务，同时服务提供方一般以集群方式提供服务，也就引入了负载均衡和健康检查问题。根据负载均衡LB所在位置的不同，目前主要的服务注册、发现和负载均衡方案有三种：</p>
<p>###第一种是集中式LB方案<br>如下图Fig 1，在服务消费者和服务提供者之间有一个独立的LB，LB通常是专门的硬件设备如F5，或者基于软件如LVS，HAproxy等实现。LB上有所有服务的地址映射表，通常由运维配置注册，当服务消费方调用某个目标服务时，它向LB发起请求，由LB以某种策略（比如Round-Robin）做负载均衡后将请求转发到目标服务。LB一般具备健康检查能力，能自动摘除不健康的服务实例。服务消费方如何发现LB呢？通常的做法是通过DNS，运维人员为服务配置一个DNS域名，这个域名指向LB。</p>
<p><img src="http://cdn4.infoqstatic.com/statics_s2_20170711-0402/resource/articles/basis-frameworkto-implement-micro-service/zh/resources/1125000.png" alt="集中式LB方案"> Fig 1, 集中式LB方案</p>
<p>集中式LB方案实现简单，在LB上也容易做集中式的访问控制，这一方案目前还是业界主流。集中式LB的主要问题是单点问题，所有服务调用流量都经过LB，当服务数量和调用量大的时候，LB容易成为瓶颈，且一旦LB发生故障对整个系统的影响是灾难性的。另外，LB在服务消费方和服务提供方之间增加了一跳(hop)，有一定性能开销。</p>
<p>###第二种是进程内LB方案<br>针对集中式LB的不足，进程内LB方案将LB的功能以库的形式集成到服务消费方进程里头，该方案也被称为软负载(Soft Load Balancing)或者客户端负载方案，下图Fig 2展示了这种方案的工作原理。这一方案需要一个服务注册表(Service Registry)配合支持服务自注册和自发现，服务提供方启动时，首先将服务地址注册到服务注册表（同时定期报心跳到服务注册表以表明服务的存活状态，相当于健康检查），服务消费方要访问某个服务时，它通过内置的LB组件向服务注册表查询（同时缓存并定期刷新）目标服务地址列表，然后以某种负载均衡策略选择一个目标服务地址，最后向目标服务发起请求。这一方案对服务注册表的可用性(Availability)要求很高，一般采用能满足高可用分布式一致的组件（例如Zookeeper, Consul, Etcd等）来实现。</p>
<p><img src="http://cdn4.infoqstatic.com/statics_s2_20170711-0402/resource/articles/basis-frameworkto-implement-micro-service/zh/resources/1125001.png" alt="进程内LB"><br>Fig 2, 进程内LB方案</p>
<p>进程内LB方案是一种分布式方案，LB和服务发现能力被分散到每一个服务消费者的进程内部，同时服务消费方和服务提供方之间是直接调用，没有额外开销，性能比较好。但是，该方案以客户库(Client Library)的方式集成到服务调用方进程里头，如果企业内有多种不同的语言栈，就要配合开发多种不同的客户端，有一定的研发和维护成本。另外，一旦客户端跟随服务调用方发布到生产环境中，后续如果要对客户库进行升级，势必要求服务调用方修改代码并重新发布，所以该方案的升级推广有不小的阻力。</p>
<p>进程内LB的案例是Netflix的开源服务框架，对应的组件分别是：Eureka服务注册表，Karyon服务端框架支持服务自注册和健康检查，Ribbon客户端框架支持服务自发现和软路由。另外，阿里开源的服务框架Dubbo也是采用类似机制。</p>
<p>###第三种是主机独立LB进程方案<br>该方案是针对第二种方案的不足而提出的一种折中方案，原理和第二种方案基本类似，不同之处是，他将LB和服务发现功能从进程内移出来，变成主机上的一个独立进程，主机上的一个或者多个服务要访问目标服务时，他们都通过同一主机上的独立LB进程做服务发现和负载均衡，见下图Fig 3。</p>
<p><img src="http://cdn4.infoqstatic.com/statics_s2_20170711-0402/resource/articles/basis-frameworkto-implement-micro-service/zh/resources/1125002.png" alt="独立LB进程方案"></p>
<p>Fig 3 主机独立LB进程方案</p>
<p>该方案也是一种分布式方案，没有单点问题，一个LB进程挂了只影响该主机上的服务调用方，服务调用方和LB之间是进程间调用，性能好，同时，该方案还简化了服务调用方，不需要为不同语言开发客户库，LB的升级不需要服务调用方改代码。该方案的不足是部署较复杂，环节多，出错调试排查问题不方便。</p>
<p>该方案的典型案例是Airbnb的SmartStack服务发现框架，对应组件分别是：Zookeeper作为服务注册表，Nerve独立进程负责服务注册和健康检查，Synapse/HAproxy独立进程负责服务发现和负载均衡。Google最新推出的基于容器的PaaS平台Kubernetes，其内部服务发现采用类似的机制。</p>
<p>##服务前端路由</p>
<p>微服务除了内部相互之间调用和通信之外，最终要以某种方式暴露出去，才能让外界系统（例如客户的浏览器、移动设备等等）访问到，这就涉及服务的前端路由，对应的组件是服务网关(Service Gateway)，见图Fig 4，网关是连接企业内部和外部系统的一道门，有如下关键作用：</p>
<ol>
<li>服务反向路由，网关要负责将外部请求反向路由到内部具体的微服务，这样虽然企业内部是复杂的分布式微服务结构，但是外部系统从网关上看到的就像是一个统一的完整服务，网关屏蔽了后台服务的复杂性，同时也屏蔽了后台服务的升级和变化。</li>
<li>安全认证和防爬虫，所有外部请求必须经过网关，网关可以集中对访问进行安全控制，比如用户认证和授权，同时还可以分析访问模式实现防爬虫功能，网关是连接企业内外系统的安全之门。</li>
<li>限流和容错，在流量高峰期，网关可以限制流量，保护后台系统不被大流量冲垮，在内部系统出现故障时，网关可以集中做容错，保持外部良好的用户体验。</li>
<li>监控，网关可以集中监控访问量，调用延迟，错误计数和访问模式，为后端的性能优化或者扩容提供数据支持。</li>
<li>日志，网关可以收集所有的访问日志，进入后台系统做进一步分析。</li>
</ol>
<p><img src="http://cdn2.infoqstatic.com/statics_s1_20170711-0402/resource/articles/basis-frameworkto-implement-micro-service/zh/resources/1125003.png" alt="图Fig 4"><br>Fig 4, 服务网关</p>
<p>除以上基本能力外，网关还可以实现线上引流，线上压测，线上调试(Surgical debugging)，金丝雀测试(Canary Testing)，数据中心双活(Active-Active HA)等高级功能。</p>
<p>网关通常工作在7层，有一定的计算逻辑，一般以集群方式部署，前置LB进行负载均衡。</p>
<p>开源的网关组件有Netflix的Zuul，特点是动态可热部署的过滤器(filter)机制，其它如HAproxy，Nginx等都可以扩展作为网关使用。</p>
<p>在介绍过服务注册表和网关等组件之后，我们可以通过一个简化的微服务架构图(Fig 5)来更加直观地展示整个微服务体系内的服务注册发现和路由机制，该图假定采用进程内LB服务发现和负载均衡机制。在下图Fig 5的微服务架构中，服务简化为两层，后端通用服务（也称中间层服务Middle Tier Service）和前端服务（也称边缘服务Edge Service，前端服务的作用是对后端服务做必要的聚合和裁剪后暴露给外部不同的设备，如PC，Pad或者Phone）。后端服务启动时会将地址信息注册到服务注册表，前端服务通过查询服务注册表就可以发现然后调用后端服务；前端服务启动时也会将地址信息注册到服务注册表，这样网关通过查询服务注册表就可以将请求路由到目标前端服务，这样整个微服务体系的服务自注册自发现和软路由就通过服务注册表和网关串联起来了。如果以面向对象设计模式的视角来看，网关类似Proxy代理或者Façade门面模式，而服务注册表和服务自注册自发现类似IoC依赖注入模式，微服务可以理解为基于网关代理和注册表IoC构建的分布式系统。</p>
<p><img src="http://cdn2.infoqstatic.com/statics_s1_20170711-0402/resource/articles/basis-frameworkto-implement-micro-service/zh/resources/1125004.png" alt="Fig 5"><br>Fig 5, 简化的微服务架构图</p>
<p>##服务容错</p>
<p>当企业微服务化以后，服务之间会有错综复杂的依赖关系，例如，一个前端请求一般会依赖于多个后端服务，技术上称为1 -&gt; N扇出(见图Fig 6)。在实际生产环境中，服务往往不是百分百可靠，服务可能会出错或者产生延迟，如果一个应用不能对其依赖的故障进行容错和隔离，那么该应用本身就处在被拖垮的风险中。在一个高流量的网站中，某个单一后端一旦发生延迟，可能在数秒内导致所有应用资源(线程，队列等)被耗尽，造成所谓的雪崩效应(Cascading Failure，见图Fig 7)，严重时可致整个网站瘫痪。</p>
<p>Fig 6, 服务依赖<img src="http://cdn2.infoqstatic.com/statics_s1_20170711-0402/resource/articles/basis-frameworkto-implement-micro-service/zh/resources/1125005.png" alt="图Fig 6"></p>
<p>Fig 7, 高峰期单个服务延迟致雪崩效应 <img src="http://cdn2.infoqstatic.com/statics_s1_20170711-0402/resource/articles/basis-frameworkto-implement-micro-service/zh/resources/1125006.png" alt="图Fig 7"></p>
<p>经过多年的探索和实践，业界在分布式服务容错一块探索出了一套有效的容错模式和最佳实践，主要包括：</p>
<ol>
<li><p>电路熔断器模式(Circuit Breaker Patten), 该模式的原理类似于家里的电路熔断器，如果家里的电路发生短路，熔断器能够主动熔断电路，以避免灾难性损失。在分布式系统中应用电路熔断器模式后，当目标服务慢或者大量超时，调用方能够主动熔断，以防止服务被进一步拖垮；如果情况又好转了，电路又能自动恢复，这就是所谓的弹性容错，系统有自恢复能力。下图Fig 8是一个典型的具备弹性恢复能力的电路保护器状态图，正常状态下，电路处于关闭状态(Closed)，如果调用持续出错或者超时，电路被打开进入熔断状态(Open)，后续一段时间内的所有调用都会被拒绝(Fail Fast)，一段时间以后，保护器会尝试进入半熔断状态(Half-Open)，允许少量请求进来尝试，如果调用仍然失败，则回到熔断状态，如果调用成功，则回到电路闭合状态。<br>Fig 8, 弹性电路保护状态图 <img src="http://cdn2.infoqstatic.com/statics_s1_20170711-0402/resource/articles/basis-frameworkto-implement-micro-service/zh/resources/1125007.png" alt="图Fig 8"></p>
</li>
<li><p>舱壁隔离模式(Bulkhead Isolation Pattern)，顾名思义，该模式像舱壁一样对资源或失败单元进行隔离，如果一个船舱破了进水，只损失一个船舱，其它船舱可以不受影响 。线程隔离(Thread Isolation)就是舱壁隔离模式的一个例子，假定一个应用程序A调用了Svc1/Svc2/Svc3三个服务，且部署A的容器一共有120个工作线程，采用线程隔离机制，可以给对Svc1/Svc2/Svc3的调用各分配40个线程，当Svc2慢了，给Svc2分配的40个线程因慢而阻塞并最终耗尽，线程隔离可以保证给Svc1/Svc3分配的80个线程可以不受影响，如果没有这种隔离机制，当Svc2慢的时候，120个工作线程会很快全部被对Svc2的调用吃光，整个应用程序会全部慢下来。</p>
</li>
<li>限流(Rate Limiting/Load Shedder)，服务总有容量限制，没有限流机制的服务很容易在突发流量(秒杀，双十一)时被冲垮。限流通常指对服务限定并发访问量，比如单位时间只允许100个并发调用，对超过这个限制的请求要拒绝并回退。</li>
<li>回退(fallback)，在熔断或者限流发生的时候，应用程序的后续处理逻辑是什么？回退是系统的弹性恢复能力，常见的处理策略有，直接抛出异常，也称快速失败(Fail Fast)，也可以返回空值或缺省值，还可以返回备份数据，如果主服务熔断了，可以从备份服务获取数据。</li>
</ol>
<p>Netflix将上述容错模式和最佳实践集成到一个称为Hystrix的开源组件中，凡是需要容错的依赖点(服务，缓存，数据库访问等)，开发人员只需要将调用封装在Hystrix Command里头，则相关调用就自动置于Hystrix的弹性容错保护之下。Hystrix组件已经在Netflix经过多年运维验证，是Netflix微服务平台稳定性和弹性的基石，正逐渐被社区接受为标准容错组件。</p>
<p>服务框架</p>
<p>微服务化以后，为了让业务开发人员专注于业务逻辑实现，避免冗余和重复劳动，规范研发提升效率，必然要将一些公共关注点推到框架层面。服务框架(Fig 9)主要封装公共关注点逻辑，包括：</p>
<p><img src="http://cdn2.infoqstatic.com/statics_s1_20170711-0402/resource/articles/basis-frameworkto-implement-micro-service/zh/resources/1125008.png" alt="Fig 9"><br>Fig 9, 服务框架</p>
<ol>
<li>服务注册、发现、负载均衡和健康检查，假定采用进程内LB方案，那么服务自注册一般统一做在服务器端框架中，健康检查逻辑由具体业务服务定制，框架层提供调用健康检查逻辑的机制，服务发现和负载均衡则集成在服务客户端框架中。</li>
<li>监控日志，框架一方面要记录重要的框架层日志、metrics和调用链数据，还要将日志、metrics等接口暴露出来，让业务层能根据需要记录业务日志数据。在运行环境中，所有日志数据一般集中落地到企业后台日志系统，做进一步分析和处理。</li>
<li>REST/RPC和序列化，框架层要支持将业务逻辑以HTTP/REST或者RPC方式暴露出来，HTTP/REST是当前主流API暴露方式，在性能要求高的场合则可采用Binary/RPC方式。针对当前多样化的设备类型(浏览器、普通PC、无线设备等)，框架层要支持可定制的序列化机制，例如，对浏览器，框架支持输出Ajax友好的JSON消息格式，而对无线设备上的Native App，框架支持输出性能高的Binary消息格式。</li>
<li>配置，除了支持普通配置文件方式的配置，框架层还可集成动态运行时配置，能够在运行时针对不同环境动态调整服务的参数和配置。</li>
<li>限流和容错，框架集成限流容错组件，能够在运行时自动限流和容错，保护服务，如果进一步和动态配置相结合，还可以实现动态限流和熔断。</li>
<li>管理接口，框架集成管理接口，一方面可以在线查看框架和服务内部状态，同时还可以动态调整内部状态，对调试、监控和管理能提供快速反馈。Spring Boot微框架的Actuator模块就是一个强大的管理接口。</li>
<li>统一错误处理，对于框架层和服务的内部异常，如果框架层能够统一处理并记录日志，对服务监控和快速问题定位有很大帮助。</li>
<li>安全，安全和访问控制逻辑可以在框架层统一进行封装，可做成插件形式，具体业务服务根据需要加载相关安全插件。</li>
<li>文档自动生成，文档的书写和同步一直是一个痛点，框架层如果能支持文档的自动生成和同步，会给使用API的开发和测试人员带来极大便利。Swagger是一种流行Restful API的文档方案。<br>当前业界比较成熟的微服务框架有Netflix的Karyon/Ribbon，Spring的Spring Boot/Cloud，阿里的Dubbo等。</li>
</ol>
<p>##运行期配置管理</p>
<p>服务一般有很多依赖配置，例如访问数据库有连接字符串配置，连接池大小和连接超时配置，这些配置在不同环境(开发/测试/生产)一般不同，比如生产环境需要配连接池，而开发测试环境可能不配，另外有些参数配置在运行期可能还要动态调整，例如，运行时根据流量状况动态调整限流和熔断阀值。目前比较常见的做法是搭建一个运行时配置中心支持微服务的动态配置，简化架构如下图(Fig 10):<br><img src="http://cdn2.infoqstatic.com/statics_s1_20170711-0402/resource/articles/basis-frameworkto-implement-micro-service/zh/resources/1125009.png" alt="简化架构"><br>Fig 10, 服务配置中心</p>
<p>动态配置存放在集中的配置服务器上，用户通过管理界面配置和调整服务配置，具体服务通过定期拉(Scheduled Pull)的方式或者服务器推(Server-side Push)的方式更新动态配置，拉方式比较可靠，但会有延迟同时有无效网络开销(假设配置不常更新)，服务器推方式能及时更新配置，但是实现较复杂，一般在服务和配置服务器之间要建立长连接。配置中心还要解决配置的版本控制和审计问题，对于大规模服务化环境，配置中心还要考虑分布式和高可用问题。</p>
<p>配置中心比较成熟的开源方案有百度的Disconf，360的QConf，Spring的Cloud Config和阿里的Diamond等。</p>
<p><strong>Netflix的微服务框架</strong><br>Netflix是一家成功实践微服务架构的互联网公司，几年前，Netflix就把它的几乎整个微服务框架栈开源贡献给了社区，这些框架和组件包括：</p>
<ul>
<li>Eureka:　服务注册发现框架</li>
<li>Zuul:　服务网关</li>
<li>Karyon:　服务端框架</li>
<li>Ribbon:　客户端框架</li>
<li>Hystrix: 服务容错组件</li>
<li>Archaius: 服务配置组件</li>
<li>Servo: Metrics组件</li>
<li>Blitz4j: 日志组件</li>
</ul>
<p>下图Fig 11展示了基于这些组件构建的一个微服务框架体系，来自recipes-rss。<br><img src="http://cdn2.infoqstatic.com/statics_s1_20170711-0402/resource/articles/basis-frameworkto-implement-micro-service/zh/resources/1125010.png" alt="基于Netflix开源组件的微服务框架"></p>
<p>Fig 11, 基于Netflix开源组件的微服务框架</p>
<p>Netflix的开源框架组件已经在Netflix的大规模分布式微服务环境中经过多年的生产实战验证，正逐步被社区接受为构造微服务框架的标准组件。Pivotal去年推出的Spring Cloud开源产品，主要是基于对Netflix开源组件的进一步封装，方便Spring开发人员构建微服务基础框架。对于一些打算构建微服务框架体系的公司来说，充分利用或参考借鉴Netflix的开源微服务组件(或Spring Cloud)，在此基础上进行必要的企业定制，无疑是通向微服务架构的捷径。</p>
]]></content>
    
    <summary type="html">
    
      微服务的目的是有效的拆分应用，实现敏捷开发和部署 。
    
    </summary>
    
      <category term="MicroServices" scheme="https://roc-wong.github.io/categories/MicroServices/"/>
    
    
      <category term="微服务" scheme="https://roc-wong.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>腹肌锻炼</title>
    <link href="https://roc-wong.github.io/blog/2017/06/abs-exercises.html"/>
    <id>https://roc-wong.github.io/blog/2017/06/abs-exercises.html</id>
    <published>2017-06-09T11:54:08.000Z</published>
    <updated>2018-01-11T02:04:04.728Z</updated>
    
    <content type="html"><![CDATA[<p>健身是一个循序渐进的过程，不要想一天就成为你心中的那个偶像，需要持久坚持和努力。腹肌训练更是如此，想要减脂塑形、梦想拥有完美身材的男女，不妨一起来试练下面一组动作，提示各位要按照顺序完成训练量。</p>
<a id="more"></a>
<p>动作一、60个开合跳，连续进行；</p>
<p><img src="http://p3.pstatp.com/large/52e0008ccb2085c2c0b" alt=""></p>
<p>动作二、40个仰卧交替收膝，动作要到位；</p>
<p><img src="http://p3.pstatp.com/large/52e0008ccb0f1ac2a38" alt=""></p>
<p>动作三、10~15个仰卧起坐；</p>
<p><img src="http://p3.pstatp.com/large/52d0008cd209da95902" alt=""></p>
<p>动作四、看到Z没有，20个凳(Z)上反屈伸；</p>
<p><img src="http://p1.pstatp.com/large/52e0008ccb14d565f3c" alt=""></p>
<p>动作五、按照下方示范动作，左右各20个侧步蹲；</p>
<p><img src="http://p1.pstatp.com/large/5b100007798d8ceeb44" alt=""></p>
<p>动作六、同动作三，俯卧撑10~15个；</p>
<p><img src="http://p3.pstatp.com/large/5b100007799ddf0815e" alt=""></p>
<p>动作七、有没有经常见到这个动作呢？仰卧举腿20个；</p>
<p><img src="http://p9.pstatp.com/large/5b10000779a9f79ffda" alt=""></p>
<p>动作八、30个高抬腿走起 ；</p>
<p><img src="http://p3.pstatp.com/large/52d0008cd211e4c9755" alt=""></p>
<p>动作九、深蹲跳 10个就够了；</p>
<p><img src="http://p3.pstatp.com/large/5b10000779b4ab8800a" alt=""></p>
<p>动作十、平板支撑60秒！哦，一分钟 ；</p>
<p><img src="http://p1.pstatp.com/large/52c0008ca6fd187a7c4" alt=""></p>
<p>附带视频一个：<a href="http://www.toutiao.com/i6263916207875817985/" target="_blank" rel="external">click me</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;健身是一个循序渐进的过程，不要想一天就成为你心中的那个偶像，需要持久坚持和努力。腹肌训练更是如此，想要减脂塑形、梦想拥有完美身材的男女，不妨一起来试练下面一组动作，提示各位要按照顺序完成训练量。&lt;/p&gt;
    
    </summary>
    
      <category term="健身" scheme="https://roc-wong.github.io/categories/%E5%81%A5%E8%BA%AB/"/>
    
    
      <category term="健身 腹肌" scheme="https://roc-wong.github.io/tags/%E5%81%A5%E8%BA%AB-%E8%85%B9%E8%82%8C/"/>
    
  </entry>
  
  <entry>
    <title>maven-war-plugin</title>
    <link href="https://roc-wong.github.io/blog/2017/04/maven-war-plugin.html"/>
    <id>https://roc-wong.github.io/blog/2017/04/maven-war-plugin.html</id>
    <published>2017-04-25T14:06:59.000Z</published>
    <updated>2018-01-11T02:04:43.692Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Apache-Maven-WAR-Plugin"><a href="#Apache-Maven-WAR-Plugin" class="headerlink" title="Apache Maven WAR Plugin"></a>Apache Maven WAR Plugin</h2><p>The WAR Plugin is responsible for collecting all artifact dependencies, classes and resources of the web application and packaging them into a web application archive.</p>
<p>“打包“这个词听起来比较土，比较正式的说法应该是”构建项目软件包“，具体说就是将项目中的各种文件，比如源代码、编译生成的字节码、配置文件、文档，按照规范的格式生成归档，最常见的当然就是JAR包和WAR包了，复杂点的例子是Maven官方下载页面的分发包，它有自定义的格式，方便用户直接解压后就在命令行使用。作为一款”打包工具“，Maven自然有义务帮助用户创建各种各样的包，规范的JAR包和WAR包自然不再话下，略微复杂的自定义打包格式也必须支持，本文就介绍一些常用的打包案例以及相关的实现方式，除了前面提到的一些包以外，你还能看到如何生成源码包、Javadoc包、以及从命令行可直接运行的CLI包。</p>
<a id="more"></a>
<p>任何一个Maven项目都需要定义POM元素packaging（如果不写则默认值为jar）。顾名思义，该元素决定了项目的打包方式。实际的情形中，如果你不声明该元素，Maven会帮你生成一个JAR包；如果你定义该元素的值为war，那你会得到一个WAR包；如果定义其值为POM（比如是一个父模块），那什么包都不会生成。除此之外，Maven默认还支持一些其他的流行打包格式，例如ejb3和ear。你不需要了解具体的打包细节，你所需要做的就是告诉Maven，”我是个什么类型的项目“，这就是约定优于配置的力量。</p>
<p>对应于同样的package生命周期阶段，Maven为jar项目调用了maven-jar-plugin，为war项目调用了maven-war-plugin，换言之，packaging直接影响Maven的构建生命周期。了解这一点非常重要，特别是当你需要自定义打包行为的时候，你就必须知道去配置哪个插件。</p>
<h2 id="war-plugin的常用配置参数"><a href="#war-plugin的常用配置参数" class="headerlink" title="war plugin的常用配置参数"></a>war plugin的常用配置参数</h2><h3 id="archiveClasses配置项"><a href="#archiveClasses配置项" class="headerlink" title="archiveClasses配置项"></a>archiveClasses配置项</h3><p>该配置的值为true|false，默认是false。表示是否将class进行打包。<br>正常情况下war类型的工程，java代码编译后的类文件会放到WEB-INF/classes目录下面，散装。 当该参数配置为true时，会将所有的class打包为一个jar，jar的名字与war的名字一致（除了后缀）。然后把这个jar放到WEB-INF/lib目录下，此时WEB-INF/classes目录下是空的。</p>
<h3 id="attachClasses配置项"><a href="#attachClasses配置项" class="headerlink" title="attachClasses配置项"></a>attachClasses配置项</h3><p>该配置的值为true|false，默认是false。表示在发布war包的时候是否同时发布一个jar包（只有classes，不包含页面相关文件）。<br>正常情况下war类型的工程，当我们执行install或者deploy的时候build出一个war包，安装到本地或者发布到远程。<br>当该参数配置为true时，除了war包外还会多出一个jar包，不过该jar包的classifier默认为classes。</p>
<h3 id="overlays配置节点"><a href="#overlays配置节点" class="headerlink" title="overlays配置节点"></a>overlays配置节点</h3><p>overlays配置的作用是，将指定war包中的内容与当前项目进行合并。合并策略：如果存在同名冲突，则使用当前项目中的文件。 overlay的具体配置项（include|exclude）可以指定包含或者排除特定模式的文件。</p>
<h2 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h2><h3 id="多war合并"><a href="#多war合并" class="headerlink" title="多war合并"></a>多war合并</h3><p>archiveClasses和attachClasses参数可以同时配置为true。此时打包文件中含有lib，不含classes。发布时会同时发布classifier为classes的jar包。</p>
<p>如果当前工程A需要从B工程的war包中合入页面文件，同时代码中也要使用B的类文件。工程B包含配置如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">attachClasses</span>&gt;</span>true<span class="tag">&lt;/<span class="name">attachClasses</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>工程A包含配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>groupB<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>B<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>classes<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>groupB<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>B<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">type</span>&gt;</span>war<span class="tag">&lt;/<span class="name">type</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                  <span class="tag">&lt;<span class="name">overlays</span>&gt;</span></div><div class="line">                      <span class="tag">&lt;<span class="name">overlay</span>&gt;</span></div><div class="line">                          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>groupB<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>B<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                      <span class="tag">&lt;/<span class="name">overlay</span>&gt;</span></div><div class="line">                  <span class="tag">&lt;/<span class="name">overlays</span>&gt;</span></div><div class="line">              <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>可注意如果同名的文件夹会进行合并，不合并空文件夹。</p>
</blockquote>
<h3 id="把class文件打包成jar，怎么排除resources目录"><a href="#把class文件打包成jar，怎么排除resources目录" class="headerlink" title="把class文件打包成jar，怎么排除resources目录?"></a>把class文件打包成jar，怎么排除resources目录?</h3><p>正常情况下war类型的工程，java代码编译后的类文件会放到WEB-INF/classes目录下面，散装。 当archiveClasses参数配置为true时，会将所有的class打包为一个jar，jar的名字与war的名字一致。然后把这个jar放到WEB-INF/lib目录下，此时WEB-INF/classes目录下是空的，但如果想在war包的WEB-INF/classes中保留logback.xml配置文件，该怎么做？</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="params">&lt;plugin&gt;</span></div><div class="line">    <span class="params">&lt;artifactId&gt;</span>maven-war-plugin<span class="params">&lt;/artifactId&gt;</span></div><div class="line">    <span class="params">&lt;version&gt;</span><span class="number">3.0</span><span class="number">.0</span><span class="params">&lt;/version&gt;</span></div><div class="line">    <span class="params">&lt;configuration&gt;</span></div><div class="line">        <span class="params">&lt;archiveClasses&gt;</span>true<span class="params">&lt;/archiveClasses&gt;</span></div><div class="line">        <span class="params">&lt;webResources&gt;</span></div><div class="line">            <span class="params">&lt;resource&gt;</span></div><div class="line">                <span class="params">&lt;directory&gt;</span>src<span class="meta-keyword">/main/</span>resources<span class="params">&lt;/directory&gt;</span></div><div class="line">                <span class="params">&lt;targetPath&gt;</span>WEB-INF/classes<span class="params">&lt;/targetPath&gt;</span></div><div class="line">                <span class="params">&lt;filtering&gt;</span>true<span class="params">&lt;/filtering&gt;</span></div><div class="line">            <span class="params">&lt;/resource&gt;</span></div><div class="line">        <span class="params">&lt;/webResources&gt;</span></div><div class="line">    <span class="params">&lt;/configuration&gt;</span></div><div class="line"><span class="params">&lt;/plugin&gt;</span></div></pre></td></tr></table></figure>
<h3 id="对项目进行动态打包，不同的环境使用不同的配置文件打包"><a href="#对项目进行动态打包，不同的环境使用不同的配置文件打包" class="headerlink" title="对项目进行动态打包，不同的环境使用不同的配置文件打包"></a>对项目进行动态打包，不同的环境使用不同的配置文件打包</h3><h4 id="demo-1"><a href="#demo-1" class="headerlink" title="demo 1"></a>demo 1</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">project/</div><div class="line">`-- src</div><div class="line">    |<span class="string">-- main</span></div><div class="line">    |<span class="string">   </span>|<span class="string">-- java</span></div><div class="line">    |<span class="string">   </span>|<span class="string">-- resources</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- local</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- logback.xml</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- spring-dataSource.xml</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   `-- variable.propertes</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- product</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- logback.xml</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- spring-dataSource.xml</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   `-- variable.propertes</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   `-- qa</span></div><div class="line">    |<span class="string">   </span>|<span class="string">       </span>|<span class="string">-- logback.xml</span></div><div class="line">    |<span class="string">   </span>|<span class="string">       </span>|<span class="string">-- spring-dataSource.xml</span></div><div class="line">    |<span class="string">   </span>|<span class="string">       `-- variable.propertes</span></div><div class="line">    |<span class="string">   </span>|<span class="string">-- webapp</span></div><div class="line">    `-- test</div></pre></td></tr></table></figure>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">maven <span class="keyword">package</span> <span class="title">–P local   开发环境</span></div><div class="line">maven <span class="keyword">package</span> <span class="title">–P product  生产环境</span></div></pre></td></tr></table></figure>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>local<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">package.environment</span>&gt;</span>local<span class="tag">&lt;/<span class="name">package.environment</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>product<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">package.environment</span>&gt;</span>product<span class="tag">&lt;/<span class="name">package.environment</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- class文件打包成jar包，排除相关配置文件和jrebel配置文件 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>local/*<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>product/*<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>rebel.xml<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 区别dev环境与生产环境logback.xml配置 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">archiveClasses</span>&gt;</span>true<span class="tag">&lt;/<span class="name">archiveClasses</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">failOnMissingWebXml</span>&gt;</span>false<span class="tag">&lt;/<span class="name">failOnMissingWebXml</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">webResources</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources/$<span class="template-variable">&#123;package.environment&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span></div><div class="line">                        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>WEB-INF/classes<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">webResources</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>default-jar<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="demo-2"><a href="#demo-2" class="headerlink" title="demo 2"></a>demo 2</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">project/</div><div class="line">`-- src</div><div class="line">    |<span class="string">-- main</span></div><div class="line">    |<span class="string">   </span>|<span class="string">-- java</span></div><div class="line">    |<span class="string">   </span>|<span class="string">-- env</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- dev</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- log4j.properties</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- spring-dataSource.xml</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   `-- variable.propertes</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- prod</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- log4j.properties</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   </span>|<span class="string">-- spring-dataSource.xml</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   </span>|<span class="string">   `-- variable.propertes</span></div><div class="line">    |<span class="string">   </span>|<span class="string">   `-- qa</span></div><div class="line">    |<span class="string">   </span>|<span class="string">       </span>|<span class="string">-- log4j.properties</span></div><div class="line">    |<span class="string">   </span>|<span class="string">       </span>|<span class="string">-- spring-dataSource.xml</span></div><div class="line">    |<span class="string">   </span>|<span class="string">       `-- variable.propertes</span></div><div class="line">    |<span class="string">   </span>|<span class="string">-- resources</span></div><div class="line">    |<span class="string">   `-- webapp</span></div><div class="line">    `-- test</div></pre></td></tr></table></figure>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mvn clean <span class="keyword">package</span> <span class="title">-P dev</span></div><div class="line">mvn clean <span class="keyword">package</span> <span class="title">-P qa</span></div></pre></td></tr></table></figure>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span></div><div class="line">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>webapp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webapp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">scm</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">connection</span>&gt;</span>scm:svn:http://127.0.0.1/dummy<span class="tag">&lt;/<span class="name">connection</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span>scm:svn:https://127.0.0.1/dummy<span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tag</span>&gt;</span>HEAD<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://127.0.0.1/dummy<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">scm</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">spring-version</span>&gt;</span>3.1.0.RELEASE<span class="tag">&lt;/<span class="name">spring-version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$<span class="template-variable">&#123;final.name&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">overlays</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">overlay</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>TransactionResource<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>TransactionResource<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></div><div class="line">                                <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>WEB-INF/web.xml<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">overlay</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">overlays</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">webResources</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$<span class="template-variable">&#123;runtime.env&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span></div><div class="line">                            <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>WEB-INF/classes<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">webResources</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">        ……</div><div class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">activation</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">runtime.env</span>&gt;</span>src/main/env/dev<span class="tag">&lt;/<span class="name">runtime.env</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">final.name</span>&gt;</span>webapp<span class="tag">&lt;/<span class="name">final.name</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.eightqiu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>CodeCmns<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>qa<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">runtime.env</span>&gt;</span>src/main/env/qa<span class="tag">&lt;/<span class="name">runtime.env</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">final.name</span>&gt;</span>webapp_$<span class="template-variable">&#123;buildNumber&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">final.name</span>&gt;</span></span></div><div class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>buildnumber-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">                                <span class="tag">&lt;<span class="name">phase</span>&gt;</span>validate<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">                                <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">                                    <span class="tag">&lt;<span class="name">goal</span>&gt;</span>create<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">                                <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">format</span>&gt;</span><span class="template-variable">&#123;0,date,yyyyMMdd&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">format</span>&gt;</span></span></div><div class="line">                            <span class="tag">&lt;<span class="name">items</span>&gt;</span></div><div class="line">                                <span class="tag">&lt;<span class="name">item</span>&gt;</span>timestamp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;/<span class="name">items</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">reporting</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.eightqiu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>CodeCmns<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">runtime.env</span>&gt;</span>src/main/env/prod<span class="tag">&lt;/<span class="name">runtime.env</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">final.name</span>&gt;</span>webapp<span class="tag">&lt;/<span class="name">final.name</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.eightqiu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>CodeCmns<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      maven war plugin
    
    </summary>
    
      <category term="Maven" scheme="https://roc-wong.github.io/categories/Maven/"/>
    
    
      <category term="Maven" scheme="https://roc-wong.github.io/tags/Maven/"/>
    
      <category term="maven war plugin" scheme="https://roc-wong.github.io/tags/maven-war-plugin/"/>
    
  </entry>
  
  <entry>
    <title>maven-paranamer-plugin</title>
    <link href="https://roc-wong.github.io/blog/2017/04/maven-paranamer-plugin.html"/>
    <id>https://roc-wong.github.io/blog/2017/04/maven-paranamer-plugin.html</id>
    <published>2017-04-25T13:16:55.000Z</published>
    <updated>2018-01-11T02:04:00.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="What-is-it"><a href="#What-is-it" class="headerlink" title="What is it?"></a>What is it?</h2><p>It is a library that allows the parameter names of non-private methods and constructors to be accessed at runtime. Normally this information is dropped by the compiler. In effect, methods like doSometing(mypkg.Person toMe) currently look like doSomething(mypackage.Person ???) to people using Java’s reflection to inspect methods.</p>
<p>项目主页：<a href="https://github.com/paul-hammant/paranamer" target="_blank" rel="external">https://github.com/paul-hammant/paranamer</a></p>
<a id="more"></a>
<h2 id="如何在运行时获取java方法参数名称"><a href="#如何在运行时获取java方法参数名称" class="headerlink" title="如何在运行时获取java方法参数名称?"></a>如何在运行时获取java方法参数名称?</h2><ol>
<li>由于jdk的反射方式，未提供获取参数名的方法</li>
<li>Java的字节码文件默认不存储参数名称。在使用javac编译时，如果开启-g:{vars}选项，可以增加Local variable debugging information。对java方法，参数实际是按照局部变量来存储的，所以可以获取参数名称；但对于java接口中的方法声明，这种方法就无法获取参数名称。</li>
</ol>
<p>Paranamer专门用来解决获取参数名的问题。其原理是在编译阶段，修改.class文件，在类或接口的字节码文件中增加一个字符串常量，这个常量保存了所有的方法声明信息，包括方法名、参数类型、参数名称。这样在运行时，class loader加载类文件以后，使用Paranamer的api去读取这个字符串，就可以获取参数名称。加上java反射，实际上可以把源代码重现出来。</p>
<p>这个工具可以用来实现代码生成器。其缺点在于，它需要修改源项目的build步骤。据其项目主页说明，Java 8已经加入存储参数名称的功能。</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// MySomethingOrOther.java**</span></div><div class="line"><span class="function"><span class="keyword">Method</span> <span class="title">method</span> = <span class="title">Foo</span>.<span class="title">class</span>.<span class="title">getMethod</span><span class="params">(...)</span>;</span></div><div class="line"></div><div class="line">Paranamer paranamer = <span class="keyword">new</span> CachingParanamer();</div><div class="line"></div><div class="line">String[] parameterNames = paranamer.lookupParameterNames(<span class="function"><span class="keyword">method</span>) // <span class="title">throws</span> <span class="title">ParameterNamesNotFoundException</span> <span class="title">if</span> <span class="title">not</span> <span class="title">found</span></span></div><div class="line"></div><div class="line">// <span class="title">or</span>:</div><div class="line"></div><div class="line">parameterNames = paranamer.lookupParameterNames(<span class="function"><span class="keyword">method</span>, <span class="title">false</span>) // <span class="title">will</span> <span class="title">return</span> <span class="title">null</span> <span class="title">if</span> <span class="title">not</span> <span class="title">found</span></span></div></pre></td></tr></table></figure>
<h2 id="踩过的坑"><a href="#踩过的坑" class="headerlink" title="踩过的坑"></a>踩过的坑</h2><p>需求：通过java的反射获取method，使用paranamer获取method的参数名称。<br>诡异之处：使用Paranamer paranamer = new CachingParanamer()l.ookupParameterNames(method);无法正常获取方法的变量名称。</p>
<p>一个简单的java类，<strong>请注意使用了import .* 的方式</strong></p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">package hbec.commons.services.stock.controller;</div><div class="line"></div><div class="line"><span class="keyword">import</span> hbec.commons.domain.stock.condition.dto.*;</div><div class="line"><span class="keyword">import</span> hbec.commons.domain.stock.vo.*;</div><div class="line"><span class="keyword">import</span> hbec.exception.portal.HbecPortalStockBizException;</div><div class="line"><span class="keyword">import</span> hbec.platform.commons.annotations.HbecService;</div><div class="line"><span class="keyword">import</span> hbec.platform.commons.exceptions.HbecDbServiceException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line">/**</div><div class="line"> * <span class="meta">@author</span> roc Jul <span class="number">4</span>, <span class="number">2016</span></div><div class="line"> *</div><div class="line"> */</div><div class="line">public interface IConditionTradeController &#123;</div><div class="line"></div><div class="line">	ConditionSaveResult save(<span class="built_in">Integer</span> userId, <span class="meta">@NotNull</span> ConditionTradeDto conditionTradeDto) ;</div><div class="line"></div><div class="line">	ConditionSaveResult saveTurnPoint(<span class="built_in">Integer</span> userId, <span class="meta">@NotNull</span> ConditionTradeTurnPointDto conditionTradeDto) ;</div><div class="line"></div><div class="line">	ConditionSaveResult saveBatching(<span class="built_in">Integer</span> userId, <span class="meta">@NotNull</span> ConditionTradeBatchingDto conditionTradeDto) ;</div><div class="line"></div><div class="line">	ConditionSaveResult saveGrid(<span class="built_in">Integer</span> userId, <span class="meta">@NotNull</span> GridTradeDto conditionTradeDto) ;</div><div class="line"></div><div class="line">	ConditionSaveResult saveProfit(<span class="built_in">Integer</span> userId, ProfitConditionTradeDto profitConditionTradeDto) ;</div><div class="line"></div><div class="line">	<span class="built_in">Integer</span> delete(<span class="built_in">Integer</span> userId, <span class="meta">@NotNull</span> <span class="built_in">Integer</span> warnId) ;</div><div class="line"></div><div class="line">	<span class="built_in">Integer</span> pause(<span class="built_in">Integer</span> userId, <span class="meta">@NotNull</span> <span class="built_in">Integer</span> warnId) ;</div><div class="line"></div><div class="line">	<span class="built_in">Integer</span> resume(<span class="built_in">Integer</span> userId, <span class="meta">@NotNull</span> <span class="built_in">Integer</span> warnId) ;</div><div class="line"></div><div class="line">	PageVo&lt;ConditionTradeMarketVO&gt; findMonitorPageWithMarket(<span class="built_in">Integer</span> userId, <span class="built_in">String</span> code, ConditionPageVo&lt;ConditionTradeMarketVO&gt; pager) ;</div><div class="line"></div><div class="line">	ConditionTradeDetailVo detail(<span class="meta">@NotNull</span> <span class="built_in">Integer</span> userId, <span class="meta">@NotNull</span> <span class="built_in">Integer</span> warnId) ;</div><div class="line"></div><div class="line">	PageVo&lt;ConditionTradeHistoryVo&gt; queryHistory(<span class="meta">@NotNull</span> <span class="built_in">Integer</span> userId, <span class="built_in">String</span> stockCode, PageVo&lt;ConditionTradeHistoryVo&gt; pager) ;</div><div class="line"></div><div class="line">	ConditionTradeDetailVo detailWithMarket(<span class="built_in">Integer</span> userId, <span class="built_in">Integer</span> warnId) ;</div><div class="line"></div><div class="line">	List&lt;EntrustVO&gt; queryEntrustRecord(<span class="built_in">Integer</span> userId, <span class="built_in">Integer</span> warnId) ;</div><div class="line"></div><div class="line">	List&lt;ConditionInfoVO&gt; queryEntrustResult(<span class="built_in">Integer</span> userId, <span class="built_in">String</span> stockCode, <span class="built_in">String</span> historyIds) ;</div><div class="line"></div><div class="line">	PageCursorVo&lt;ConditionInfoVO&gt; queryEntrustedResult(<span class="built_in">Integer</span> userId, <span class="built_in">String</span> stockCode, <span class="built_in">Integer</span> warnId, <span class="built_in">Integer</span> cursor, <span class="built_in">Integer</span> pageSize) ;</div><div class="line"></div><div class="line">	CountTradeHistoryVo countEntrustedResult(<span class="built_in">Integer</span> userId, <span class="built_in">String</span> stockCode, <span class="built_in">Integer</span> warnId) ;</div><div class="line"></div><div class="line">	int markAsRead(<span class="built_in">Integer</span> userId, <span class="built_in">String</span> stockCode, <span class="built_in">Integer</span> warnId) ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用paranamer-maven-plugin编译之后如下：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static final String __PARANAMER_DATA = <span class="string">"countConditionNum java.lang.Integer userId <span class="subst">\n</span>countEntrustedResult java.lang.Integer,java.lang.String,java.lang.Integer userId,stockCode,warnId <span class="subst">\n</span>delete java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>detail java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>detailWithMarket java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>entrustManual java.lang.Integer,java.lang.Integer,EntrustDto userId,warnId,entrustDto <span class="subst">\n</span>findCurrentEntrust java.lang.Integer,java.lang.String,PageVo userId,stockCode,pager <span class="subst">\n</span>findMonitorPageWithMarket java.lang.Integer,java.lang.String,ConditionPageVo userId,code,pager <span class="subst">\n</span>findPage java.lang.Integer,java.lang.String,ConditionPageVo userId,strategyState,pager <span class="subst">\n</span>findTriggeredPage java.lang.Integer,java.lang.Integer,PageVo userId,handled,pager <span class="subst">\n</span>markAsRead java.lang.Integer,java.lang.String,java.lang.Integer userId,stockCode,warnId <span class="subst">\n</span>pause java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>queryEntrustRecord java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>queryEntrustResult java.lang.Integer,java.lang.String,java.lang.String userId,stockCode,historyIds <span class="subst">\n</span>queryEntrustedResult java.lang.Integer,java.lang.String,java.lang.Integer,java.lang.Integer,java.lang.Integer userId,stockCode,warnId,cursor,pageSize <span class="subst">\n</span>queryHistory java.lang.Integer,java.lang.String,PageVo userId,stockCode,pager <span class="subst">\n</span>resume java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>save java.lang.Integer,ConditionTradeDto userId,conditionTradeDto <span class="subst">\n</span>saveBatching java.lang.Integer,ConditionTradeBatchingDto userId,conditionTradeDto <span class="subst">\n</span>saveGrid java.lang.Integer,GridTradeDto userId,conditionTradeDto <span class="subst">\n</span>saveNewShares java.lang.Integer,NewSharesDto userId,newSharesDto <span class="subst">\n</span>saveProfit java.lang.Integer,ProfitConditionTradeDto userId,profitConditionTradeDto <span class="subst">\n</span>saveTurnPoint java.lang.Integer,ConditionTradeTurnPointDto userId,conditionTradeDto <span class="subst">\n</span>saveVipBatching java.lang.Integer,ConditionTradeBatchingDto userId,conditionTradeDto <span class="subst">\n</span>"</span>;</div></pre></td></tr></table></figure>
<p>仔细观察可以发现生成的__PARANAMER_DATA常量中，并未包含对象类型变量的具体package路径，此时使用new CachingParanamer()l.ookupParameterNames(method)无法正常获取方法的变量名称。</p>
<p>去掉import .* 的方式之后，再次编译，常量中包含了对象类型变量具体的package路径，此时可成功获取方法的变量名称。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static final String __PARANAMER_DATA = <span class="string">"countConditionNum java.lang.Integer userId <span class="subst">\n</span>countEntrustedResult java.lang.Integer,java.lang.String,java.lang.Integer userId,stockCode,warnId <span class="subst">\n</span>delete java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>detail java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>detailWithMarket java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>entrustManual java.lang.Integer,java.lang.Integer,hbec.commons.domain.stock.dto.EntrustDto userId,warnId,entrustDto <span class="subst">\n</span>findCurrentEntrust java.lang.Integer,java.lang.String,hbec.commons.domain.stock.vo.PageVo userId,stockCode,pager <span class="subst">\n</span>findMonitorPageWithMarket java.lang.Integer,java.lang.String,hbec.commons.domain.stock.vo.ConditionPageVo userId,code,pager <span class="subst">\n</span>findPage java.lang.Integer,java.lang.String,hbec.commons.domain.stock.vo.ConditionPageVo userId,strategyState,pager <span class="subst">\n</span>findTriggeredPage java.lang.Integer,java.lang.Integer,hbec.commons.domain.stock.vo.PageVo userId,handled,pager <span class="subst">\n</span>markAsRead java.lang.Integer,java.lang.String,java.lang.Integer userId,stockCode,warnId <span class="subst">\n</span>pause java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>queryEntrustRecord java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>queryEntrustResult java.lang.Integer,java.lang.String,java.lang.String userId,stockCode,historyIds <span class="subst">\n</span>queryEntrustedResult java.lang.Integer,java.lang.String,java.lang.Integer,java.lang.Integer,java.lang.Integer userId,stockCode,warnId,cursor,pageSize <span class="subst">\n</span>queryHistory java.lang.Integer,java.lang.String,hbec.commons.domain.stock.vo.PageVo userId,stockCode,pager <span class="subst">\n</span>resume java.lang.Integer,java.lang.Integer userId,warnId <span class="subst">\n</span>save java.lang.Integer,hbec.commons.domain.stock.dto.ConditionTradeDto userId,conditionTradeDto <span class="subst">\n</span>saveBatching java.lang.Integer,hbec.commons.domain.stock.dto.ConditionTradeBatchingDto userId,conditionTradeDto <span class="subst">\n</span>saveGrid java.lang.Integer,hbec.commons.domain.stock.dto.GridTradeDto userId,conditionTradeDto <span class="subst">\n</span>saveNewShares java.lang.Integer,hbec.commons.domain.stock.dto.NewSharesDto userId,newSharesDto <span class="subst">\n</span>saveProfit java.lang.Integer,hbec.commons.domain.stock.condition.dto.ProfitConditionTradeDto userId,profitConditionTradeDto <span class="subst">\n</span>saveTurnPoint java.lang.Integer,hbec.commons.domain.stock.dto.ConditionTradeTurnPointDto userId,conditionTradeDto <span class="subst">\n</span>saveVipBatching java.lang.Integer,hbec.commons.domain.stock.dto.ConditionTradeBatchingDto userId,conditionTradeDto <span class="subst">\n</span>"</span>;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      使用maven paranamer plugin获取java方法中的参数名称
    
    </summary>
    
      <category term="Maven" scheme="https://roc-wong.github.io/categories/Maven/"/>
    
    
      <category term="Maven" scheme="https://roc-wong.github.io/tags/Maven/"/>
    
      <category term="maven paranamer plugin" scheme="https://roc-wong.github.io/tags/maven-paranamer-plugin/"/>
    
  </entry>
  
  <entry>
    <title>Shell脚本调试技术</title>
    <link href="https://roc-wong.github.io/blog/2017/03/Shell%E8%84%9A%E6%9C%AC%E8%B0%83%E8%AF%95%E6%8A%80%E6%9C%AF.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/Shell脚本调试技术.html</id>
    <published>2017-03-26T14:13:40.000Z</published>
    <updated>2018-01-11T02:03:56.365Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>shell编程在unix/linux世界中使用得非常广泛，熟练掌握shell编程也是成为一名优秀的unix/linux开发者和系统管理员的必经之路。脚本调试的主要工作就是发现引发脚本错误的原因以及在脚本源代码中定位发生错误的行，常用的手段包括分析输出的错误信息，通过在脚本中加入调试语句，输出调试信息来辅助诊断错误，利用调试工具等。但与其它高级语言相比，shell解释器缺乏相应的调试机制和调试工具的支持，其输出的错误信息又往往很不明确，初学者在调试脚本时，除了知道用echo语句输出一些信息外，别无它法，而仅仅依赖于大量的加入echo语句来诊断错误，确实令人不胜其繁，故常见初学者抱怨shell脚本太难调试了。本文将系统地介绍一些重要的shell脚本调试技术，希望能对shell的初学者有所裨益。</p>
<a id="more"></a>
<p>本篇博客整理自 Shell脚本调试技术</p>
<blockquote>
<ul>
<li><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-shell-debug/" target="_blank" rel="external">Shell脚本调试技术</a></li>
</ul>
</blockquote>
<p>本文的目标读者是unix/linux环境下的开发人员，测试人员和系统管理员，要求读者具有基本的shell编程知识。本文所使用范例在Bash3.1+Redhat Enterprise Server 4.0下测试通过，但所述调试技巧应也同样适用于其它shell。</p>
<h1 id="在shell脚本中输出调试信息"><a href="#在shell脚本中输出调试信息" class="headerlink" title="在shell脚本中输出调试信息"></a>在shell脚本中输出调试信息</h1><p>通过在程序中加入调试语句把一些关键地方或出错的地方的相关信息显示出来是最常见的调试手段。Shell程序员通常使用echo(ksh程序员常使用print)语句输出信息，但仅仅依赖echo语句的输出跟踪信息很麻烦，调试阶段在脚本中加入的大量的echo语句在产品交付时还得再费力一一删除。针对这个问题，本节主要介绍一些如何方便有效的输出调试信息的方法。</p>
<h2 id="使用trap命令"><a href="#使用trap命令" class="headerlink" title="使用trap命令"></a>使用trap命令</h2><p>trap命令用于捕获指定的信号并执行预定义的命令。其基本的语法是:</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">trap <span class="string">'command'</span> <span class="keyword">signal</span><span class="string"></span></div></pre></td></tr></table></figure>
<p>其中signal是要捕获的信号，command是捕获到指定的信号之后，所要执行的命令。可以用kill –l命令看到系统中全部可用的信号名，捕获信号后所执行的命令可以是任何一条或多条合法的shell语句，也可以是一个函数名。</p>
<p>shell脚本在执行时，会产生三个所谓的“伪信号”，(之所以称之为“伪信号”是因为这三个信号是由shell产生的，而其它的信号是由操作系统产生的)，通过使用trap命令捕获这三个“伪信号”并输出相关信息对调试非常有帮助。</p>
<p>表 1. shell伪信号</p>
<table>
<thead>
<tr>
<th>信号名</th>
<th>何时产生</th>
</tr>
</thead>
<tbody>
<tr>
<td>EXIT</td>
<td>从一个函数中退出或整个脚本执行完毕</td>
</tr>
<tr>
<td>ERR</td>
<td>当一条命令返回非零状态时(代表命令执行不成功)</td>
</tr>
<tr>
<td>DEBUG</td>
<td>脚本中每一条命令执行之前</td>
</tr>
</tbody>
</table>
<p>通过捕获EXIT信号,我们可以在shell脚本中止执行或从函数中退出时，输出某些想要跟踪的变量的值，并由此来判断脚本的执行状态以及出错原因,其使用方法是：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">trap</span> <span class="string">'command'</span> <span class="keyword">EXIT</span>　或　<span class="keyword">trap</span> <span class="string">'command'</span> <span class="number">0</span></div></pre></td></tr></table></figure>
<p>通过捕获ERR信号,我们可以方便的追踪执行不成功的命令或函数，并输出相关的调试信息，以下是一个捕获ERR信号的示例程序，其中的$LINENO是一个shell的内置变量，代表shell脚本的当前行号。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ cat -n exp1.sh</div><div class="line"><span class="function"><span class="title">ERRTRAP</span></span>()</div><div class="line">&#123;</div><div class="line">  <span class="built_in">echo</span> <span class="string">"[LINE:<span class="variable">$1</span>] Error: Command or function exited with status $?"</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="title">foo</span></span>()</div><div class="line">&#123;</div><div class="line"><span class="built_in">return</span> 1;</div><div class="line">&#125;</div><div class="line"><span class="built_in">trap</span> <span class="string">'ERRTRAP $LINENO'</span> ERR</div><div class="line">abc</div><div class="line">foo</div></pre></td></tr></table></figure>
<p>其输出结果如下：</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ sh exp1.sh</div><div class="line">exp1.sh: <span class="literal">line</span> <span class="number">10</span>: abc: command <span class="keyword">not</span> found</div><div class="line">[<span class="literal">LINE</span>:<span class="number">10</span>] <span class="literal">Error</span>: Command <span class="keyword">or</span> <span class="keyword">function</span> exited <span class="keyword">with</span> status <span class="number">127</span></div><div class="line">[<span class="literal">LINE</span>:<span class="number">11</span>] <span class="literal">Error</span>: Command <span class="keyword">or</span> <span class="keyword">function</span> exited <span class="keyword">with</span> status <span class="number">1</span></div></pre></td></tr></table></figure>
<p>在调试过程中，为了跟踪某些变量的值，我们常常需要在shell脚本的许多地方插入相同的echo语句来打印相关变量的值，这种做法显得烦琐而笨拙。而通过捕获DEBUG信号，我们只需要一条trap语句就可以完成对相关变量的全程跟踪。</p>
<p>以下是一个通过捕获DEBUG信号来跟踪变量的示例程序:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ cat –n exp2.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="built_in">trap</span> <span class="string">'echo “before execute line:$LINENO, a=$a,b=$b,c=$c”'</span> DEBUG</div><div class="line">a=1</div><div class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$a</span>"</span> <span class="_">-eq</span> 1 ]</div><div class="line"><span class="keyword">then</span></div><div class="line">   b=2</div><div class="line"><span class="keyword">else</span></div><div class="line">   b=1</div><div class="line"><span class="keyword">fi</span></div><div class="line">c=3</div><div class="line"><span class="built_in">echo</span> <span class="string">"end"</span></div></pre></td></tr></table></figure>
<p>其输出结果如下：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ sh exp2.sh</div><div class="line">before<span class="built_in"> execute </span>line:3, a=,b=,c=</div><div class="line">before<span class="built_in"> execute </span>line:4, a=1,b=,c=</div><div class="line">before<span class="built_in"> execute </span>line:6, a=1,b=,c=</div><div class="line">before<span class="built_in"> execute </span>line:10, a=1,b=2,c=</div><div class="line">before<span class="built_in"> execute </span>line:11, a=1,b=2,c=3</div><div class="line">end</div></pre></td></tr></table></figure>
<p>从运行结果中可以清晰的看到每执行一条命令之后，相关变量的值的变化。同时，从运行结果中打印出来的行号来分析，可以看到整个脚本的执行轨迹，能够判断出哪些条件分支执行了，哪些条件分支没有执行。</p>
<h2 id="使用tee命令"><a href="#使用tee命令" class="headerlink" title="使用tee命令"></a>使用tee命令</h2><p>在shell脚本中管道以及输入输出重定向使用得非常多，在管道的作用下，一些命令的执行结果直接成为了下一条命令的输入。如果我们发现由管道连接起来的一批命令的执行结果并非如预期的那样，就需要逐步检查各条命令的执行结果来判断问题出在哪儿，但因为使用了管道，这些中间结果并不会显示在屏幕上，给调试带来了困难，此时我们就可以借助于tee命令了。</p>
<p>tee命令会从标准输入读取数据，将其内容输出到标准输出设备,同时又可将内容保存成文件。例如有如下的脚本片段，其作用是获取本机的ip地址：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ipaddr=`/sbin/ifconfig | grep <span class="string">'inet addr:'</span> | grep -v <span class="string">'127.0.0.1'</span></div><div class="line">| cut <span class="_">-d</span> : <span class="_">-f</span>3 | awk <span class="string">'&#123;print $1&#125;'</span>`</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="variable">$ipaddr</span></div></pre></td></tr></table></figure>
<p>#注意=号后面的整句是用反引号(数字1键的左边那个键)括起来的。</p>
<p>运行这个脚本，实际输出的却不是本机的ip地址，而是广播地址,这时我们可以借助tee命令，输出某些中间结果，将上述脚本片段修改为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ipaddr=`/sbin/ifconfig | grep <span class="string">'inet addr:'</span> | grep -v <span class="string">'127.0.0.1'</span></div><div class="line">| tee temp.txt | cut <span class="_">-d</span> : <span class="_">-f</span>3 | awk <span class="string">'&#123;print $1&#125;'</span>`</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="variable">$ipaddr</span></div></pre></td></tr></table></figure>
<p>之后，将这段脚本再执行一遍，然后查看temp.txt文件的内容：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ cat temp.txt</div><div class="line">inet addr:<span class="number">192.168</span><span class="meta">.0</span><span class="meta">.1</span>  Bcast:<span class="number">192.168</span><span class="meta">.0</span><span class="meta">.255</span>  Mask:<span class="number">255.255</span><span class="meta">.255</span><span class="meta">.0</span></div></pre></td></tr></table></figure>
<p>我们可以发现中间结果的第二列(列之间以:号分隔)才包含了IP地址，而在上面的脚本中使用cut命令截取了第三列，故我们只需将脚本中的cut -d : -f3改为cut -d : -f2即可得到正确的结果。</p>
<p>具体到上述的script例子，我们也许并不需要tee命令的帮助，比如我们可以分段执行由管道连接起来的各条命令并查看各命令的输出结果来诊断错误，但在一些复杂的shell脚本中，这些由管道连接起来的命令可能又依赖于脚本中定义的一些其它变量，这时我们想要在提示符下来分段运行各条命令就会非常麻烦了，简单地在管道之间插入一条tee命令来查看中间结果会更方便一些。</p>
<h2 id="使用”调试钩子”"><a href="#使用”调试钩子”" class="headerlink" title="使用”调试钩子”"></a>使用”调试钩子”</h2><p>在C语言程序中，我们经常使用DEBUG宏来控制是否要输出调试信息，在shell脚本中我们同样可以使用这样的机制，如下列代码所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ “<span class="variable">$DEBUG</span>” = “<span class="literal">true</span>” ]; <span class="keyword">then</span></div><div class="line"><span class="built_in">echo</span> “debugging”  <span class="comment">#此处可以输出调试信息</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<p>这样的代码块通常称之为“调试钩子”或“调试块”。在调试钩子内部可以输出任何您想输出的调试信息，使用调试钩子的好处是它是可以通过DEBUG变量来控制的，在脚本的开发调试阶段，可以先执行export DEBUG=true命令打开调试钩子，使其输出调试信息，而在把脚本交付使用时，也无需再费事把脚本中的调试语句一一删除。</p>
<p>如果在每一处需要输出调试信息的地方均使用if语句来判断DEBUG变量的值，还是显得比较繁琐，通过定义一个DEBUG函数可以使植入调试钩子的过程更简洁方便，如下面代码所示:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ cat –n exp3.sh</div><div class="line">       <span class="function"><span class="title">DEBUG</span></span>()</div><div class="line">       &#123;</div><div class="line">       <span class="keyword">if</span> [ <span class="string">"<span class="variable">$DEBUG</span>"</span> = <span class="string">"true"</span> ]; <span class="keyword">then</span></div><div class="line">           <span class="variable">$@</span>　　</div><div class="line">       <span class="keyword">fi</span></div><div class="line">       &#125;</div><div class="line">       a=1</div><div class="line">       DEBUG <span class="built_in">echo</span> <span class="string">"a=<span class="variable">$a</span>"</span></div><div class="line">       <span class="keyword">if</span> [ <span class="string">"<span class="variable">$a</span>"</span> <span class="_">-eq</span> 1 ]</div><div class="line">      <span class="keyword">then</span></div><div class="line">           b=2</div><div class="line">      <span class="keyword">else</span></div><div class="line">           b=1</div><div class="line">      <span class="keyword">fi</span></div><div class="line">      DEBUG <span class="built_in">echo</span> <span class="string">"b=<span class="variable">$b</span>"</span></div><div class="line">      c=3</div><div class="line">      DEBUG <span class="built_in">echo</span> <span class="string">"c=<span class="variable">$c</span>"</span></div></pre></td></tr></table></figure>
<p>在上面所示的DEBUG函数中，会执行任何传给它的命令，并且这个执行过程是可以通过DEBUG变量的值来控制的，我们可以把所有跟调试有关的命令都作为DEBUG函数的参数来调用，非常的方便。<br>回页首</p>
<h2 id="使用shell的执行选项"><a href="#使用shell的执行选项" class="headerlink" title="使用shell的执行选项"></a>使用shell的执行选项</h2><p>上一节所述的调试手段是通过修改shell脚本的源代码，令其输出相关的调试信息来定位错误的，那有没有不修改源代码来调试shell脚本的方法呢？答案就是使用shell的执行选项，本节将介绍一些常用选项的用法：</p>
<ul>
<li>-n 只读取shell脚本，但不实际执行</li>
<li>-x 进入跟踪方式，显示所执行的每一条命令</li>
<li>-c “string” 从strings中读取命令</li>
</ul>
<p>“-n”可用于测试shell脚本是否存在语法错误，但不会实际执行命令。在shell脚本编写完成之后，实际执行之前，首先使用“-n”选项来测试脚本是否存在语法错误是一个很好的习惯。因为某些shell脚本在执行时会对系统环境产生影响，比如生成或移动文件等，如果在实际执行才发现语法错误，您不得不手工做一些系统环境的恢复工作才能继续测试这个脚本。</p>
<p>“-c”选项使shell解释器从一个字符串中而不是从一个文件中读取并执行shell命令。当需要临时测试一小段脚本的执行结果时，可以使用这个选项，如下所示：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">sh</span> -c <span class="string">'a=1;b=2;let c=<span class="variable">$a</span>+<span class="variable">$b</span>;echo "c=<span class="variable">$c</span>"'</span></div></pre></td></tr></table></figure></p>
<p>“-x”选项可用来跟踪脚本的执行，是调试shell脚本的强有力工具。“-x”选项使shell在执行脚本的过程中把它实际执行的每一个命令行显示出来，并且在行首显示一个”+”号。 “+”号后面显示的是经过了变量替换之后的命令行的内容，有助于分析实际执行的是什么命令。 “-x”选项使用起来简单方便，可以轻松对付大多数的shell调试任务,应把其当作首选的调试手段。</p>
<p>如果把本文前面所述的trap ‘command’ DEBUG机制与“-x”选项结合起来，我们 就可以既输出实际执行的每一条命令，又逐行跟踪相关变量的值，对调试相当有帮助。</p>
<p>仍以前面所述的exp2.sh为例，现在加上“-x”选项来执行它：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ sh –x exp2.sh</div><div class="line">+ trap 'echo <span class="string">"before execute line:$LINENO, a=$a,b=$b,c=$c"</span>' DEBUG</div><div class="line">++ echo 'before<span class="built_in"> execute </span>line:3, a=,b=,c='</div><div class="line">before<span class="built_in"> execute </span>line:3, a=,b=,c=</div><div class="line">+ a=1</div><div class="line">++ echo 'before<span class="built_in"> execute </span>line:4, a=1,b=,c='</div><div class="line">before<span class="built_in"> execute </span>line:4, a=1,b=,c=</div><div class="line">+ '[' 1 -eq 1 ']'</div><div class="line">++ echo 'before<span class="built_in"> execute </span>line:6, a=1,b=,c='</div><div class="line">before<span class="built_in"> execute </span>line:6, a=1,b=,c=</div><div class="line">+ b=2</div><div class="line">++ echo 'before<span class="built_in"> execute </span>line:10, a=1,b=2,c='</div><div class="line">before<span class="built_in"> execute </span>line:10, a=1,b=2,c=</div><div class="line">+ c=3</div><div class="line">++ echo 'before<span class="built_in"> execute </span>line:11, a=1,b=2,c=3'</div><div class="line">before<span class="built_in"> execute </span>line:11, a=1,b=2,c=3</div><div class="line">+ echo end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>在上面的结果中，前面有“+”号的行是shell脚本实际执行的命令，前面有“++”号的行是执行trap机制中指定的命令，其它的行则是输出信息。</p>
<p>shell的执行选项除了可以在启动shell时指定外，亦可在脚本中用set命令来指定。 “set -参数”表示启用某选项，”set +参数”表示关闭某选项。有时候我们并不需要在启动时用”-x”选项来跟踪所有的命令行，这时我们可以在脚本中使用set命令，如以下脚本片段所示：</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">set</span> -x　　　 #启动<span class="string">"-x"</span>选项</div><div class="line">要跟踪的程序段</div><div class="line"><span class="keyword">set</span> <span class="comment">+x</span>　　　　<span class="comment"> #</span>关闭<span class="comment">"-x"</span>选项</div></pre></td></tr></table></figure>
<p>set命令同样可以使用上一节中介绍的调试钩子—DEBUG函数来调用，这样可以避免脚本交付使用时删除这些调试语句的麻烦，如以下脚本片段所示：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">DEBUG <span class="keyword">set</span> -x　　　 <span class="comment">#启动"-x"选项</span></div><div class="line">要跟踪的程序段</div><div class="line">DEBUG <span class="keyword">set</span> +x　　　 <span class="comment">#关闭"-x"选项</span></div><div class="line">回页首</div></pre></td></tr></table></figure>
<h2 id="对”-x”选项的增强"><a href="#对”-x”选项的增强" class="headerlink" title="对”-x”选项的增强"></a>对”-x”选项的增强</h2><p>“-x”执行选项是目前最常用的跟踪和调试shell脚本的手段，但其输出的调试信息仅限于进行变量替换之后的每一条实际执行的命令以及行首的一个”+”号提示符，居然连行号这样的重要信息都没有，对于复杂的shell脚本的调试来说，还是非常的不方便。幸运的是，我们可以巧妙地利用shell内置的一些环境变量来增强”-x”选项的输出信息，下面先介绍几个shell内置的环境变量：</p>
<h3 id="LINENO"><a href="#LINENO" class="headerlink" title="$LINENO"></a>$LINENO</h3><p>代表shell脚本的当前行号，类似于C语言中的内置宏<strong>LINE</strong></p>
<h3 id="FUNCNAME"><a href="#FUNCNAME" class="headerlink" title="$FUNCNAME"></a>$FUNCNAME</h3><p>函数的名字，类似于C语言中的内置宏<strong>func</strong>,但宏<strong>func</strong>只能代表当前所在的函数名，而$FUNCNAME的功能更强大，它是一个数组变量，其中包含了整个调用链上所有的函数的名字，故变量${FUNCNAME[0]}代表shell脚本当前正在执行的函数的名字，而变量${FUNCNAME[1]}则代表调用函数${FUNCNAME[0]}的函数的名字，余者可以依此类推。</p>
<h3 id="PS4"><a href="#PS4" class="headerlink" title="$PS4"></a>$PS4</h3><p>主提示符变量$PS1和第二级提示符变量$PS2比较常见，但很少有人注意到第四级提示符变量$PS4的作用。我们知道使用“-x”执行选项将会显示shell脚本中每一条实际执行过的命令，而$PS4的值将被显示在“-x”选项输出的每一条命令的前面。在Bash Shell中，缺省的$PS4的值是”+”号。(现在知道为什么使用”-x”选项时，输出的命令前面有一个”+”号了吧？)。</p>
<p>利用$PS4这一特性，通过使用一些内置变量来重定义$PS4的值，我们就可以增强”-x”选项的输出信息。例如先执行export PS4=’+{$LINENO:${FUNCNAME[0]}} ‘, 然后再使用“-x”选项来执行脚本，就能在每一条实际执行的命令前面显示其行号以及所属的函数名。</p>
<p>以下是一个存在bug的shell脚本的示例，本文将用此脚本来示范如何用“-n”以及增强的“-x”执行选项来调试shell脚本。这个脚本中定义了一个函数isRoot(),用于判断当前用户是不是root用户，如果不是，则中止脚本的执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ cat –n exp4.sh</div><div class="line"> <span class="comment">#!/bin/bash</span></div><div class="line"> <span class="function"><span class="title">isRoot</span></span>()</div><div class="line"> &#123;</div><div class="line">         <span class="keyword">if</span> [ <span class="string">"<span class="variable">$UID</span>"</span> <span class="_">-ne</span> 0 ]</div><div class="line">                 <span class="built_in">return</span> 1</div><div class="line">         <span class="keyword">else</span></div><div class="line">                 <span class="built_in">return</span> 0</div><div class="line">         <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line">isRoot</div><div class="line"><span class="keyword">if</span> [<span class="string">"$?"</span> <span class="_">-ne</span> 0 ]</div><div class="line"><span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"Must be root to run this script"</span></div><div class="line">        <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">else</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"welcome root user"</span></div><div class="line">        <span class="comment">#do something</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<p>首先执行sh –n exp4.sh来进行语法检查，输出如下：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">sh</span> –<span class="keyword">n</span> exp4.<span class="keyword">sh</span></div><div class="line">exp4.<span class="keyword">sh</span>: <span class="keyword">line</span> 6: <span class="keyword">syntax</span> <span class="keyword">error</span> near unexpected <span class="keyword">token</span> <span class="symbol">`else'</span></div><div class="line">exp4.<span class="keyword">sh</span>: <span class="keyword">line</span> 6: `      <span class="keyword">else</span>'</div></pre></td></tr></table></figure>
<p>发现了一个语法错误，通过仔细检查第6行前后的命令，我们发现是第4行的if语句缺少then关键字引起的(写惯了C程序的人很容易犯这个错误)。我们可以把第4行修改为if [ “$UID” -ne 0 ]; then来修正这个错误。再次运行sh –n exp4.sh来进行语法检查，没有再报告错误。接下来就可以实际执行这个脚本了，执行结果如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">sh</span> exp4.<span class="keyword">sh</span></div><div class="line">exp2.<span class="keyword">sh</span>: <span class="built_in">line</span> <span class="number">11</span>: [<span class="number">1</span>: <span class="keyword">command</span> not found</div><div class="line">welcome root user</div></pre></td></tr></table></figure>
<p>尽管脚本没有语法错误了，在执行时却又报告了错误。错误信息还非常奇怪“[1: command not found”。现在我们可以试试定制$PS4的值，并使用“-x”选项来跟踪：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ export PS4=<span class="string">'+&#123;$LINENO:$&#123;FUNCNAME[0]&#125;&#125; '</span></div><div class="line">$ <span class="keyword">sh</span> –<span class="keyword">x</span> exp4.<span class="keyword">sh</span></div><div class="line">+&#123;<span class="number">10</span>:&#125; isRoot</div><div class="line">+&#123;<span class="number">4</span>:isRoot&#125; <span class="string">'['</span> <span class="number">503</span> -ne <span class="number">0</span> <span class="string">']'</span></div><div class="line">+&#123;<span class="number">5</span>:isRoot&#125; <span class="keyword">return</span> <span class="number">1</span></div><div class="line">+&#123;<span class="number">11</span>:&#125; <span class="string">'[1'</span> -ne <span class="number">0</span> <span class="string">']'</span></div><div class="line">exp4.<span class="keyword">sh</span>: <span class="built_in">line</span> <span class="number">11</span>: [<span class="number">1</span>: <span class="keyword">command</span> not found</div><div class="line">+&#123;<span class="number">16</span>:&#125; <span class="keyword">echo</span> <span class="string">'welcome root user'</span></div><div class="line">welcome root user</div></pre></td></tr></table></figure>
<p>从输出结果中，我们可以看到脚本实际被执行的语句，该语句的行号以及所属的函数名也被打印出来，从中可以清楚的分析出脚本的执行轨迹以及所调用的函数的内部执行情况。由于执行时是第11行报错，这是一个if语句，我们对比分析一下同为if语句的第4行的跟踪结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">+&#123;4:isRoot&#125; <span class="string">'['</span> 503 <span class="_">-ne</span> 0 <span class="string">']'</span></div><div class="line">+&#123;11:&#125; <span class="string">'[1'</span> <span class="_">-ne</span> 0 <span class="string">']'</span></div></pre></td></tr></table></figure>
<p>可知由于第11行的[号后面缺少了一个空格，导致[号与紧挨它的变量$?的值1被shell解释器看作了一个整体，并试着把这个整体视为一个命令来执行，故有“[1: command not found”这样的错误提示。只需在[号后面插入一个空格就一切正常了。</p>
<p>shell中还有其它一些对调试有帮助的内置变量，比如在Bash Shell中还有BASH_SOURCE, BASH_SUBSHELL等一批对调试有帮助的内置变量，您可以通过man sh或man bash来查看，然后根据您的调试目的,使用这些内置变量来定制$PS4，从而达到增强“-x”选项的输出信息的目的。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>现在让我们来总结一下调试shell脚本的过程：</p>
<p>首先使用“-n”选项检查语法错误，然后使用“-x”选项跟踪脚本的执行，使用“-x”选项之前，别忘了先定制PS4变量的值来增强“-x”选项的输出信息，至少应该令其输出行号信息(先执行export PS4=’+[$LINENO]’，更一劳永逸的办法是将这条语句加到您用户主目录的.bash_profile文件中去)，这将使你的调试之旅更轻松。也可以利用trap,调试钩子等手段输出关键调试信息，快速缩小排查错误的范围，并在脚本中使用“set -x”及“set +x”对某些代码块进行重点跟踪。这样多种手段齐下，相信您已经可以比较轻松地抓出您的shell脚本中的臭虫了。如果您的脚本足够复杂，还需要更强的调试能力，可以使用shell调试器bashdb，这是一个类似于GDB的调试工具，可以完成对shell脚本的断点设置，单步执行，变量观察等许多功能，使用bashdb对阅读和理解复杂的shell脚本也会大有裨益。关于bashdb的安装和使用，不属于本文范围，您可参阅<a href="http://bashdb.sourceforge.net/上的文档并下载试用。" target="_blank" rel="external">http://bashdb.sourceforge.net/上的文档并下载试用。</a></p>
]]></content>
    
    <summary type="html">
    
      Shell脚本调试技术
    
    </summary>
    
      <category term="Linux" scheme="https://roc-wong.github.io/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://roc-wong.github.io/tags/Linux/"/>
    
      <category term="Shell" scheme="https://roc-wong.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>shell 函数返回字符串的方法</title>
    <link href="https://roc-wong.github.io/blog/2017/03/shell-%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%96%B9%E6%B3%95.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/shell-函数返回字符串的方法.html</id>
    <published>2017-03-26T13:53:37.000Z</published>
    <updated>2017-03-26T14:09:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>shell的函数只能返回整数值，如果想让函数返回字符串，一般有两种方法：将返回值赋值给一个字符串变量、输出返回值，在函数调用处为变量赋值。</p>
<a id="more"></a>
<h2 id="Shell函数"><a href="#Shell函数" class="headerlink" title="Shell函数"></a>Shell函数</h2><p>Shell 函数的定义格式如下：</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span><span class="number">_n</span>ame () &#123;</div><div class="line">    list <span class="keyword">of</span> commands</div><div class="line">    [ <span class="keyword">return</span> <span class="keyword">value</span> ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果你愿意，也可以在函数名前加上关键字 function：<br><figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">function_name</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">list</span> <span class="keyword">of</span> commands</div><div class="line">    [ <span class="keyword">return</span> value ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>函数返回值，可以显式增加return语句；如果不加，会将最后一条命令运行结果作为返回值。</p>
<p>Shell 函数返回值只能是整数，一般用来表示函数执行成功与否，0表示成功，其他值表示失败。如果 return 其他数据，比如一个字符串，往往会得到错误提示：“numeric argument required”。</p>
<p>如果一定要让函数返回字符串，那么可以先定义一个变量，用来接收函数的计算结果，脚本在需要的时候访问这个变量来获得函数返回值。</p>
<h2 id="将返回值赋值给一个字符串变量"><a href="#将返回值赋值给一个字符串变量" class="headerlink" title="将返回值赋值给一个字符串变量"></a>将返回值赋值给一个字符串变量</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">get_project_version()&#123;</div><div class="line">  VERSION=`grep version $<span class="number">1</span>/pom.xml | head -n <span class="number">1</span> | sed -E <span class="string">'s:&lt;/?version&gt;::g'</span> | sed -E <span class="string">'s/^\t*//'</span> | sed -E <span class="string">'s/^ *//'</span> | sed -E <span class="string">'s/\r$//'</span>`</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="输出返回值，在函数调用处为变量赋值"><a href="#输出返回值，在函数调用处为变量赋值" class="headerlink" title="输出返回值，在函数调用处为变量赋值"></a>输出返回值，在函数调用处为变量赋值</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">get_project_version()&#123;</div><div class="line">  echo `grep version $<span class="number">1</span>/pom.xml | head -n <span class="number">1</span> | sed -E <span class="string">'s:&lt;/?version&gt;::g'</span> | sed -E <span class="string">'s/^\t*//'</span> | sed -E <span class="string">'s/^ *//'</span> | sed -E <span class="string">'s/\r$//'</span>`</div><div class="line">&#125;</div><div class="line"></div><div class="line">version=`get_project_version $PROJECT_PATH`</div></pre></td></tr></table></figure>
<h2 id="特殊变量列表"><a href="#特殊变量列表" class="headerlink" title="特殊变量列表"></a>特殊变量列表</h2><table>
<thead>
<tr>
<th>变量</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>$0</td>
<td>是脚本本身的名字；</td>
</tr>
<tr>
<td>$#</td>
<td>是传给脚本的参数个数；</td>
</tr>
<tr>
<td>$@</td>
<td>是传给脚本的所有参数的列表，即被扩展为”$1” “$2” “$3”等；</td>
</tr>
<tr>
<td>$*</td>
<td>是以一个单字符串显示所有向脚本传递的参数，与位置变量不同，参数可超过9个，即被扩展成”$1c$2c$3”，其中c是IFS的第一个字符；</td>
</tr>
<tr>
<td>$$</td>
<td>是脚本运行的当前进程ID号；</td>
</tr>
<tr>
<td>$?</td>
<td>是显示最后命令的退出状态，0表示没有错误，其他表示有错误；</td>
</tr>
<tr>
<td>$n</td>
<td>获取参数的值，$1表示第一个参数，当n&gt;=10时，需要使用${n}来获取参数。</td>
</tr>
</tbody>
</table>
<p>如果你希望直接从终端调用函数，可以将函数定义在主目录下的 .profile 文件，这样每次登录后，在命令提示符后面输入函数名字就可以立即调用。</p>
]]></content>
    
    <summary type="html">
    
      shell函数返回字符串
    
    </summary>
    
      <category term="Linux" scheme="https://roc-wong.github.io/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://roc-wong.github.io/tags/Linux/"/>
    
      <category term="Shell" scheme="https://roc-wong.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>shell 文件包含</title>
    <link href="https://roc-wong.github.io/blog/2017/03/shell-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/shell-文件包含.html</id>
    <published>2017-03-26T13:46:15.000Z</published>
    <updated>2018-01-11T02:03:52.085Z</updated>
    
    <content type="html"><![CDATA[<p>像其他语言一样，Shell 也可以包含外部脚本，将外部脚本的内容合并到当前脚本。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>.   . ./subscript.<span class="keyword">sh</span> (常用)     </div><div class="line"><span class="number">2</span>.   <span class="keyword">source</span> ./subscript.<span class="keyword">sh</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<p>两种方式的效果相同，简单起见，一般使用点号(.)，但是注意点号(.)和文件名中间有一空格。两个脚本不在同一目录时，要用绝对路径。</p>
<p>PS:被包含脚本不需要有执行权限，调用脚本必须有可执行权限。</p>
]]></content>
    
    <summary type="html">
    
      Shell脚本中引用、调用另一个脚本文件的方式
    
    </summary>
    
      <category term="Linux" scheme="https://roc-wong.github.io/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://roc-wong.github.io/tags/Linux/"/>
    
      <category term="Shell" scheme="https://roc-wong.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>shell 获取正在执行脚本的绝对路径</title>
    <link href="https://roc-wong.github.io/blog/2017/03/shell-%E8%8E%B7%E5%8F%96%E6%AD%A3%E5%9C%A8%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E7%9A%84%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/shell-获取正在执行脚本的绝对路径.html</id>
    <published>2017-03-26T13:25:23.000Z</published>
    <updated>2017-03-26T13:45:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>今天在写脚本的时候，想获取下当前执行脚本的绝对路径，试了试pwd，发现并不是正确的路径。找资料后发现 pwd 命令的作用是“print name of current/working directory-当前的工作目录”。 试了试$0，发现也不对，$0是Bash环境下的特殊变量，其真实含义是：</p>
<a id="more"></a>
<p>　　Expands to the name of the shell or shell script. This is set at shell initialization.  If bash is invoked with a file of commands, $0 is set to the name of that file. If bash is started with the -c option, then $0 is set to the first argument after the string to be executed, if one is present. Otherwise, it is set to the file name used to invoke bash, as given by argument zero.</p>
<p>$0的结果与调用方式有关：</p>
<ul>
<li>使用一个文件调用bash，那$0的值，是那个文件的名字(不能确定绝对路径)</li>
<li>使用-c选项启动bash的话，真正执行的命令会从一个字符串中读取，字符串后面如果还有别的参数的话，使用从$0开始的特殊变量引用(跟路径无关)</li>
<li>除此以外，$0会被设置成调用bash的那个文件的名字(不能确定是绝对路径)</li>
</ul>
<p>正确的姿势：</p>
<p>basepath=$(cd <code>dirname $0</code>; pwd)</p>
<ul>
<li>dirname $0，取得当前执行的脚本文件的父目录</li>
<li>cd <code>dirname $0</code>，进入这个目录(切换当前工作目录)</li>
<li>pwd，显示当前工作目录(cd执行后的)</li>
</ul>
]]></content>
    
    <summary type="html">
    
      shell 获取正在执行脚本的绝对路径
    
    </summary>
    
      <category term="Linux" scheme="https://roc-wong.github.io/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://roc-wong.github.io/tags/Linux/"/>
    
      <category term="Shell" scheme="https://roc-wong.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>svn status</title>
    <link href="https://roc-wong.github.io/blog/2017/03/svn-status.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/svn-status.html</id>
    <published>2017-03-26T13:07:54.000Z</published>
    <updated>2018-01-11T02:04:49.595Z</updated>
    
    <content type="html"><![CDATA[<h2 id="名称"><a href="#名称" class="headerlink" title="名称"></a>名称</h2><p>svn status (stat, st) — 打印工作副本文件和目录的状态。</p>
<h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>svn status [PATH…]</p>
<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>Print the status of working copy files and directories. With no arguments, it prints only locally modified items (no repository access). With –show-updates (-u), it adds working revision and server out-of-date information. With –verbose (-v), it prints full revision information on every item. With –quiet (-q), it prints only summary information about locally modified items.</p>
<a id="more"></a>
<p>The first seven columns in the output are each one character wide, and each column gives you information about a different aspect of each working copy item.</p>
<p>第一列指出一个项目的是添加, 删除还是其它的修改：</p>
<p>‘ ‘<br>没有修改。</p>
<p>‘A’<br>预定要添加的项目。</p>
<p>‘D’<br>预定要删除的项目。</p>
<p>‘M’<br>项目已经修改了。</p>
<p>‘R’<br>Item has been replaced in your working copy. This means the file was scheduled for deletion, and then a new file with the same name was scheduled for addition in its place.</p>
<p>‘C’<br>项目的内容(相对于属性)与更新得到的数据冲突了。</p>
<p>‘X’<br>项目与外部定义相关。</p>
<p>‘I’<br>项目被忽略(例如使用svn:ignore属性)。</p>
<p>‘?’<br>项目不在版本控制之下。</p>
<p>‘!’<br>Item is missing (e.g., you moved or deleted it without using svn). This also indicates that a directory is incomplete (a checkout or update was interrupted).</p>
<p>‘~’<br>Item is versioned as one kind of object (file, directory, link), but has been replaced by a different kind of object.</p>
<p>The second column tells the status of a file’s or directory’s properties:</p>
<p>‘ ‘<br>没有修改。</p>
<p>‘M’<br>这个项目的属性已经修改。</p>
<p>‘C’<br>这个项目的属性与从版本库得到的更新有冲突。</p>
<p>The third column is populated only if the working copy directory is locked (see 第 6 节 “有时你只需要清理”):</p>
<p>‘ ‘<br>项目没有锁定。</p>
<p>‘L’<br>项目已经锁定。</p>
<p>The fourth column is populated only if the item is scheduled for addition-with-history:</p>
<p>‘ ‘<br>没有历史预定要提交。</p>
<p>‘+’<br>历史预定要伴随提交。</p>
<p>The fifth column is populated only if the item is switched relative to its parent (see 第 5 节 “使用分支”):</p>
<p>‘ ‘<br>项目是它的父目录的孩子。</p>
<p>‘S’<br>项目已经转换。</p>
<p>The sixth column is populated with lock information:</p>
<p>‘ ‘<br>When –show-updates (-u) is used, the file is not locked. If –show-updates (-u) is not used, this merely means that the file is not locked in this working copy.</p>
<p>K<br>文件锁定在工作副本。</p>
<p>O<br>File is locked either by another user or in another working copy. This appears only when –show-updates (-u) is used.</p>
<p>T<br>File was locked in this working copy, but the lock has been “stolen” and is invalid. The file is currently locked in the repository. This appears only when –show-updates (-u) is used.</p>
<p>B<br>File was locked in this working copy, but the lock has been “broken” and is invalid. The file is no longer locked. This appears only when –show-updates (-u) is used.</p>
<p>The seventh column is populated only if the item is the victim of a tree conflict:</p>
<p>‘ ‘<br>项目不是树冲突的受害者。</p>
<p>‘C’<br>项目是树冲突的受害者</p>
<p>第八列始终为空。</p>
<p>The out-of-date information appears in the ninth column (only if you pass the –show-updates (-u) option):</p>
<p>‘ ‘<br>这个项目在工作副本是最新的。</p>
<p>‘*‘<br>在服务器这个项目有了新的修订版本。</p>
<p>The remaining fields are variable width and delimited by spaces. The working revision is the next field if the –show-updates (-u) or –verbose (-v) option is passed.</p>
<p>If the –verbose (-v) option is passed, the last committed revision and last committed author are displayed next.</p>
<p>工作副本路径永远是最后一个字段，所以它可以包括空格。</p>
<p>选项</p>
<p>–changelist ARG<br>–depth ARG<br>–ignore-externals<br>–incremental<br>–no-ignore<br>–quiet (-q)<br>–show-updates (-u)<br>–verbose (-v)<br>–xml<br>例子</p>
<p>这是查看你在工作副本所做的修改的最简单的方法。</p>
<p>$ svn status wc<br> M      wc/bar.c<br>A  +    wc/qax.c<br>If you want to find out what files in your working copy are out of date, pass the –show-updates (-u) option (this will not make any changes to your working copy). Here you can see that wc/foo.c has changed in the repository since we last updated our working copy:</p>
<p>$ svn status -u wc<br> M            965    wc/bar.c</p>
<pre><code>*     965    wc/foo.c
</code></pre><p>A  +          965    wc/qax.c<br>Status against revision:    981<br>[注意]    注意<br>–show-updates (-u) only places an asterisk next to items that are out of date (i.e., items that will be updated from the repository if you later use svn update). –show-updates (-u) does not cause the status listing to reflect the repository’s version of the item (although you can see the revision number in the repository by passing the –verbose (-v) option).</p>
<p>The most information you can get out of the status subcommand is as follows:</p>
<p>$ svn status -u -v wc<br> M            965       938 sally        wc/bar.c</p>
<pre><code>*     965       922 harry        wc/foo.c
</code></pre><p>A  +          965       687 harry        wc/qax.c<br>              965       687 harry        wc/zig.c<br>Status against revision:   981<br>Lastly, you can get svn status output in XML format with the –xml option:</p>
<p>$ svn status –xml wc<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">status</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">target</span></span></div><div class="line">   <span class="attr">path</span>=<span class="string">"wc"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">entry</span></span></div><div class="line">   <span class="attr">path</span>=<span class="string">"qax.c"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">wc-status</span></span></div><div class="line">   <span class="attr">props</span>=<span class="string">"none"</span></div><div class="line">   <span class="attr">item</span>=<span class="string">"added"</span></div><div class="line">   <span class="attr">revision</span>=<span class="string">"0"</span>&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">wc-status</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">entry</span></span></div><div class="line">   <span class="attr">path</span>=<span class="string">"bar.c"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">wc-status</span></span></div><div class="line">   <span class="attr">props</span>=<span class="string">"normal"</span></div><div class="line">   <span class="attr">item</span>=<span class="string">"modified"</span></div><div class="line">   <span class="attr">revision</span>=<span class="string">"965"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">commit</span></span></div><div class="line">   <span class="attr">revision</span>=<span class="string">"965"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">author</span>&gt;</span>sally<span class="tag">&lt;/<span class="name">author</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">date</span>&gt;</span>2008-05-28T06:35:53.048870Z<span class="tag">&lt;/<span class="name">date</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">commit</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">wc-status</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">status</span>&gt;</span></div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      svn status 详解
    
    </summary>
    
      <category term="SVN" scheme="https://roc-wong.github.io/categories/SVN/"/>
    
    
      <category term="SVN" scheme="https://roc-wong.github.io/tags/SVN/"/>
    
  </entry>
  
  <entry>
    <title>股票估值</title>
    <link href="https://roc-wong.github.io/blog/2017/03/%E8%82%A1%E7%A5%A8%E4%BC%B0%E5%80%BC.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/股票估值.html</id>
    <published>2017-03-15T15:13:19.000Z</published>
    <updated>2018-01-11T02:03:48.216Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>格雷厄姆认为：“稳健投资者的基本原理是不会随着年代的更替而改变的，但是这些原理的应用，则必须随着金融机制和金融环境所发生的重大变化而作出相应的调整。”</p>
<p>实际上巴菲特的“以合理的价格买优秀的公司”也正是格老与时俱进思想的体现。</p>
</blockquote>
<p>股票估值是一个相对复杂的过程，影响的因素很多，没有全球统一的标准。影响股票估值的主要因素依次是每股收益、行业市盈率、流通股本、每股净资产、每股净资产增长率等指标。</p>
<p>股票估值分为绝对估值、相对估值和联合估值。</p>
<a id="more"></a>
<h2 id="绝对估值"><a href="#绝对估值" class="headerlink" title="绝对估值"></a>绝对估值</h2><p>绝对估值(absolute valuation)是通过对上市公司历史及当前的基本面的分析和对未来反映公司经营状况的财务数据的预测获得上市公司股票的内在价值。</p>
<h3 id="绝对估值的方法"><a href="#绝对估值的方法" class="headerlink" title="绝对估值的方法"></a>绝对估值的方法</h3><p>一是现金流贴现定价模型，二是B-S期权定价模型(主要应用于期权定价、权证定价等)。现金流贴现定价模型目前使用最多的是DDM和DCF，而DCF估值模型中，最广泛应用的就是FCFE股权自由现金流模型。</p>
<h3 id="绝对估值的作用"><a href="#绝对估值的作用" class="headerlink" title="绝对估值的作用"></a>绝对估值的作用</h3><p>股票的价格总是围绕着股票的内在价值上下波动，发现价格被低估的股票，在股票的价格远远低于内在价值的时候买入股票，而在股票的价格回归到内在价值甚至高于内在价值的时候卖出以获利。<br>对上市公司进行研究，经常听到估值这个词，说的其实是如何来判断一家公司的价值同时与它的当前股价进行对比，得出股价是否偏离价值的判断，进而指导投资。</p>
<p>DCF是一套很严谨的估值方法，是一种绝对定价方法，想得出准确的DCF值，需要对公司未来发展情况有清晰的了解。得出DCF 值的过程就是判断公司未来发展的过程。所以DCF 估值的过程也很重要。就准确判断企业的未来发展来说，判断成熟稳定的公司相对容易一些，处于扩张期的企业未来发展的不确定性较大，准确判断较为困难。再加上DCF 值本身对参数的变动很敏感，使DCF 值的可变性很大。但在得出DCF 值的过程中，会反映研究员对企业未来发展的判断，并在此基础上假设。有了DCF 的估值过程和结果，以后如果假设有变动，即可通过修改参数得到新的估值。</p>
<h2 id="相对估值"><a href="#相对估值" class="headerlink" title="相对估值"></a>相对估值</h2><p>相对估值是使用市盈率、市净率、市售率、市现率等价格指标与其它多只股票（对比系）进行对比，如果低于对比系的相应的指标值的平均值，股票价格被低估，股价将很有希望上涨，使得指标回归对比系的平均值。<br>相对估值包括PE、PB、PEG、EV/EBITDA等估值法。通常的做法是对比，一个是和该公司历史数据进行对比，二是和国内同行业企业的数据进行对比，确定它的位置，三是和国际上的(特别是香港和美国)同行业重点企业数据进行对比。<br><strong>市盈率PE（股价/每股收益）</strong>：</p>
<p>PE是简洁有效的估值方法，其核心在于e 的确定。PE=p/e，即价格与每股收益的比值。从直观上看，如果公司未来若干年每股收益为恒定值，那么PE 值代表了公司保持恒定盈利水平的存在年限。这有点像实业投资中回收期的概念，只是忽略了资金的时间价值。而实际上保持恒定的e 几乎是不可能的，e 的变动往往取决于宏观经济和企业的生存周期所决定的波动周期。所以在运用PE 值的时候，e 的确定显得尤为重要，由此也衍生出具有不同含义的PE 值。E 有两个方面，一个是历史的e，另一个是预测的e。对于历史的e 来说，可以用不同e 的时点值，可以用移动平均值，也可以用动态年度值，这取决于想要表达的内容。对于预测的e 来说，预测的准确性尤为重要，在实际市场中，e 的变动趋势对股票投资往往具有决定性的影响。<br>市净率PB（股价/每股净资）和净资产收益率ROE,PB &amp;ROE适合于周期的极值判断。对于股票投资来说，准确预测e 是非常重要的，e 的变动趋势往往决定了股价是上行还是下行。但股价上升或下降到多少是合理的呢？ PB&amp;ROE 可以给出一个判断极值的方法。比如，对于一个有良好历史ROE 的公司，在业务前景尚可的情况下，PB 值低于1就有可能是被低估的。如果公司的盈利前景较稳定，没有表现出明显的增长性特征，公司的PB 值显著高于行业（公司历史）的最高PB 值，股价触顶的可能性就比较大。这里提到的周期有三个概念：市场的波动周期、股价的变动周期和周期性行业的变动周期。</p>
<h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><h3 id="PE"><a href="#PE" class="headerlink" title="PE"></a>PE</h3><p>PE是指市盈率，也称为“利润收益率”，是某种股票普通股每股市价与每股盈利的比率，即：PE(市盈率)=每股市价/每股收益。市盈率把股价和利润联系起来，反映了企业的近期表现。如果股价上升，利润没有变化，甚至下降，则市盈率将会上升。</p>
<h2 id="PB"><a href="#PB" class="headerlink" title="PB"></a>PB</h2><p>平均市净率=股价/账面价值。其中，账面价值=总资产-无形资产-负债-优先股权益。可以看出，所谓账面价值是公司解散清算的价值。如果公司要清算，那么先要还债，无形资产则将不复存在，而优先股的优先权之一就是清算的时候先分钱，但是本股市没有优先股。这样，用每股净资产来代替账面价值，则PB就是大家理解的市净率，即：PB(市净率)=股价/每股净资产。</p>
<h2 id="ROE"><a href="#ROE" class="headerlink" title="ROE"></a>ROE</h2><p>ROE即净资产收益率，又称股东权益报酬率。作为判断上市公司盈利能力的一项重要指标，一直受到证券市场参与各方的极大关注。分析师将ROE解释为将公司盈余再投资以产生更多收益的能力。它也是衡量公司内部财务、行销及经营绩效的指标。ROE的计算方法是：净资产收益率＝报告期净利润／报告期末净资产。</p>
<h2 id="DCF"><a href="#DCF" class="headerlink" title="DCF"></a>DCF</h2><p>绝对估值法DCF：DCF是一套很严谨的估值方法，是一种绝对定价方法，想得出准确的DCF值，需要对公司未来发展情况有清晰的了解。得出DCF值的过程就是判断公司未来发展的过程，所以DCF估值的过程也很重要。就准确判断企业的未来发展来说，判断成熟稳定的公司相对容易一些，处于扩张期的企业未来发展的不确定性较大，准确判断较为困难。再加上DCF值本身对参数的变动很敏感，使DCF值的可变性很大。但在得出DCF值的过程中，会反映研究员对企业未来发展的判断，并在此基础上假设。有了DCF的估值过程和结果，以后如果假设有变动，即可通过修改参数得到新的估值。</p>
]]></content>
    
    <summary type="html">
    
      股票估值分为绝对估值、相对估值和联合估值。影响股票估值的主要因素依次是每股收益、行业市盈率、流通股本、每股净资产、每股净资产增长率等指标。
    
    </summary>
    
      <category term="证券" scheme="https://roc-wong.github.io/categories/%E8%AF%81%E5%88%B8/"/>
    
    
      <category term="证券" scheme="https://roc-wong.github.io/tags/%E8%AF%81%E5%88%B8/"/>
    
  </entry>
  
  <entry>
    <title>人生最浪费生命的事情</title>
    <link href="https://roc-wong.github.io/blog/2017/03/%E4%BA%BA%E7%94%9F%E6%9C%80%E6%B5%AA%E8%B4%B9%E7%94%9F%E5%91%BD%E7%9A%84%E4%BA%8B%E6%83%85.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/人生最浪费生命的事情.html</id>
    <published>2017-03-14T16:03:51.000Z</published>
    <updated>2017-03-14T16:14:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>人这一生，浪费了太多的时间在毫无意义的事情上，担忧、抱怨、埋怨、比较……</p>
<a id="more"></a>
<h2 id="担忧"><a href="#担忧" class="headerlink" title="担忧"></a>担忧</h2><p>庸人自扰是为难自己，让自己每天神经紧绷、忧心忡忡，只会使自己身心俱疲。生活里总会有变数，总会有风雨，任谁都无法提前预知一切。所以，让自己焦虑烦扰，不如让自己释怀轻松地过每一天，顺其自然、淡定坦然地面对一切，不要让担忧禁锢你的身体、束缚你的内心。</p>
<h2 id="抱怨"><a href="#抱怨" class="headerlink" title="抱怨"></a>抱怨</h2><p>充满抱怨的人生会与快乐渐行渐远。对环境不满、对别人不满、对命运不满、对现实不满，最后对自己的选择和决定不满……抱怨会削弱你奋斗的力量，会阻碍你前行的脚步，会让你陷入负面情绪无法自拔。试着让自己勇敢坦然地面对一切风雨，接受自己做出的每一个决定，即使这个过程充满艰辛，也不要轻言放弃，更不要裹足不前、自怨自艾。</p>
<h2 id="埋怨"><a href="#埋怨" class="headerlink" title="埋怨"></a>埋怨</h2><p>遇事，先责备别人；不顺，先埋怨条件，这是一种消极被动的人生态度，是一种缺乏担当的表现。埋怨根本于事无补，只会让你看不清自己的问题、意识不到自己的错误。聪明的人会懂得先反省自己，从自己的身上找答案。只有用这种积极的态度去面对生活中遇到的问题，才能够让你汲取教训、增长经验，让你在今后的生活中越走越顺利。</p>
<h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><p>　　生活中，自己觉得快乐不快乐、满足不满足、幸福不幸福，才是正理。不要陷入跟别人不断的比较之中，不要因为别人扰乱了自己的步伐。每个人都有自己的机遇和福分，也会遭遇自己的坎坷和波折，不要拿别人的成就荣耀与自己比，不要盲目追随、模仿别人的生活方式而忘记了自己的初衷和追求。多倾听自己的内心，多思考自己的需要，走自己的路，过自己的人生。</p>
<h2 id="这是你吗？"><a href="#这是你吗？" class="headerlink" title="这是你吗？"></a>这是你吗？</h2><h3 id="花费了太多的时间在你不该做的事情上。"><a href="#花费了太多的时间在你不该做的事情上。" class="headerlink" title="花费了太多的时间在你不该做的事情上。"></a>花费了太多的时间在你不该做的事情上。</h3><h3 id="总是在抱怨。"><a href="#总是在抱怨。" class="headerlink" title="总是在抱怨。"></a>总是在抱怨。</h3><h3 id="没有充实你的思想。"><a href="#没有充实你的思想。" class="headerlink" title="没有充实你的思想。"></a>没有充实你的思想。</h3><h3 id="满脑子都是消极想法。"><a href="#满脑子都是消极想法。" class="headerlink" title="满脑子都是消极想法。"></a>满脑子都是消极想法。</h3><h3 id="觉得没有激情。"><a href="#觉得没有激情。" class="headerlink" title="觉得没有激情。"></a>觉得没有激情。</h3><h3 id="对未来没有计划。"><a href="#对未来没有计划。" class="headerlink" title="对未来没有计划。"></a>对未来没有计划。</h3><h3 id="花了太多时间和对你成长没有任何贡献的人在一起。"><a href="#花了太多时间和对你成长没有任何贡献的人在一起。" class="headerlink" title="花了太多时间和对你成长没有任何贡献的人在一起。"></a>花了太多时间和对你成长没有任何贡献的人在一起。</h3><h3 id="沉迷于手机。"><a href="#沉迷于手机。" class="headerlink" title="沉迷于手机。"></a>沉迷于手机。</h3><h3 id="把钱花在了毫无意义的事上。"><a href="#把钱花在了毫无意义的事上。" class="headerlink" title="把钱花在了毫无意义的事上。"></a>把钱花在了毫无意义的事上。</h3><h3 id="睡眠不足。"><a href="#睡眠不足。" class="headerlink" title="睡眠不足。"></a>睡眠不足。</h3><h3 id="没有照顾好自己的身体。"><a href="#没有照顾好自己的身体。" class="headerlink" title="没有照顾好自己的身体。"></a>没有照顾好自己的身体。</h3><h3 id="不愿意离开舒适区。"><a href="#不愿意离开舒适区。" class="headerlink" title="不愿意离开舒适区。"></a>不愿意离开舒适区。</h3><blockquote>
<p>把时间和感受留给自己、留给内心。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;人这一生，浪费了太多的时间在毫无意义的事情上，担忧、抱怨、埋怨、比较……&lt;/p&gt;
    
    </summary>
    
      <category term="随笔" scheme="https://roc-wong.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="人生感悟" scheme="https://roc-wong.github.io/tags/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F/"/>
    
  </entry>
  
  <entry>
    <title>国债逆回购</title>
    <link href="https://roc-wong.github.io/blog/2017/03/%E5%9B%BD%E5%80%BA%E9%80%86%E5%9B%9E%E8%B4%AD.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/国债逆回购.html</id>
    <published>2017-03-14T15:41:13.000Z</published>
    <updated>2018-01-11T02:03:42.538Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>Thinking will not overcome fear but action will.<br>空想终日惶恐，行动方可无惧。</p>
</blockquote>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>国债逆回购，就是将资金通过国债回购市场拆出，其实就是一种短期贷款，即你把钱借给别人，获得固定利息;而别人用国债作抵押，到期还本付息。<br>国债逆回购业务是能为投资者提高闲置资金增值能力的金融品种，它具有安全性高、流通性强、收益理想等特点，等同于国债。</p>
<a id="more"></a>
<h2 id="债券回购交易的实质是？"><a href="#债券回购交易的实质是？" class="headerlink" title="债券回购交易的实质是？"></a>债券回购交易的实质是？</h2><p>逆回购就是客户放弃一定时间内的资金使用权，在约定时间内按成交时确定的利率获取利息收入的一种投资品种。</p>
<hr>
<p>债券回购是指交易双方进行的以债券为权利质押的一种短期资金融通业务。资金融入方（正回购方）在将债券质押给资金融出方（逆回购方）以融入资金的同时，双方约定在将来某一日期由正回购方按约定回购利率计算的金额向逆回购方买回相等数量的同品种债券的交易行为。债券回购的最长期限为1年，利率由双方协商确定。</p>
<hr>
<p>这当中卖方的目的在于获得高于银行存款利息收入，而买方的目的在于获得资金的使用权。一笔回购交易涉及二次交易契约行为，即开始时的初始交易及回购期满时的回购交易。买卖双方的具体操作程序如下：债券回购交易申报中，融资方（债券持有者）按“买入”予以申报，融券方（资金持有者）按“卖出”予以申报。到期反向成交时，无须再行申报，由交易所电脑系统自动产生一条反向成交记录，登记结算机构据此进行资金和债券的清算与交割。</p>
<hr>
<p>国债逆回购本质上就是一个机构借钱给另一个机构（银行，保险等）。原本国家规定是机构间的拆借，不允许个人参与，不知道什么时候开始个人也可以参加了。什么时候机构需要临时借钱？目前来看一般是每季度末1－2天，银行需要借钱美化信贷指标；大蓝筹发行前一日。</p>
<h2 id="是否有风险？"><a href="#是否有风险？" class="headerlink" title="是否有风险？"></a>是否有风险？</h2><p>与股票交易不同，债券回购在成交之后不再承担价格波动的风险，收益率的高低在成交时确定。因此基本无价格波动风险。</p>
<h2 id="适合哪些人买？"><a href="#适合哪些人买？" class="headerlink" title="适合哪些人买？"></a>适合哪些人买？</h2><ol>
<li>有理财需求的人</li>
<li>钱放银行拿死利息的人</li>
<li>炒股的人</li>
<li>做生意的流动资金</li>
<li>家中的闲置资金</li>
</ol>
<h2 id="申报规则"><a href="#申报规则" class="headerlink" title="申报规则"></a>申报规则</h2><p>上海回购交易的申报数量必须为100手（10万资金）的整数倍，单笔数量不超过1万手（1000万资金）；回购价格为每百元资金到期的年收益率，最小变动单位为0.005元。</p>
<p>深圳回购交易的申报数量必须为1手的整数倍（1000元），回购价格为每百元资金到期的年收益率，最小变动单位为0.001元。</p>
<h2 id="回购买入的最佳时间是？"><a href="#回购买入的最佳时间是？" class="headerlink" title="回购买入的最佳时间是？"></a>回购买入的最佳时间是？</h2><ol>
<li>一般2点半之后临近收盘下单量往往会大增，从而导致价格走低。</li>
<li>一般星期四、月末、季度末、年末，市场资金面紧张价格通常很高。</li>
<li>重要节假日前两天，1日回购品种价格通常较高。</li>
<li>周五3日品种一般比1日品种总收益高。</li>
<li>如果其间有节假日，长期品种一般比短期品种总收益高。</li>
<li>单日内一般9：30-10：00、14：00-14：30收益率最高。</li>
</ol>
<blockquote>
<p>从以往的规律和盘面表现看，每日下午2时30分之前利率较高; 每周四相比平日利率要高;节假日前利率尤其高。</p>
</blockquote>
<h2 id="投资品种"><a href="#投资品种" class="headerlink" title="投资品种"></a>投资品种</h2><p>投资者要进行回购只能做沪市2040**、深1318***的新国债回购，共18个品种。</p>
<blockquote>
<p>上交所回购品种</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">品种</th>
<th style="text-align:right">代码</th>
<th style="text-align:center">简称</th>
<th style="text-align:center">到账时间</th>
<th style="text-align:center">可用时间</th>
<th style="text-align:center">手续费比例</th>
<th style="text-align:center">每10万元交易手续费(元)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1天国债回购</td>
<td style="text-align:right">204001</td>
<td style="text-align:center">GC001</td>
<td style="text-align:center">T + 1</td>
<td style="text-align:center">T + 2</td>
<td style="text-align:center">成交金额的0.001%</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">2天国债回购</td>
<td style="text-align:right">204002</td>
<td style="text-align:center">GC002</td>
<td style="text-align:center">T + 2</td>
<td style="text-align:center">T + 3</td>
<td style="text-align:center">成交金额的0.002%</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">3天国债回购</td>
<td style="text-align:right">204003</td>
<td style="text-align:center">GC003</td>
<td style="text-align:center">T + 3</td>
<td style="text-align:center">T + 4</td>
<td style="text-align:center">成交金额的0.003%</td>
<td style="text-align:center">3</td>
</tr>
<tr>
<td style="text-align:center">4天国债回购</td>
<td style="text-align:right">204004</td>
<td style="text-align:center">GC004</td>
<td style="text-align:center">T + 4</td>
<td style="text-align:center">T + 5</td>
<td style="text-align:center">成交金额的0.004%</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">7天国债回购</td>
<td style="text-align:right">204007</td>
<td style="text-align:center">GC007</td>
<td style="text-align:center">T + 7</td>
<td style="text-align:center">T + 8</td>
<td style="text-align:center">成交金额的0.005%</td>
<td style="text-align:center">5</td>
</tr>
<tr>
<td style="text-align:center">14天国债回购</td>
<td style="text-align:right">204014</td>
<td style="text-align:center">GC014</td>
<td style="text-align:center">T + 14</td>
<td style="text-align:center">T + 15</td>
<td style="text-align:center">成交金额的0.010%</td>
<td style="text-align:center">10</td>
</tr>
<tr>
<td style="text-align:center">28天国债回购</td>
<td style="text-align:right">204028</td>
<td style="text-align:center">GC028</td>
<td style="text-align:center">T + 28</td>
<td style="text-align:center">T + 29</td>
<td style="text-align:center">成交金额的0.020%</td>
<td style="text-align:center">20</td>
</tr>
<tr>
<td style="text-align:center">91天国债回购</td>
<td style="text-align:right">204091</td>
<td style="text-align:center">GC091</td>
<td style="text-align:center">T + 91</td>
<td style="text-align:center">T + 92</td>
<td style="text-align:center">成交金额的0.030%</td>
<td style="text-align:center">30</td>
</tr>
<tr>
<td style="text-align:center">182天国债回购</td>
<td style="text-align:right">204182</td>
<td style="text-align:center">GC182</td>
<td style="text-align:center">T + 182</td>
<td style="text-align:center">T + 183</td>
<td style="text-align:center">成交金额的0.030%</td>
<td style="text-align:center">30</td>
</tr>
</tbody>
</table>
<blockquote>
<p>深交所回购品种</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">品种</th>
<th style="text-align:right">代码</th>
<th style="text-align:center">简称</th>
<th style="text-align:center">到账时间</th>
<th style="text-align:center">可用时间</th>
<th style="text-align:center">手续费比例</th>
<th style="text-align:center">每10万元交易手续费(元)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1天国债回购</td>
<td style="text-align:right">131810</td>
<td style="text-align:center">R-00l</td>
<td style="text-align:center">T + 1</td>
<td style="text-align:center">T + 2</td>
<td style="text-align:center">成交金额的0.001%</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">2天国债回购</td>
<td style="text-align:right">1318ll</td>
<td style="text-align:center">R-002</td>
<td style="text-align:center">T + 2</td>
<td style="text-align:center">T + 3</td>
<td style="text-align:center">成交金额的0.002%</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">3天国债回购</td>
<td style="text-align:right">131800</td>
<td style="text-align:center">R-003</td>
<td style="text-align:center">T + 3</td>
<td style="text-align:center">T + 4</td>
<td style="text-align:center">成交金额的0.003%</td>
<td style="text-align:center">3</td>
</tr>
<tr>
<td style="text-align:center">4天国债回购</td>
<td style="text-align:right">131809</td>
<td style="text-align:center">R-004</td>
<td style="text-align:center">T + 4</td>
<td style="text-align:center">T + 5</td>
<td style="text-align:center">成交金额的0.004%</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">7天国债回购</td>
<td style="text-align:right">131801</td>
<td style="text-align:center">R-007</td>
<td style="text-align:center">T + 7</td>
<td style="text-align:center">T + 8</td>
<td style="text-align:center">成交金额的0.005%</td>
<td style="text-align:center">5</td>
</tr>
<tr>
<td style="text-align:center">14天国债回购</td>
<td style="text-align:right">131802</td>
<td style="text-align:center">R-014</td>
<td style="text-align:center">T + 14</td>
<td style="text-align:center">T + 15</td>
<td style="text-align:center">成交金额的0.010%</td>
<td style="text-align:center">10</td>
</tr>
<tr>
<td style="text-align:center">28天国债回购</td>
<td style="text-align:right">131803</td>
<td style="text-align:center">R-028</td>
<td style="text-align:center">T + 28</td>
<td style="text-align:center">T + 29</td>
<td style="text-align:center">成交金额的0.020%</td>
<td style="text-align:center">20</td>
</tr>
<tr>
<td style="text-align:center">91天国债回购</td>
<td style="text-align:right">131805</td>
<td style="text-align:center">R-091</td>
<td style="text-align:center">T + 91</td>
<td style="text-align:center">T + 92</td>
<td style="text-align:center">成交金额的0.030%</td>
<td style="text-align:center">30</td>
</tr>
<tr>
<td style="text-align:center">182天国债回购</td>
<td style="text-align:right">131806</td>
<td style="text-align:center">R-182</td>
<td style="text-align:center">T + 182</td>
<td style="text-align:center">T + 183</td>
<td style="text-align:center">成交金额的0.030%</td>
<td style="text-align:center">30</td>
</tr>
</tbody>
</table>
]]></content>
    
    <summary type="html">
    
      国债逆回购，就是将资金通过国债回购市场拆出，其实就是一种短期贷款，即你把钱借给别人，获得固定利息;而别人用国债作抵押，到期还本付息。
    
    </summary>
    
      <category term="证券" scheme="https://roc-wong.github.io/categories/%E8%AF%81%E5%88%B8/"/>
    
    
      <category term="证券" scheme="https://roc-wong.github.io/tags/%E8%AF%81%E5%88%B8/"/>
    
  </entry>
  
  <entry>
    <title>IntelliJ IDEA 插件推荐</title>
    <link href="https://roc-wong.github.io/blog/2017/03/IntelliJ-IDEA-plugins.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/IntelliJ-IDEA-plugins.html</id>
    <published>2017-03-10T15:01:54.000Z</published>
    <updated>2017-03-13T14:28:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>人不要等明天，因为没有人知道自己有没有明天。</p>
</blockquote>
<h1 id="推荐插件"><a href="#推荐插件" class="headerlink" title="推荐插件"></a>推荐插件</h1><p>本篇博客整理自IntelliJ IDEA 简体中文专题教程和日常开发归档：</p>
<blockquote>
<ul>
<li><a href="https://github.com/judasn/IntelliJ-IDEA-Tutorial/blob/newMaster/plugins-settings.md" target="_blank" rel="external">IntelliJ IDEA 简体中文专题教程</a></li>
</ul>
</blockquote>
<a id="more"></a>
<table>
<thead>
<tr>
<th style="text-align:left">插件名称</th>
<th style="text-align:left">插件介绍</th>
<th style="text-align:left">官网地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">IDE Features Trainer</td>
<td style="text-align:left">IntelliJ IDEA 官方出的学习辅助插件</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/8554?pr=idea" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/8554?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">Key promoter</td>
<td style="text-align:left">快捷键提示</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/4455?pr=idea" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/4455?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">Grep Console</td>
<td style="text-align:left">自定义设置控制台输出颜色</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/idea/plugin/7125-grep-console" target="_blank" rel="external">https://plugins.jetbrains.com/idea/plugin/7125-grep-console</a></td>
</tr>
<tr>
<td style="text-align:left">String Manipulation</td>
<td style="text-align:left">驼峰式命名和下划线命名交替变化</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/2162?pr=idea" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/2162?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">CheckStyle-IDEA</td>
<td style="text-align:left">代码规范检查</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/1065?pr=idea" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/1065?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">FindBugs-IDEA</td>
<td style="text-align:left">潜在 Bug 检查</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/3847?pr=idea" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/3847?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">MetricsReloaded</td>
<td style="text-align:left">代码复杂度检查</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/93?pr=idea" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/93?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">Statistic</td>
<td style="text-align:left">代码统计</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/4509?pr=idea" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/4509?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">JRebel Plugin</td>
<td style="text-align:left">热部署</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/?id=4441" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/?id=4441</a></td>
</tr>
<tr>
<td style="text-align:left">CodeGlance</td>
<td style="text-align:left">在编辑代码最右侧，显示一块代码小地图</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/7275?pr=idea" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/7275?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">GsonFormat</td>
<td style="text-align:left">把 JSON 字符串直接实例化成类</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/7654?pr=idea" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/7654?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">MultiMarkdown</td>
<td style="text-align:left">书写 Markdown 文章</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/7896?pr=idea" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/7896?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">Eclipse Code Formatter</td>
<td style="text-align:left">使用 Eclipse 的代码格式化风格，在一个团队中如果公司有规定格式化风格，这个可以使用。</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/6546?pr=idea" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/6546?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">Jindent-Source Code Formatter</td>
<td style="text-align:left">自定义类、方法、doc、变量注释模板</td>
<td style="text-align:left"><a href="http://plugins.jetbrains.com/plugin/2170?pr=idea" target="_blank" rel="external">http://plugins.jetbrains.com/plugin/2170?pr=idea</a></td>
</tr>
<tr>
<td style="text-align:left">ECTranslation</td>
<td style="text-align:left">翻译插件</td>
<td style="text-align:left"><a href="https://github.com/Skykai521/ECTranslation/releases" target="_blank" rel="external">https://github.com/Skykai521/ECTranslation/releases</a></td>
</tr>
<tr>
<td style="text-align:left">UpperLowerCapitalize</td>
<td style="text-align:left">大小写插件</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/183-upperlowercapitalize" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/183-upperlowercapitalize</a></td>
</tr>
<tr>
<td style="text-align:left">Maven Helper</td>
<td style="text-align:left">A must have plugin for working with Maven.</td>
<td style="text-align:left"><a href="https://plugins.jetbrains.com/plugin/7179-maven-helper" target="_blank" rel="external">https://plugins.jetbrains.com/plugin/7179-maven-helper</a></td>
</tr>
</tbody>
</table>
]]></content>
    
    <summary type="html">
    
      IntelliJ IDEA 插件
    
    </summary>
    
      <category term="IDE" scheme="https://roc-wong.github.io/categories/IDE/"/>
    
    
      <category term="IDE" scheme="https://roc-wong.github.io/tags/IDE/"/>
    
      <category term="IntelliJ IDEA" scheme="https://roc-wong.github.io/tags/IntelliJ-IDEA/"/>
    
  </entry>
  
  <entry>
    <title>IntelliJ IDEA For Mac 快捷键</title>
    <link href="https://roc-wong.github.io/blog/2017/03/IntelliJ-IDEA-key-map-for-Mac-OS.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/IntelliJ-IDEA-key-map-for-Mac-OS.html</id>
    <published>2017-03-10T14:58:22.000Z</published>
    <updated>2017-03-10T15:18:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>刘心武说：与其讨好别人，不如武装自己；与其逃避现实，不如笑对人生；与其听风听雨，不如昂首出击！</p>
</blockquote>
<p><strong>建议将 Mac 系统中与 IntelliJ IDEA 冲突的快捷键取消或更改，不建议改 IntelliJ IDEA 的默认快捷键。</strong></p>
<p>本篇博客整理自IntelliJ IDEA 简体中文专题教程和日常开发归档：</p>
<blockquote>
<ul>
<li><p><a href="https://github.com/judasn/IntelliJ-IDEA-Tutorial" target="_blank" rel="external">IntelliJ IDEA 简体中文专题教程</a></p>
</li>
<li><p>Windows / Linux：<a href="https://www.jetbrains.com/idea/docs/IntelliJIDEA_ReferenceCard.pdf" target="_blank" rel="external">https://www.jetbrains.com/idea/docs/IntelliJIDEA_ReferenceCard.pdf</a></p>
</li>
<li><p>Mac OS X：<a href="https://www.jetbrains.com/idea/docs/IntelliJIDEA_ReferenceCard_Mac.pdf" target="_blank" rel="external">https://www.jetbrains.com/idea/docs/IntelliJIDEA_ReferenceCard_Mac.pdf</a></p>
</li>
</ul>
</blockquote>
<a id="more"></a>
<p> 在 IntelliJ IDEA 中有两个 Mac 版本的快捷键，一个叫做：Mac OS X，一个叫做：Mac OS X 10.5+<br>。目前都是用：Mac OS X 10.5+ 有两套的原因：<a href="https://intellij-support.jetbrains.com/hc/en-us/community/posts/206159109-Updated-Mac-OS-X-keymap-Feedback-needed" target="_blank" rel="external">https://intellij-support.jetbrains.com/hc/en-us/community/posts/206159109-Updated-Mac-OS-X-keymap-Feedback-needed</a></p>
<h4 id="Mac键盘符号和修饰键说明"><a href="#Mac键盘符号和修饰键说明" class="headerlink" title="Mac键盘符号和修饰键说明"></a>Mac键盘符号和修饰键说明</h4><ul>
<li><code>⌘</code> Command</li>
<li><code>⇧</code> Shift</li>
<li><code>⌥</code> Option</li>
<li><code>⌃</code> Control</li>
<li><code>↩︎</code> Return/Enter</li>
<li><code>⌫</code> Delete</li>
<li><code>⌦</code> 向前删除键（Fn+Delete）</li>
<li><code>↑</code> 上箭头</li>
<li><code>↓</code> 下箭头</li>
<li><code>←</code> 左箭头</li>
<li><code>→</code> 右箭头</li>
<li><code>⇞</code> Page Up（Fn+↑）</li>
<li><code>⇟</code> Page Down（Fn+↓）</li>
<li><code>Home</code> Fn + ←</li>
<li><code>End</code> Fn + →</li>
<li><code>⇥</code> 右制表符（Tab键）</li>
<li><code>⇤</code> 左制表符（Shift+Tab）</li>
<li><code>⎋</code> Escape (Esc)</li>
</ul>
<h4 id="一、Editing（编辑）"><a href="#一、Editing（编辑）" class="headerlink" title="一、Editing（编辑）"></a>一、Editing（编辑）</h4><ul>
<li><code>Control + Space</code> 基本的代码补全（补全任何类、方法、变量）</li>
<li><code>Control + Shift + Space</code> 智能代码补全（过滤器方法列表和变量的预期类型）</li>
<li><code>Command + Shift + Enter</code> 自动结束代码，行末自动添加分号</li>
<li><code>Command + P</code> 显示方法的参数信息</li>
<li><code>Control + J</code> 快速查看文档</li>
<li><code>Shift + F1</code> 查看外部文档（在某些代码上会触发打开浏览器显示相关文档）</li>
<li><code>Command + 鼠标放在代码上</code> 显示代码简要信息</li>
<li><code>Command + F1</code> 在错误或警告处显示具体描述信息</li>
<li><code>Command + N, Control + Enter, Control + N</code> 生成代码（getter、setter、构造函数、hashCode/equals,toString）</li>
<li><code>Control + O</code> 覆盖方法（重写父类方法）</li>
<li><code>Control + I</code> 实现方法（实现接口中的方法）</li>
<li><code>Command + Option + T</code> 包围代码（使用if..else, try..catch, for, synchronized等包围选中的代码）</li>
<li><code>Command + /</code> 注释/取消注释与行注释</li>
<li><code>Command + Option + /</code> 注释/取消注释与块注释</li>
<li><code>Option + 方向键上</code> 连续选中代码块</li>
<li><code>Option + 方向键下</code> 减少当前选中的代码块</li>
<li><code>Control + Shift + Q</code> 显示上下文信息</li>
<li><code>Option + Enter</code> 显示意向动作和快速修复代码</li>
<li><code>Command + Option + L</code> 格式化代码</li>
<li><code>Control + Option + O</code> 优化import</li>
<li><code>Control + Option + I</code> 自动缩进线</li>
<li><code>Tab / Shift + Tab</code> 缩进代码 / 反缩进代码</li>
<li><code>Command + X</code> 剪切当前行或选定的块到剪贴板</li>
<li><code>Command + C</code> 复制当前行或选定的块到剪贴板</li>
<li><code>Command + V</code> 从剪贴板粘贴</li>
<li><code>Command + Shift + V</code> 从最近的缓冲区粘贴</li>
<li><code>Command + D</code> 复制当前行或选定的块</li>
<li><code>Command + Delete</code> 删除当前行或选定的块的行</li>
<li><code>Control + Shift + J</code> 智能的将代码拼接成一行</li>
<li><code>Command + Enter</code> 智能的拆分拼接的行</li>
<li><code>Shift + Enter</code> 开始新的一行</li>
<li><code>Command + Shift + U</code> 大小写切换</li>
<li><code>Command + Shift + ] / Command + Shift + [</code> 选择直到代码块结束/开始</li>
<li><code>Option + Fn + Delete</code> 删除到单词的末尾</li>
<li><code>Option + Delete</code> 删除到单词的开头</li>
<li><code>Command + 加号 / Command + 减号</code> 展开 / 折叠代码块</li>
<li><code>Command + Shift + 加号</code> 展开所以代码块</li>
<li><code>Command + Shift + 减号</code> 折叠所有代码块</li>
<li><code>Command + W</code> 关闭活动的编辑器选项卡</li>
</ul>
<h4 id="二、Search-Replace（查询-替换）"><a href="#二、Search-Replace（查询-替换）" class="headerlink" title="二、Search/Replace（查询/替换）"></a>二、Search/Replace（查询/替换）</h4><ul>
<li><code>Double Shift</code> 查询任何东西</li>
<li><code>Command + F</code> 文件内查找</li>
<li><code>Command + G</code> 查找模式下，向下查找</li>
<li><code>Command + Shift + G</code> 查找模式下，向上查找</li>
<li><code>Command + R</code> 文件内替换</li>
<li><code>Command + Shift + F</code> 全局查找（根据路径）</li>
<li><code>Command + Shift + R</code> 全局替换（根据路径）</li>
<li><code>Command + Shift + S</code> 查询结构（Ultimate Edition 版专用，需要在Keymap中设置）</li>
<li><code>Command + Shift + M</code> 替换结构（Ultimate Edition 版专用，需要在Keymap中设置）</li>
</ul>
<h4 id="三、Usage-Search（使用查询）"><a href="#三、Usage-Search（使用查询）" class="headerlink" title="三、Usage Search（使用查询）"></a>三、Usage Search（使用查询）</h4><ul>
<li><code>Option + F7 / Command + F7</code> 在文件中查找用法 / 在类中查找用法</li>
<li><code>Command + Shift + F7</code> 在文件中突出显示的用法</li>
<li><code>Command + Option + F7</code> 显示用法</li>
</ul>
<h4 id="四、Compile-and-Run（编译和运行）"><a href="#四、Compile-and-Run（编译和运行）" class="headerlink" title="四、Compile and Run（编译和运行）"></a>四、Compile and Run（编译和运行）</h4><ul>
<li><code>Command + F9</code> 编译Project</li>
<li><code>Command + Shift + F9</code> 编译选择的文件、包或模块</li>
<li><code>Control + Option + R</code> 弹出 Run 的可选择菜单</li>
<li><code>Control + Option + D</code> 弹出 Debug 的可选择菜单</li>
<li><code>Control + R</code> 运行</li>
<li><code>Control + D</code> 调试</li>
<li><code>Control + Shift + R, Control + Shift + D</code> 从编辑器运行上下文环境配置</li>
</ul>
<h4 id="五、Debugging（调试）"><a href="#五、Debugging（调试）" class="headerlink" title="五、Debugging（调试）"></a>五、Debugging（调试）</h4><ul>
<li><code>F8</code> 进入下一步，如果当前行断点是一个方法，则不进入当前方法体内</li>
<li><code>F7</code> 进入下一步，如果当前行断点是一个方法，则进入当前方法体内，如果该方法体还有方法，则不会进入该内嵌的方法中</li>
<li><code>Shift + F7</code> 智能步入，断点所在行上有多个方法调用，会弹出进入哪个方法</li>
<li><code>Shift + F8</code> 跳出</li>
<li><code>Option + F9</code> 运行到光标处，如果光标前有其他断点会进入到该断点</li>
<li><code>Option + F8</code> 计算表达式（可以更改变量值使其生效）</li>
<li><code>Command + Option + R</code> 恢复程序运行，如果该断点下面代码还有断点则停在下一个断点上</li>
<li><code>Command + F8</code> 切换断点（若光标当前行有断点则取消断点，没有则加上断点）</li>
<li><code>Command + Shift + F8</code> 查看断点信息</li>
</ul>
<h4 id="六、Navigation（导航）"><a href="#六、Navigation（导航）" class="headerlink" title="六、Navigation（导航）"></a>六、Navigation（导航）</h4><ul>
<li><code>Command + O</code> 查找类文件</li>
<li><code>Command + Shift + O</code> 查找所有类型文件、打开文件、打开目录，打开目录需要在输入的内容前面或后面加一个反斜杠<code>/</code></li>
<li><code>Command + Option + O</code> 前往指定的变量 / 方法</li>
<li><code>Control + 方向键左 / Control + 方向键右</code> 左右切换打开的编辑tab页</li>
<li><code>F12</code> 返回到前一个工具窗口</li>
<li><code>Esc</code> 从工具窗口进入代码文件窗口</li>
<li><code>Shift + Esc</code> 隐藏当前或最后一个活动的窗口，且光标进入代码文件窗口</li>
<li><code>Command + Shift + F4</code> 关闭活动run/messages/find/… tab</li>
<li><code>Command + L</code> 在当前文件跳转到某一行的指定处</li>
<li><code>Command + E</code> 显示最近打开的文件记录列表</li>
<li><code>Option + 方向键左 / Option + 方向键右</code> 光标跳转到当前单词 / 中文句的左 / 右侧开头位置</li>
<li><code>Command + Option + 方向键左 / Command + Option + 方向键右</code> 退回 / 前进到上一个操作的地方</li>
<li><code>Command + Shift + Delete</code> 跳转到最后一个编辑的地方</li>
<li><code>Option + F1</code> 显示当前文件选择目标弹出层，弹出层中有很多目标可以进行选择(如在代码编辑窗口可以选择显示该文件的Finder)</li>
<li><code>Command + B / Command +  鼠标点击</code> 进入光标所在的方法/变量的接口或是定义处</li>
<li><code>Command + Option + B</code> 跳转到实现处，在某个调用的方法名上使用会跳到具体的实现处，可以跳过接口</li>
<li><code>Option + Space, Command + Y</code> 快速打开光标所在方法、类的定义</li>
<li><code>Control + Shift + B</code> 跳转到类型声明处</li>
<li><code>Command + U</code> 前往当前光标所在方法的父类的方法 / 接口定义</li>
<li><code>Control + 方向键下 / Control + 方向键上</code> 当前光标跳转到当前文件的前一个/后一个方法名位置</li>
<li><code>Command + ] / Command + [</code> 移动光标到当前所在代码的花括号开始/结束位置</li>
<li><code>Command + F12</code> 弹出当前文件结构层，可以在弹出的层上直接输入进行筛选（可用于搜索类中的方法）</li>
<li><code>Control + H</code> 显示当前类的层次结构</li>
<li><code>Command + Shift + H</code> 显示方法层次结构</li>
<li><code>Control + Option + H</code> 显示调用层次结构</li>
<li><code>F2 / Shift + F2</code> 跳转到下一个/上一个突出错误或警告的位置</li>
<li><code>F4 / Command + 方向键下</code> 编辑/查看代码源</li>
<li><code>Option + Home</code> 显示到当前文件的导航条</li>
<li><code>F3</code>选中文件/文件夹/代码行，添加/取消书签</li>
<li><code>Option + F3</code> 选中文件/文件夹/代码行，使用助记符添加/取消书签</li>
<li><code>Control + 0...Control + 9</code> 定位到对应数值的书签位置</li>
<li><code>Command + F3</code> 显示所有书签</li>
</ul>
<h4 id="七、Refactoring（重构）"><a href="#七、Refactoring（重构）" class="headerlink" title="七、Refactoring（重构）"></a>七、Refactoring（重构）</h4><ul>
<li><code>F5</code> 复制文件到指定目录</li>
<li><code>F6</code> 移动文件到指定目录</li>
<li><code>Command + Delete</code> 在文件上为安全删除文件，弹出确认框</li>
<li><code>Shift + F6</code> 重命名文件</li>
<li><code>Command + F6</code> 更改签名</li>
<li><code>Command + Option + N</code> 一致性</li>
<li><code>Command + Option + M</code> 将选中的代码提取为方法</li>
<li><code>Command + Option + V</code> 提取变量</li>
<li><code>Command + Option + F</code> 提取字段</li>
<li><code>Command + Option + C</code> 提取常量</li>
<li><code>Command + Option + P</code> 提取参数</li>
</ul>
<h4 id="八、VCS-Local-History（版本控制-本地历史记录）"><a href="#八、VCS-Local-History（版本控制-本地历史记录）" class="headerlink" title="八、VCS/Local History（版本控制/本地历史记录）"></a>八、VCS/Local History（版本控制/本地历史记录）</h4><ul>
<li><code>Command + K</code> 提交代码到版本控制器</li>
<li><code>Command + T</code> 从版本控制器更新代码</li>
<li><code>Option + Shift + C</code> 查看最近的变更记录</li>
<li><code>Control + C</code> 快速弹出版本控制器操作面板</li>
</ul>
<h4 id="九、Live-Templates（动态代码模板）"><a href="#九、Live-Templates（动态代码模板）" class="headerlink" title="九、Live Templates（动态代码模板）"></a>九、Live Templates（动态代码模板）</h4><ul>
<li><code>Command + Option + J</code> 弹出模板选择窗口，将选定的代码使用动态模板包住</li>
<li><code>Command + J</code> 插入自定义动态代码模板</li>
</ul>
<h4 id="十、General（通用）"><a href="#十、General（通用）" class="headerlink" title="十、General（通用）"></a>十、General（通用）</h4><ul>
<li><code>Command + 1...Command + 9</code> 打开相应编号的工具窗口</li>
<li><code>Command + S</code> 保存所有</li>
<li><code>Command + Option + Y</code> 同步、刷新</li>
<li><code>Control + Command + F</code> 切换全屏模式</li>
<li><code>Command + Shift + F12</code> 切换最大化编辑器</li>
<li><code>Option + Shift + F</code> 添加到收藏夹</li>
<li><code>Option + Shift + I</code> 检查当前文件与当前的配置文件</li>
<li>Control + ` 快速切换当前的scheme（切换主题、代码样式等）</li>
<li><code>Command + ,</code> 打开IDEA系统设置</li>
<li><code>Command + ;</code> 打开项目结构对话框</li>
<li><code>Shift + Command + A</code> 查找动作（可设置相关选项）</li>
<li><code>Control + Shift + Tab</code> 编辑窗口标签和工具窗口之间切换（如果在切换的过程加按上delete，则是关闭对应选中的窗口）</li>
</ul>
<h4 id="十一、Other（一些官方文档上没有体现的快捷键）"><a href="#十一、Other（一些官方文档上没有体现的快捷键）" class="headerlink" title="十一、Other（一些官方文档上没有体现的快捷键）"></a>十一、Other（一些官方文档上没有体现的快捷键）</h4><ul>
<li><code>Command + Shift +8</code> 竖编辑模式</li>
</ul>
]]></content>
    
    <summary type="html">
    
      IntelliJ IDEA 本身的设计思维是提倡键盘优先于鼠标的，所以各种快捷键组合层出不穷，对于快捷键设置也有各种支持，对于其他 IDE 的快捷键组合也有预设模板进行支持。使用时，请干掉那些不相关软件的快捷键。
    
    </summary>
    
      <category term="IDE" scheme="https://roc-wong.github.io/categories/IDE/"/>
    
    
      <category term="IDE" scheme="https://roc-wong.github.io/tags/IDE/"/>
    
      <category term="IntelliJ IDEA" scheme="https://roc-wong.github.io/tags/IntelliJ-IDEA/"/>
    
  </entry>
  
  <entry>
    <title>IntelliJ IDEA 快键键</title>
    <link href="https://roc-wong.github.io/blog/2017/03/IntelliJ-IDEA-key-map.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/IntelliJ-IDEA-key-map.html</id>
    <published>2017-03-10T14:54:23.000Z</published>
    <updated>2017-03-10T15:18:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>直到有一天，当我发现我们都已经渐渐地老去的时候，我才感悟到人世间最珍贵的东西莫过于朋友之间的友谊!朋友，谢谢人生路上曾有你。</p>
</blockquote>
<h1 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h1><blockquote>
<p>非常感谢我的朋友<a href="http://www.caosh.me/" target="_blank" rel="external">曹同学</a>(PS:他的博客还在搬家阶段……)，一个极客程序猿，让我真正开始使用IntelliJ IDEA。</p>
</blockquote>
<p>IntelliJ IDEA 本身的设计思维是提倡键盘优先于鼠标的，所以各种快捷键组合层出不穷，对于快捷键设置也有各种支持，对于其他 IDE 的快捷键组合也有预设模板进行支持。使用时，请干掉那些不相关软件的快捷键。</p>
<a id="more"></a>
<p>本篇博客整理自IntelliJ IDEA 简体中文专题教程和日常开发归档：</p>
<blockquote>
<ul>
<li><p><a href="https://github.com/judasn/IntelliJ-IDEA-Tutorial" target="_blank" rel="external">IntelliJ IDEA 简体中文专题教程</a></p>
</li>
<li><p>Windows / Linux：<a href="https://www.jetbrains.com/idea/docs/IntelliJIDEA_ReferenceCard.pdf" target="_blank" rel="external">https://www.jetbrains.com/idea/docs/IntelliJIDEA_ReferenceCard.pdf</a></p>
</li>
<li><p>Mac OS X：<a href="https://www.jetbrains.com/idea/docs/IntelliJIDEA_ReferenceCard_Mac.pdf" target="_blank" rel="external">https://www.jetbrains.com/idea/docs/IntelliJIDEA_ReferenceCard_Mac.pdf</a></p>
</li>
</ul>
</blockquote>
<h2 id="Ctrl"><a href="#Ctrl" class="headerlink" title="Ctrl"></a>Ctrl</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Ctrl + F</td>
<td style="text-align:left">在当前文件进行文本查找 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + R</td>
<td style="text-align:left">在当前文件进行文本替换 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Z</td>
<td style="text-align:left">撤销 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Y</td>
<td style="text-align:left">删除光标所在行 或 删除选中的行 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + X</td>
<td style="text-align:left">剪切光标所在行 或 剪切选择内容</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + C</td>
<td style="text-align:left">复制光标所在行 或 复制选择内容</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + D</td>
<td style="text-align:left">复制光标所在行 或 复制选择内容，并把复制内容插入光标位置下面 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + W</td>
<td style="text-align:left">递进式选择代码块。可选中光标所在的单词或段落，连续按会在原有选中的基础上再扩展选中范围 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + E</td>
<td style="text-align:left">显示最近打开的文件记录列表 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + N</td>
<td style="text-align:left">根据输入的 <strong>类名</strong> 查找类文件 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + G</td>
<td style="text-align:left">在当前文件跳转到指定行处</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + J</td>
<td style="text-align:left">插入自定义动态代码模板 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + P</td>
<td style="text-align:left">方法参数提示显示 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Q</td>
<td style="text-align:left">光标所在的变量 / 类名 / 方法名等上面（也可以在提示补充的时候按），显示文档内容</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + U</td>
<td style="text-align:left">前往当前光标所在的方法的父类的方法 / 接口定义 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + B</td>
<td style="text-align:left">进入光标所在的方法/变量的接口或是定义处，等效于 <code>Ctrl + 左键单击</code>  <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + K</td>
<td style="text-align:left">版本控制提交项目，需要此项目有加入到版本控制才可用</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + T</td>
<td style="text-align:left">版本控制更新项目，需要此项目有加入到版本控制才可用</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + H</td>
<td style="text-align:left">显示当前类的层次结构</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + O</td>
<td style="text-align:left">选择可重写的方法</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + I</td>
<td style="text-align:left">选择可继承的方法</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + +</td>
<td style="text-align:left">展开代码</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + -</td>
<td style="text-align:left">折叠代码</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + /</td>
<td style="text-align:left">注释光标所在行代码，会根据当前不同文件类型使用不同的注释符号 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + [</td>
<td style="text-align:left">移动光标到当前所在代码的花括号开始位置</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + ]</td>
<td style="text-align:left">移动光标到当前所在代码的花括号结束位置</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + F1</td>
<td style="text-align:left">在光标所在的错误代码处显示错误信息 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + F3</td>
<td style="text-align:left">调转到所选中的词的下一个引用位置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + F4</td>
<td style="text-align:left">关闭当前编辑文件</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + F8</td>
<td style="text-align:left">在 Debug 模式下，设置光标当前行为断点，如果当前已经是断点则去掉断点</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + F9</td>
<td style="text-align:left">执行 Make Project 操作</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + F11</td>
<td style="text-align:left">选中文件 / 文件夹，使用助记符设定 / 取消书签 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + F12</td>
<td style="text-align:left">弹出当前文件结构层，可以在弹出的层上直接输入，进行筛选</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Tab</td>
<td style="text-align:left">编辑窗口切换，如果在切换的过程又加按上delete，则是关闭对应选中的窗口</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + End</td>
<td style="text-align:left">跳到文件尾</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Home</td>
<td style="text-align:left">跳到文件头</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Space</td>
<td style="text-align:left">基础代码补全，默认在 Windows 系统上被输入法占用，需要进行修改，建议修改为 <code>Ctrl + 逗号</code> <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Delete</td>
<td style="text-align:left">删除光标后面的单词或是中文句 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + BackSpace</td>
<td style="text-align:left">删除光标前面的单词或是中文句 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + 1,2,3…9</td>
<td style="text-align:left">定位到对应数值的书签位置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + 左键单击</td>
<td style="text-align:left">在打开的文件标题上，弹出该文件路径 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + 光标定位</td>
<td style="text-align:left">按 Ctrl 不要松开，会显示光标所在的类信息摘要</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + 左方向键</td>
<td style="text-align:left">光标跳转到当前单词 / 中文句的左侧开头位置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + 右方向键</td>
<td style="text-align:left">光标跳转到当前单词 / 中文句的右侧开头位置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + 前方向键</td>
<td style="text-align:left">等效于鼠标滚轮向前效果 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + 后方向键</td>
<td style="text-align:left">等效于鼠标滚轮向后效果 <code>（必备）</code></td>
</tr>
</tbody>
</table>
<h2 id="Alt"><a href="#Alt" class="headerlink" title="Alt"></a>Alt</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Alt + `</td>
<td style="text-align:left">显示版本控制常用操作菜单弹出层 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + Q</td>
<td style="text-align:left">弹出一个提示，显示当前类的声明 / 上下文信息</td>
</tr>
<tr>
<td style="text-align:left">Alt + F1</td>
<td style="text-align:left">显示当前文件选择目标弹出层，弹出层中有很多目标可以进行选择 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + F2</td>
<td style="text-align:left">对于前面页面，显示各类浏览器打开目标选择弹出层</td>
</tr>
<tr>
<td style="text-align:left">Alt + F3</td>
<td style="text-align:left">选中文本，逐个往下查找相同文本，并高亮显示</td>
</tr>
<tr>
<td style="text-align:left">Alt + F7</td>
<td style="text-align:left">查找光标所在的方法 / 变量 / 类被调用的地方</td>
</tr>
<tr>
<td style="text-align:left">Alt + F8</td>
<td style="text-align:left">在 Debug 的状态下，选中对象，弹出可输入计算表达式调试框，查看该输入内容的调试结果</td>
</tr>
<tr>
<td style="text-align:left">Alt + Home</td>
<td style="text-align:left">定位 / 显示到当前文件的 <code>Navigation Bar</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + Enter</td>
<td style="text-align:left">IntelliJ IDEA 根据光标所在问题，提供快速修复选择，光标放在的位置不同提示的结果也不同 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + Insert</td>
<td style="text-align:left">代码自动生成，如生成对象的 set / get 方法，构造函数，toString() 等 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + 左方向键</td>
<td style="text-align:left">切换当前已打开的窗口中的子视图，比如Debug窗口中有Output、Debugger等子视图，用此快捷键就可以在子视图中切换 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + 右方向键</td>
<td style="text-align:left">按切换当前已打开的窗口中的子视图，比如Debug窗口中有Output、Debugger等子视图，用此快捷键就可以在子视图中切换 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + 前方向键</td>
<td style="text-align:left">当前光标跳转到当前文件的前一个方法名位置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + 后方向键</td>
<td style="text-align:left">当前光标跳转到当前文件的后一个方法名位置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + 1,2,3…9</td>
<td style="text-align:left">显示对应数值的选项卡，其中 1 是 Project 用得最多 <code>（必备）</code></td>
</tr>
</tbody>
</table>
<h2 id="Shift"><a href="#Shift" class="headerlink" title="Shift"></a>Shift</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Shift + F1</td>
<td style="text-align:left">如果有外部文档可以连接外部文档</td>
</tr>
<tr>
<td style="text-align:left">Shift + F2</td>
<td style="text-align:left">跳转到上一个高亮错误 或 警告位置</td>
</tr>
<tr>
<td style="text-align:left">Shift + F3</td>
<td style="text-align:left">在查找模式下，查找匹配上一个</td>
</tr>
<tr>
<td style="text-align:left">Shift + F4</td>
<td style="text-align:left">对当前打开的文件，使用新Windows窗口打开，旧窗口保留</td>
</tr>
<tr>
<td style="text-align:left">Shift + F6</td>
<td style="text-align:left">对文件 / 文件夹 重命名</td>
</tr>
<tr>
<td style="text-align:left">Shift + F7</td>
<td style="text-align:left">在 Debug 模式下，智能步入。断点所在行上有多个方法调用，会弹出进入哪个方法</td>
</tr>
<tr>
<td style="text-align:left">Shift + F8</td>
<td style="text-align:left">在 Debug 模式下，跳出，表现出来的效果跟 <code>F9</code> 一样</td>
</tr>
<tr>
<td style="text-align:left">Shift + F9</td>
<td style="text-align:left">等效于点击工具栏的 <code>Debug</code> 按钮</td>
</tr>
<tr>
<td style="text-align:left">Shift + F10</td>
<td style="text-align:left">等效于点击工具栏的 <code>Run</code> 按钮</td>
</tr>
<tr>
<td style="text-align:left">Shift + F11</td>
<td style="text-align:left">弹出书签显示层 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Shift + Tab</td>
<td style="text-align:left">取消缩进 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Shift + ESC</td>
<td style="text-align:left">隐藏当前 或 最后一个激活的工具窗口</td>
</tr>
<tr>
<td style="text-align:left">Shift + End</td>
<td style="text-align:left">选中光标到当前行尾位置</td>
</tr>
<tr>
<td style="text-align:left">Shift + Home</td>
<td style="text-align:left">选中光标到当前行头位置</td>
</tr>
<tr>
<td style="text-align:left">Shift + Enter</td>
<td style="text-align:left">开始新一行。光标所在行下空出一行，光标定位到新行位置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Shift + 左键单击</td>
<td style="text-align:left">在打开的文件名上按此快捷键，可以关闭当前打开文件 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Shift + 滚轮前后滚动</td>
<td style="text-align:left">当前文件的横向滚动轴滚动 <code>（必备）</code></td>
</tr>
</tbody>
</table>
<h2 id="Ctrl-Alt"><a href="#Ctrl-Alt" class="headerlink" title="Ctrl + Alt"></a>Ctrl + Alt</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Ctrl + Alt + L</td>
<td style="text-align:left">格式化代码，可以对当前文件和整个包目录使用 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + O</td>
<td style="text-align:left">优化导入的类，可以对当前文件和整个包目录使用 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + I</td>
<td style="text-align:left">光标所在行 或 选中部分进行自动代码缩进，有点类似格式化</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + T</td>
<td style="text-align:left">对选中的代码弹出环绕选项弹出层 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + J</td>
<td style="text-align:left">弹出模板选择窗口，将选定的代码加入动态模板中</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + H</td>
<td style="text-align:left">调用层次</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + B</td>
<td style="text-align:left">在某个调用的方法名上使用会跳到具体的实现处，可以跳过接口</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + V</td>
<td style="text-align:left">快速引进变量</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + Y</td>
<td style="text-align:left">同步、刷新</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + S</td>
<td style="text-align:left">打开 IntelliJ IDEA 系统设置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + F7</td>
<td style="text-align:left">显示使用的地方。寻找被该类或是变量被调用的地方，用弹出框的方式找出来</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + F11</td>
<td style="text-align:left">切换全屏模式</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + Enter</td>
<td style="text-align:left">光标所在行上空出一行，光标定位到新行 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + Home</td>
<td style="text-align:left">弹出跟当前文件有关联的文件弹出层</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + Space</td>
<td style="text-align:left">类名自动完成</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + 左方向键</td>
<td style="text-align:left">退回到上一个操作的地方 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + 右方向键</td>
<td style="text-align:left">前进到上一个操作的地方 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + 前方向键</td>
<td style="text-align:left">在查找模式下，跳到上个查找的文件</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Alt + 后方向键</td>
<td style="text-align:left">在查找模式下，跳到下个查找的文件</td>
</tr>
</tbody>
</table>
<h2 id="Ctrl-Shift"><a href="#Ctrl-Shift" class="headerlink" title="Ctrl + Shift"></a>Ctrl + Shift</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Ctrl + Shift + F</td>
<td style="text-align:left">根据输入内容查找整个项目 或 指定目录内文件 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + R</td>
<td style="text-align:left">根据输入内容替换对应内容，范围为整个项目 或 指定目录内文件 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + J</td>
<td style="text-align:left">自动将下一行合并到当前行末尾 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + Z</td>
<td style="text-align:left">取消撤销 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + W</td>
<td style="text-align:left">递进式取消选择代码块。可选中光标所在的单词或段落，连续按会在原有选中的基础上再扩展取消选中范围 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + N</td>
<td style="text-align:left">通过文件名定位 / 打开文件 / 目录，打开目录需要在输入的内容后面多加一个正斜杠 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + U</td>
<td style="text-align:left">对选中的代码进行大 / 小写轮流转换 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + T</td>
<td style="text-align:left">对当前类生成单元测试类，如果已经存在的单元测试类则可以进行选择 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + C</td>
<td style="text-align:left">复制当前文件磁盘路径到剪贴板 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + V</td>
<td style="text-align:left">弹出缓存的最近拷贝的内容管理器弹出层</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + E</td>
<td style="text-align:left">显示最近修改的文件列表的弹出层</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + H</td>
<td style="text-align:left">显示方法层次结构</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + B</td>
<td style="text-align:left">跳转到类型声明处 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + I</td>
<td style="text-align:left">快速查看光标所在的方法 或 类的定义</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + A</td>
<td style="text-align:left">查找动作 / 设置</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + /</td>
<td style="text-align:left">代码块注释 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + [</td>
<td style="text-align:left">选中从光标所在位置到它的顶部中括号位置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + ]</td>
<td style="text-align:left">选中从光标所在位置到它的底部中括号位置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + +</td>
<td style="text-align:left">展开所有代码 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + -</td>
<td style="text-align:left">折叠所有代码 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + F7</td>
<td style="text-align:left">高亮显示所有该选中文本，按Esc高亮消失 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + F8</td>
<td style="text-align:left">在 Debug 模式下，指定断点进入条件</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + F9</td>
<td style="text-align:left">编译选中的文件 / 包 / Module</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + F12</td>
<td style="text-align:left">编辑器最大化 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + Space</td>
<td style="text-align:left">智能代码提示</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + Enter</td>
<td style="text-align:left">自动结束代码，行末自动添加分号 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + Backspace</td>
<td style="text-align:left">退回到上次修改的地方 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + 1,2,3…9</td>
<td style="text-align:left">快速添加指定数值的书签 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + 左键单击</td>
<td style="text-align:left">把光标放在某个类变量上，按此快捷键可以直接定位到该类中 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + 左方向键</td>
<td style="text-align:left">在代码文件上，光标跳转到当前单词 / 中文句的左侧开头位置，同时选中该单词 / 中文句 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + 右方向键</td>
<td style="text-align:left">在代码文件上，光标跳转到当前单词 / 中文句的右侧开头位置，同时选中该单词 / 中文句 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + 前方向键</td>
<td style="text-align:left">光标放在方法名上，将方法移动到上一个方法前面，调整方法排序 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + 后方向键</td>
<td style="text-align:left">光标放在方法名上，将方法移动到下一个方法前面，调整方法排序 <code>（必备）</code></td>
</tr>
</tbody>
</table>
<h2 id="Alt-Shift"><a href="#Alt-Shift" class="headerlink" title="Alt + Shift"></a>Alt + Shift</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Alt + Shift + N</td>
<td style="text-align:left">选择 / 添加 task <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + Shift + F</td>
<td style="text-align:left">显示添加到收藏夹弹出层 / 添加到收藏夹</td>
</tr>
<tr>
<td style="text-align:left">Alt + Shift + C</td>
<td style="text-align:left">查看最近操作项目的变化情况列表</td>
</tr>
<tr>
<td style="text-align:left">Alt + Shift + I</td>
<td style="text-align:left">查看项目当前文件</td>
</tr>
<tr>
<td style="text-align:left">Alt + Shift + F7</td>
<td style="text-align:left">在 Debug 模式下，下一步，进入当前方法体内，如果方法体还有方法，则会进入该内嵌的方法中，依此循环进入</td>
</tr>
<tr>
<td style="text-align:left">Alt + Shift + F9</td>
<td style="text-align:left">弹出 <code>Debug</code>  的可选择菜单</td>
</tr>
<tr>
<td style="text-align:left">Alt + Shift + F10</td>
<td style="text-align:left">弹出 <code>Run</code>  的可选择菜单</td>
</tr>
<tr>
<td style="text-align:left">Alt + Shift + 左键双击</td>
<td style="text-align:left">选择被双击的单词 / 中文句，按住不放，可以同时选择其他单词 / 中文句 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + Shift + 前方向键</td>
<td style="text-align:left">移动光标所在行向上移动 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Alt + Shift + 后方向键</td>
<td style="text-align:left">移动光标所在行向下移动 <code>（必备）</code></td>
</tr>
</tbody>
</table>
<h2 id="Ctrl-Shift-Alt"><a href="#Ctrl-Shift-Alt" class="headerlink" title="Ctrl + Shift + Alt"></a>Ctrl + Shift + Alt</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Ctrl + Shift + Alt + V</td>
<td style="text-align:left">无格式黏贴 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + Alt + N</td>
<td style="text-align:left">前往指定的变量 / 方法</td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + Alt + S</td>
<td style="text-align:left">打开当前项目设置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Ctrl + Shift + Alt + C</td>
<td style="text-align:left">复制参考信息</td>
</tr>
</tbody>
</table>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">F2</td>
<td style="text-align:left">跳转到下一个高亮错误 或 警告位置 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">F3</td>
<td style="text-align:left">在查找模式下，定位到下一个匹配处</td>
</tr>
<tr>
<td style="text-align:left">F4</td>
<td style="text-align:left">编辑源 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">F7</td>
<td style="text-align:left">在 Debug 模式下，进入下一步，如果当前行断点是一个方法，则进入当前方法体内，如果该方法体还有方法，则不会进入该内嵌的方法中</td>
</tr>
<tr>
<td style="text-align:left">F8</td>
<td style="text-align:left">在 Debug 模式下，进入下一步，如果当前行断点是一个方法，则不进入当前方法体内</td>
</tr>
<tr>
<td style="text-align:left">F9</td>
<td style="text-align:left">在 Debug 模式下，恢复程序运行，但是如果该断点下面代码还有断点则停在下一个断点上</td>
</tr>
<tr>
<td style="text-align:left">F11</td>
<td style="text-align:left">添加书签 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">F12</td>
<td style="text-align:left">回到前一个工具窗口 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">Tab</td>
<td style="text-align:left">缩进 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">ESC</td>
<td style="text-align:left">从工具窗口进入代码文件窗口 <code>（必备）</code></td>
</tr>
<tr>
<td style="text-align:left">连按两次Shift</td>
<td style="text-align:left">弹出 <code>Search Everywhere</code> 弹出层</td>
</tr>
</tbody>
</table>
<h2 id="UpperLowerCapitalize-大小写插件快捷键"><a href="#UpperLowerCapitalize-大小写插件快捷键" class="headerlink" title="UpperLowerCapitalize 大小写插件快捷键"></a>UpperLowerCapitalize 大小写插件快捷键</h2><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Alt+P</td>
<td style="text-align:left">to uppercase</td>
</tr>
<tr>
<td style="text-align:left">Alt+L</td>
<td style="text-align:left">to lowercase</td>
</tr>
<tr>
<td style="text-align:left">Alt+C</td>
<td style="text-align:left">首字母大写</td>
</tr>
</tbody>
</table>
]]></content>
    
    <summary type="html">
    
      IntelliJ IDEA 本身的设计思维是提倡键盘优先于鼠标的，所以各种快捷键组合层出不穷，对于快捷键设置也有各种支持，对于其他 IDE 的快捷键组合也有预设模板进行支持。使用时，请干掉那些不相关软件的快捷键。
    
    </summary>
    
      <category term="IDE" scheme="https://roc-wong.github.io/categories/IDE/"/>
    
    
      <category term="IDE" scheme="https://roc-wong.github.io/tags/IDE/"/>
    
      <category term="IntelliJ IDEA" scheme="https://roc-wong.github.io/tags/IntelliJ-IDEA/"/>
    
  </entry>
  
  <entry>
    <title>markdown-syntax</title>
    <link href="https://roc-wong.github.io/blog/2017/03/markdown-syntax.html"/>
    <id>https://roc-wong.github.io/blog/2017/03/markdown-syntax.html</id>
    <published>2017-03-08T15:39:02.000Z</published>
    <updated>2017-03-10T15:18:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>NOTE:</strong> This is Simplelified  Chinese Edition Document of Markdown Syntax. If you are seeking for English Edition Document. Please refer to <a href="http://daringfireball.net/projects/markdown/syntax" target="_blank" rel="external">Markdown: Syntax</a>.</p>
<p><strong>声明：</strong> 这份文档派生(fork)于<a href="http://markdown.tw/" target="_blank" rel="external">繁体中文版</a>，在此基础上进行了繁体转简体工作，并进行了适当的润色。此文档用 Markdown 语法编写，你可以到这里<a href="http://gitcafe.com/riku/Markdown-Syntax-CN/blob/master/syntax.md" target="_blank" rel="external">查看它的源文件</a>。「繁体中文版的原始文件可以<a href="https://github.com/othree/markdown-syntax-zhtw/blob/master/syntax.md" target="_blank" rel="external">查看这里</a> 。」–By @<a href="http://twitter.com/riku" target="_blank" rel="external">riku</a> / 本项目托管于 <a href="http://gitcafe.com/riku/Markdown-Syntax-CN" target="_blank" rel="external">GitCafe</a></p>
<a id="more"></a>
<p><strong>注：</strong> 本项目同时也托管于 <a href="https://github.com/riku/Markdown-Syntax-CN" target="_blank" rel="external">Github</a> 上，请通过 fork＋pull request 方式来帮忙改进本项目。</p>
<h1 id="Markdown-语法说明-简体中文版-点击查看快速入门"><a href="#Markdown-语法说明-简体中文版-点击查看快速入门" class="headerlink" title="Markdown 语法说明 (简体中文版) / (点击查看快速入门)"></a>Markdown 语法说明 (简体中文版) / (<a href="./markdown-basics.html">点击查看快速入门</a>)</h1><ul>
<li><a href="#overview">概述</a><ul>
<li><a href="#philosophy">宗旨</a></li>
<li><a href="#html">兼容 HTML</a></li>
<li><a href="#autoescape">特殊字符自动转换</a></li>
</ul>
</li>
<li><a href="#block">区块元素</a><ul>
<li><a href="#p">段落和换行</a></li>
<li><a href="#header">标题</a></li>
<li><a href="#blockquote">区块引用</a></li>
<li><a href="#list">列表</a></li>
<li><a href="#precode">代码区块</a></li>
<li><a href="#hr">分隔线</a></li>
</ul>
</li>
<li><a href="#span">区段元素</a><ul>
<li><a href="#link">链接</a></li>
<li><a href="#em">强调</a></li>
<li><a href="#code">代码</a></li>
<li><a href="#img">图片</a></li>
</ul>
</li>
<li><a href="#misc">其它</a><ul>
<li><a href="#backslash">反斜杠</a></li>
<li><a href="#autolink">自动链接</a></li>
</ul>
</li>
<li><a href="#acknowledgement">感谢</a></li>
</ul>
<hr>
<h2 id="overview">概述</h2>

<h3 id="philosophy">宗旨</h3>

<p>Markdown 的目标是实现「易读易写」。</p>
<p>可读性，无论如何，都是最重要的。一份使用 Markdown 格式撰写的文件应该可以直接以纯文本发布，并且看起来不会像是由许多标签或是格式指令所构成。Markdown 语法受到一些既有 text-to-HTML 格式的影响，包括 <a href="http://docutils.sourceforge.net/mirror/setext.html" target="_blank" rel="external">Setext</a>、<a href="http://www.aaronsw.com/2002/atx/" target="_blank" rel="external">atx</a>、<a href="http://textism.com/tools/textile/" target="_blank" rel="external">Textile</a>、<a href="http://docutils.sourceforge.net/rst.html" target="_blank" rel="external">reStructuredText</a>、<a href="http://www.triptico.com/software/grutatxt.html" target="_blank" rel="external">Grutatext</a> 和 <a href="http://ettext.taint.org/doc/" target="_blank" rel="external">EtText</a>，而最大灵感来源其实是纯文本电子邮件的格式。</p>
<p>总之， Markdown 的语法全由一些符号所组成，这些符号经过精挑细选，其作用一目了然。比如：在文字两旁加上星号，看起来就像*强调*。Markdown 的列表看起来，嗯，就是列表。Markdown 的区块引用看起来就真的像是引用一段文字，就像你曾在电子邮件中见过的那样。</p>
<h3 id="html">兼容 HTML</h3>

<p>Markdown 语法的目标是：成为一种适用于网络的<em>书写</em>语言。</p>
<p>Markdown 不是想要取代 HTML，甚至也没有要和它相近，它的语法种类很少，只对应 HTML 标记的一小部分。Markdown 的构想<em>不是</em>要使得 HTML 文档更容易书写。在我看来， HTML 已经很容易写了。Markdown 的理念是，能让文档更容易读、写和随意改。HTML 是一种<em>发布</em>的格式，Markdown 是一种<em>书写</em>的格式。就这样，Markdown 的格式语法只涵盖纯文本可以涵盖的范围。</p>
<p>不在 Markdown 涵盖范围之内的标签，都可以直接在文档里面用 HTML 撰写。不需要额外标注这是 HTML 或是 Markdown；只要直接加标签就可以了。</p>
<p>要制约的只有一些 HTML 区块元素――比如 <code>&lt;div&gt;</code>、<code>&lt;table&gt;</code>、<code>&lt;pre&gt;</code>、<code>&lt;p&gt;</code> 等标签，必须在前后加上空行与其它内容区隔开，还要求它们的开始标签与结尾标签不能用制表符或空格来缩进。Markdown 的生成器有足够智能，不会在 HTML 区块标签外加上不必要的 <code>&lt;p&gt;</code> 标签。</p>
<p>例子如下，在 Markdown 文件里加上一段 HTML 表格：</p>
<pre><code>这是一个普通段落。

&lt;table&gt;
    &lt;tr&gt;
        &lt;td&gt;Foo&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;

这是另一个普通段落。
</code></pre><p>请注意，在 HTML 区块标签间的 Markdown 格式语法将不会被处理。比如，你在 HTML 区块内使用 Markdown 样式的<code>*强调*</code>会没有效果。</p>
<p>HTML 的区段（行内）标签如 <code>&lt;span&gt;</code>、<code>&lt;cite&gt;</code>、<code>&lt;del&gt;</code> 可以在 Markdown 的段落、列表或是标题里随意使用。依照个人习惯，甚至可以不用 Markdown 格式，而直接采用 HTML 标签来格式化。举例说明：如果比较喜欢 HTML 的 <code>&lt;a&gt;</code> 或 <code>&lt;img&gt;</code> 标签，可以直接使用这些标签，而不用 Markdown 提供的链接或是图像标签语法。</p>
<p>和处在 HTML 区块标签间不同，Markdown 语法在 HTML 区段标签间是有效的。</p>
<h3 id="autoescape">特殊字符自动转换</h3>

<p>在 HTML 文件中，有两个字符需要特殊处理： <code>&lt;</code> 和 <code>&amp;</code> 。 <code>&lt;</code> 符号用于起始标签，<code>&amp;</code> 符号则用于标记 HTML 实体，如果你只是想要显示这些字符的原型，你必须要使用实体的形式，像是 <code>&amp;lt;</code> 和 <code>&amp;amp;</code>。</p>
<p><code>&amp;</code> 字符尤其让网络文档编写者受折磨，如果你要打「<code>AT&amp;T</code>」 ，你必须要写成「<code>AT&amp;amp;T</code>」。而网址中的 <code>&amp;</code> 字符也要转换。比如你要链接到：</p>
<pre><code>http://images.google.com/images?num=30&amp;q=larry+bird
</code></pre><p>你必须要把网址转换写为：</p>
<pre><code>http://images.google.com/images?num=30&amp;amp;q=larry+bird
</code></pre><p>才能放到链接标签的 <code>href</code> 属性里。不用说也知道这很容易忽略，这也可能是 HTML 标准检验所检查到的错误中，数量最多的。</p>
<p>Markdown 让你可以自然地书写字符，需要转换的由它来处理好了。如果你使用的 <code>&amp;</code> 字符是 HTML 字符实体的一部分，它会保留原状，否则它会被转换成 <code>&amp;amp</code>;。</p>
<p>所以你如果要在文档中插入一个版权符号 <code>©</code>，你可以这样写：</p>
<pre><code>&amp;copy;
</code></pre><p>Markdown 会保留它不动。而若你写：</p>
<pre><code>AT&amp;T
</code></pre><p>Markdown 就会将它转为：</p>
<pre><code>AT&amp;amp;T
</code></pre><p>类似的状况也会发生在 <code>&lt;</code> 符号上，因为 Markdown 允许 <a href="#html">兼容 HTML</a> ，如果你是把 <code>&lt;</code> 符号作为 HTML 标签的定界符使用，那 Markdown 也不会对它做任何转换，但是如果你写：</p>
<pre><code>4 &lt; 5
</code></pre><p>Markdown 将会把它转换为：</p>
<pre><code>4 &amp;lt; 5
</code></pre><p>不过需要注意的是，code 范围内，不论是行内还是区块， <code>&lt;</code> 和 <code>&amp;</code> 两个符号都<em>一定</em>会被转换成 HTML 实体，这项特性让你可以很容易地用 Markdown 写 HTML code （和 HTML 相对而言， HTML 语法中，你要把所有的 <code>&lt;</code> 和 <code>&amp;</code> 都转换为 HTML 实体，才能在 HTML 文件里面写出 HTML code。）</p>
<hr>
<h2 id="block">区块元素</h2>


<h3 id="p">段落和换行</h3>

<p>一个 Markdown 段落是由一个或多个连续的文本行组成，它的前后要有一个以上的空行（空行的定义是显示上看起来像是空的，便会被视为空行。比方说，若某一行只包含空格和制表符，则该行也会被视为空行）。普通段落不该用空格或制表符来缩进。</p>
<p>「由一个或多个连续的文本行组成」这句话其实暗示了 Markdown 允许段落内的强迫换行（插入换行符），这个特性和其他大部分的 text-to-HTML 格式不一样（包括 Movable Type 的「Convert Line Breaks」选项），其它的格式会把每个换行符都转成 <code>&lt;br /&gt;</code> 标签。</p>
<p>如果你<em>确实</em>想要依赖 Markdown 来插入 <code>&lt;br /&gt;</code> 标签的话，在插入处先按入两个以上的空格然后回车。</p>
<p>的确，需要多费点事（多加空格）来产生 <code>&lt;br /&gt;</code> ，但是简单地「每个换行都转换为 <code>&lt;br /&gt;</code>」的方法在 Markdown 中并不适合， Markdown 中 email 式的 <a href="#blockquote">区块引用</a> 和多段落的 <a href="#list">列表</a> 在使用换行来排版的时候，不但更好用，还更方便阅读。</p>
<h3 id="header">标题</h3>

<p>Markdown 支持两种标题的语法，类 <a href="http://docutils.sourceforge.net/mirror/setext.html" target="_blank" rel="external">Setext</a> 和类 <a href="http://www.aaronsw.com/2002/atx/" target="_blank" rel="external">atx</a> 形式。</p>
<p>类 Setext 形式是用底线的形式，利用 <code>=</code> （最高阶标题）和 <code>-</code> （第二阶标题），例如：</p>
<pre><code>This is an H1
=============

This is an H2
-------------
</code></pre><p>任何数量的 <code>=</code> 和 <code>-</code> 都可以有效果。</p>
<p>类 Atx 形式则是在行首插入 1 到 6 个 <code>#</code> ，对应到标题 1 到 6 阶，例如：</p>
<pre><code># 这是 H1

## 这是 H2

###### 这是 H6
</code></pre><p>你可以选择性地「闭合」类 atx 样式的标题，这纯粹只是美观用的，若是觉得这样看起来比较舒适，你就可以在行尾加上 <code>#</code>，而行尾的 <code>#</code> 数量也不用和开头一样（行首的井字符数量决定标题的阶数）：</p>
<pre><code># 这是 H1 #

## 这是 H2 ##

### 这是 H3 ######
</code></pre><h3 id="blockquote">区块引用 Blockquotes</h3>

<p>Markdown 标记区块引用是使用类似 email 中用 <code>&gt;</code> 的引用方式。如果你还熟悉在 email 信件中的引言部分，你就知道怎么在 Markdown 文件中建立一个区块引用，那会看起来像是你自己先断好行，然后在每行的最前面加上 <code>&gt;</code> ：</p>
<pre><code>&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,
&gt; consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.
&gt; Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.
&gt;
&gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse
&gt; id sem consectetuer libero luctus adipiscing.
</code></pre><p>Markdown 也允许你偷懒只在整个段落的第一行最前面加上 <code>&gt;</code> ：</p>
<pre><code>&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,
consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.
Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.

&gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse
id sem consectetuer libero luctus adipiscing.
</code></pre><p>区块引用可以嵌套（例如：引用内的引用），只要根据层次加上不同数量的 <code>&gt;</code> ：</p>
<pre><code>&gt; This is the first level of quoting.
&gt;
&gt; &gt; This is nested blockquote.
&gt;
&gt; Back to the first level.
</code></pre><p>引用的区块内也可以使用其他的 Markdown 语法，包括标题、列表、代码区块等：</p>
<pre><code>&gt; ## 这是一个标题。
&gt;
&gt; 1.   这是第一行列表项。
&gt; 2.   这是第二行列表项。
&gt;
&gt; 给出一些例子代码：
&gt;
&gt;     return shell_exec(&quot;echo $input | $markdown_script&quot;);
</code></pre><p>任何像样的文本编辑器都能轻松地建立 email 型的引用。例如在 BBEdit 中，你可以选取文字后然后从选单中选择<em>增加引用阶层</em>。</p>
<h3 id="list">列表</h3>

<p>Markdown 支持有序列表和无序列表。</p>
<p>无序列表使用星号、加号或是减号作为列表标记：</p>
<pre><code>*   Red
*   Green
*   Blue
</code></pre><p>等同于：</p>
<pre><code>+   Red
+   Green
+   Blue
</code></pre><p>也等同于：</p>
<pre><code>-   Red
-   Green
-   Blue
</code></pre><p>有序列表则使用数字接着一个英文句点：</p>
<pre><code>1.  Bird
2.  McHale
3.  Parish
</code></pre><p>很重要的一点是，你在列表标记上使用的数字并不会影响输出的 HTML 结果，上面的列表所产生的 HTML 标记为：</p>
<pre><code>&lt;ol&gt;
&lt;li&gt;Bird&lt;/li&gt;
&lt;li&gt;McHale&lt;/li&gt;
&lt;li&gt;Parish&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>如果你的列表标记写成：</p>
<pre><code>1.  Bird
1.  McHale
1.  Parish
</code></pre><p>或甚至是：</p>
<pre><code>3. Bird
1. McHale
8. Parish
</code></pre><p>你都会得到完全相同的 HTML 输出。重点在于，你可以让 Markdown 文件的列表数字和输出的结果相同，或是你懒一点，你可以完全不用在意数字的正确性。</p>
<p>如果你使用懒惰的写法，建议第一个项目最好还是从 1. 开始，因为 Markdown 未来可能会支持有序列表的 start 属性。</p>
<p>列表项目标记通常是放在最左边，但是其实也可以缩进，最多 3 个空格，项目标记后面则一定要接着至少一个空格或制表符。</p>
<p>要让列表看起来更漂亮，你可以把内容用固定的缩进整理好：</p>
<pre><code>*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.
    Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,
    viverra nec, fringilla in, laoreet vitae, risus.
*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.
    Suspendisse id sem consectetuer libero luctus adipiscing.
</code></pre><p>但是如果你懒，那也行：</p>
<pre><code>*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.
Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,
viverra nec, fringilla in, laoreet vitae, risus.
*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.
Suspendisse id sem consectetuer libero luctus adipiscing.
</code></pre><p>如果列表项目间用空行分开，在输出 HTML 时 Markdown 就会将项目内容用 <code>&lt;p&gt;</code><br>标签包起来，举例来说：</p>
<pre><code>*   Bird
*   Magic
</code></pre><p>会被转换为：</p>
<pre><code>&lt;ul&gt;
&lt;li&gt;Bird&lt;/li&gt;
&lt;li&gt;Magic&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>但是这个：</p>
<pre><code>*   Bird

*   Magic
</code></pre><p>会被转换为：</p>
<pre><code>&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Bird&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Magic&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>列表项目可以包含多个段落，每个项目下的段落都必须缩进 4 个空格或是 1 个制表符：</p>
<pre><code>1.  This is a list item with two paragraphs. Lorem ipsum dolor
    sit amet, consectetuer adipiscing elit. Aliquam hendrerit
    mi posuere lectus.

    Vestibulum enim wisi, viverra nec, fringilla in, laoreet
    vitae, risus. Donec sit amet nisl. Aliquam semper ipsum
    sit amet velit.

2.  Suspendisse id sem consectetuer libero luctus adipiscing.
</code></pre><p>如果你每行都有缩进，看起来会看好很多，当然，再次地，如果你很懒惰，Markdown 也允许：</p>
<pre><code>*   This is a list item with two paragraphs.

    This is the second paragraph in the list item. You&apos;re
only required to indent the first line. Lorem ipsum dolor
sit amet, consectetuer adipiscing elit.

*   Another item in the same list.
</code></pre><p>如果要在列表项目内放进引用，那 <code>&gt;</code> 就需要缩进：</p>
<pre><code>*   A list item with a blockquote:

    &gt; This is a blockquote
    &gt; inside a list item.
</code></pre><p>如果要放代码区块的话，该区块就需要缩进<em>两次</em>，也就是 8 个空格或是 2 个制表符：</p>
<pre><code>*   一列表项包含一个列表区块：

        &lt;代码写在这&gt;
</code></pre><p>当然，项目列表很可能会不小心产生，像是下面这样的写法：</p>
<pre><code>1986. What a great season.
</code></pre><p>换句话说，也就是在行首出现<em>数字-句点-空白</em>，要避免这样的状况，你可以在句点前面加上反斜杠。</p>
<pre><code>1986\. What a great season.
</code></pre><h3 id="precode">代码区块</h3>

<p>和程序相关的写作或是标签语言原始码通常会有已经排版好的代码区块，通常这些区块我们并不希望它以一般段落文件的方式去排版，而是照原来的样子显示，Markdown 会用 <code>&lt;pre&gt;</code> 和 <code>&lt;code&gt;</code> 标签来把代码区块包起来。</p>
<p>要在 Markdown 中建立代码区块很简单，只要简单地缩进 4 个空格或是 1 个制表符就可以，例如，下面的输入：</p>
<pre><code>这是一个普通段落：

    这是一个代码区块。
</code></pre><p>Markdown 会转换成：</p>
<pre><code>&lt;p&gt;这是一个普通段落：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;这是一个代码区块。
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>这个每行一阶的缩进（4 个空格或是 1 个制表符），都会被移除，例如：</p>
<pre><code>Here is an example of AppleScript:

    tell application &quot;Foo&quot;
        beep
    end tell
</code></pre><p>会被转换为：</p>
<pre><code>&lt;p&gt;Here is an example of AppleScript:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tell application &quot;Foo&quot;
    beep
end tell
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>一个代码区块会一直持续到没有缩进的那一行（或是文件结尾）。</p>
<p>在代码区块里面， <code>&amp;</code> 、 <code>&lt;</code> 和 <code>&gt;</code> 会自动转成 HTML 实体，这样的方式让你非常容易使用 Markdown 插入范例用的 HTML 原始码，只需要复制贴上，再加上缩进就可以了，剩下的 Markdown 都会帮你处理，例如：</p>
<pre><code>&lt;div class=&quot;footer&quot;&gt;
    &amp;copy; 2004 Foo Corporation
&lt;/div&gt;
</code></pre><p>会被转换为：</p>
<pre><code>&lt;pre&gt;&lt;code&gt;&amp;lt;div class=&quot;footer&quot;&amp;gt;
    &amp;amp;copy; 2004 Foo Corporation
&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>代码区块中，一般的 Markdown 语法不会被转换，像是星号便只是星号，这表示你可以很容易地以 Markdown 语法撰写 Markdown 语法相关的文件。</p>
<h3 id="hr">分隔线</h3>

<p>你可以在一行中用三个以上的星号、减号、底线来建立一个分隔线，行内不能有其他东西。你也可以在星号或是减号中间插入空格。下面每种写法都可以建立分隔线：</p>
<pre><code>* * *

***

*****

- - -

---------------------------------------
</code></pre><hr>
<h2 id="span">区段元素</h2>

<h3 id="link">链接</h3>

<p>Markdown 支持两种形式的链接语法： <em>行内式</em>和<em>参考式</em>两种形式。</p>
<p>不管是哪一种，链接文字都是用 [方括号] 来标记。</p>
<p>要建立一个<em>行内式</em>的链接，只要在方块括号后面紧接着圆括号并插入网址链接即可，如果你还想要加上链接的 title 文字，只要在网址后面，用双引号把 title 文字包起来即可，例如：</p>
<pre><code>This is [an example](http://example.com/ &quot;Title&quot;) inline link.

[This link](http://example.net/) has no title attribute.
</code></pre><p>会产生：</p>
<pre><code>&lt;p&gt;This is &lt;a href=&quot;http://example.com/&quot; title=&quot;Title&quot;&gt;
an example&lt;/a&gt; inline link.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://example.net/&quot;&gt;This link&lt;/a&gt; has no
title attribute.&lt;/p&gt;
</code></pre><p>如果你是要链接到同样主机的资源，你可以使用相对路径：</p>
<pre><code>See my [About](/about/) page for details.   
</code></pre><p><em>参考式</em>的链接是在链接文字的括号后面再接上另一个方括号，而在第二个方括号里面要填入用以辨识链接的标记：</p>
<pre><code>This is [an example][id] reference-style link.
</code></pre><p>你也可以选择性地在两个方括号中间加上一个空格：</p>
<pre><code>This is [an example] [id] reference-style link.
</code></pre><p>接着，在文件的任意处，你可以把这个标记的链接内容定义出来：</p>
<pre><code>[id]: http://example.com/  &quot;Optional Title Here&quot;
</code></pre><p>链接内容定义的形式为：</p>
<ul>
<li>方括号（前面可以选择性地加上至多三个空格来缩进），里面输入链接文字</li>
<li>接着一个冒号</li>
<li>接着一个以上的空格或制表符</li>
<li>接着链接的网址</li>
<li>选择性地接着 title 内容，可以用单引号、双引号或是括弧包着</li>
</ul>
<p>下面这三种链接的定义都是相同：</p>
<pre><code>[foo]: http://example.com/  &quot;Optional Title Here&quot;
[foo]: http://example.com/  &apos;Optional Title Here&apos;
[foo]: http://example.com/  (Optional Title Here)
</code></pre><p><strong>请注意：</strong>有一个已知的问题是 Markdown.pl 1.0.1 会忽略单引号包起来的链接 title。</p>
<p>链接网址也可以用方括号包起来：</p>
<pre><code>[id]: &lt;http://example.com/&gt;  &quot;Optional Title Here&quot;
</code></pre><p>你也可以把 title 属性放到下一行，也可以加一些缩进，若网址太长的话，这样会比较好看：</p>
<pre><code>[id]: http://example.com/longish/path/to/resource/here
    &quot;Optional Title Here&quot;
</code></pre><p>网址定义只有在产生链接的时候用到，并不会直接出现在文件之中。</p>
<p>链接辨别标签可以有字母、数字、空白和标点符号，但是并<em>不</em>区分大小写，因此下面两个链接是一样的：</p>
<pre><code>[link text][a]
[link text][A]
</code></pre><p><em>隐式链接标记</em>功能让你可以省略指定链接标记，这种情形下，链接标记会视为等同于链接文字，要用隐式链接标记只要在链接文字后面加上一个空的方括号，如果你要让 “Google” 链接到 google.com，你可以简化成：</p>
<pre><code>[Google][]
</code></pre><p>然后定义链接内容：</p>
<pre><code>[Google]: http://google.com/
</code></pre><p>由于链接文字可能包含空白，所以这种简化型的标记内也许包含多个单词：</p>
<pre><code>Visit [Daring Fireball][] for more information.
</code></pre><p>然后接着定义链接：</p>
<pre><code>[Daring Fireball]: http://daringfireball.net/
</code></pre><p>链接的定义可以放在文件中的任何一个地方，我比较偏好直接放在链接出现段落的后面，你也可以把它放在文件最后面，就像是注解一样。</p>
<p>下面是一个参考式链接的范例：</p>
<pre><code>I get 10 times more traffic from [Google] [1] than from
[Yahoo] [2] or [MSN] [3].

  [1]: http://google.com/        &quot;Google&quot;
  [2]: http://search.yahoo.com/  &quot;Yahoo Search&quot;
  [3]: http://search.msn.com/    &quot;MSN Search&quot;
</code></pre><p>如果改成用链接名称的方式写：</p>
<pre><code>I get 10 times more traffic from [Google][] than from
[Yahoo][] or [MSN][].

  [google]: http://google.com/        &quot;Google&quot;
  [yahoo]:  http://search.yahoo.com/  &quot;Yahoo Search&quot;
  [msn]:    http://search.msn.com/    &quot;MSN Search&quot;
</code></pre><p>上面两种写法都会产生下面的 HTML。</p>
<pre><code>&lt;p&gt;I get 10 times more traffic from &lt;a href=&quot;http://google.com/&quot;
title=&quot;Google&quot;&gt;Google&lt;/a&gt; than from
&lt;a href=&quot;http://search.yahoo.com/&quot; title=&quot;Yahoo Search&quot;&gt;Yahoo&lt;/a&gt;
or &lt;a href=&quot;http://search.msn.com/&quot; title=&quot;MSN Search&quot;&gt;MSN&lt;/a&gt;.&lt;/p&gt;
</code></pre><p>下面是用行内式写的同样一段内容的 Markdown 文件，提供作为比较之用：</p>
<pre><code>I get 10 times more traffic from [Google](http://google.com/ &quot;Google&quot;)
than from [Yahoo](http://search.yahoo.com/ &quot;Yahoo Search&quot;) or
[MSN](http://search.msn.com/ &quot;MSN Search&quot;).
</code></pre><p>参考式的链接其实重点不在于它比较好写，而是它比较好读，比较一下上面的范例，使用参考式的文章本身只有 81 个字符，但是用行内形式的却会增加到 176 个字元，如果是用纯 HTML 格式来写，会有 234 个字元，在 HTML 格式中，标签比文本还要多。</p>
<p>使用 Markdown 的参考式链接，可以让文件更像是浏览器最后产生的结果，让你可以把一些标记相关的元数据移到段落文字之外，你就可以增加链接而不让文章的阅读感觉被打断。</p>
<h3 id="em">强调</h3>

<p>Markdown 使用星号（<code>*</code>）和底线（<code>_</code>）作为标记强调字词的符号，被 <code>*</code> 或 <code>_</code> 包围的字词会被转成用 <code>&lt;em&gt;</code> 标签包围，用两个 <code>*</code> 或 <code>_</code> 包起来的话，则会被转成 <code>&lt;strong&gt;</code>，例如：</p>
<pre><code>*single asterisks*

_single underscores_

**double asterisks**

__double underscores__
</code></pre><p>会转成：</p>
<pre><code>&lt;em&gt;single asterisks&lt;/em&gt;

&lt;em&gt;single underscores&lt;/em&gt;

&lt;strong&gt;double asterisks&lt;/strong&gt;

&lt;strong&gt;double underscores&lt;/strong&gt;
</code></pre><p>你可以随便用你喜欢的样式，唯一的限制是，你用什么符号开启标签，就要用什么符号结束。</p>
<p>强调也可以直接插在文字中间：</p>
<pre><code>un*frigging*believable
</code></pre><p>但是<strong>如果你的 <code>*</code> 和 <code>_</code> 两边都有空白的话，它们就只会被当成普通的符号</strong>。</p>
<p>如果要在文字前后直接插入普通的星号或底线，你可以用反斜线：</p>
<pre><code>\*this text is surrounded by literal asterisks\*
</code></pre><h3 id="code">代码</h3>

<p>如果要标记一小段行内代码，你可以用反引号把它包起来（<code>` </code>），例如：</p>
<pre><code>Use the `printf()` function.
</code></pre><p>会产生：</p>
<pre><code>&lt;p&gt;Use the &lt;code&gt;printf()&lt;/code&gt; function.&lt;/p&gt;
</code></pre><p>如果要在代码区段内插入反引号，你可以用多个反引号来开启和结束代码区段：</p>
<pre><code>``There is a literal backtick (`) here.``
</code></pre><p>这段语法会产生：</p>
<pre><code>&lt;p&gt;&lt;code&gt;There is a literal backtick (`) here.&lt;/code&gt;&lt;/p&gt;
</code></pre><p>代码区段的起始和结束端都可以放入一个空白，起始端后面一个，结束端前面一个，这样你就可以在区段的一开始就插入反引号：</p>
<pre><code>A single backtick in a code span: `` ` ``

A backtick-delimited string in a code span: `` `foo` ``
</code></pre><p>会产生：</p>
<pre><code>&lt;p&gt;A single backtick in a code span: &lt;code&gt;`&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;A backtick-delimited string in a code span: &lt;code&gt;`foo`&lt;/code&gt;&lt;/p&gt;
</code></pre><p>在代码区段内，<code>&amp;</code> 和方括号<strong>都</strong>会被自动地转成 HTML 实体，这使得插入 HTML 原始码变得很容易，Markdown 会把下面这段：</p>
<pre><code>Please don&apos;t use any `&lt;blink&gt;` tags.
</code></pre><p>转为：</p>
<pre><code>&lt;p&gt;Please don&apos;t use any &lt;code&gt;&amp;lt;blink&amp;gt;&lt;/code&gt; tags.&lt;/p&gt;
</code></pre><p>你也可以这样写：</p>
<pre><code>`&amp;#8212;` is the decimal-encoded equivalent of `&amp;mdash;`.
</code></pre><p>以产生：</p>
<pre><code>&lt;p&gt;&lt;code&gt;&amp;amp;#8212;&lt;/code&gt; is the decimal-encoded
equivalent of &lt;code&gt;&amp;amp;mdash;&lt;/code&gt;.&lt;/p&gt;
</code></pre><h3 id="img">图片</h3>

<p>很明显地，要在纯文字应用中设计一个「自然」的语法来插入图片是有一定难度的。</p>
<p>Markdown 使用一种和链接很相似的语法来标记图片，同样也允许两种样式： <em>行内式</em>和<em>参考式</em>。</p>
<p>行内式的图片语法看起来像是：</p>
<pre><code>![Alt text](/path/to/img.jpg)

![Alt text](/path/to/img.jpg &quot;Optional title&quot;)
</code></pre><p>详细叙述如下：</p>
<ul>
<li>一个惊叹号 <code>!</code></li>
<li>接着一个方括号，里面放上图片的替代文字</li>
<li>接着一个普通括号，里面放上图片的网址，最后还可以用引号包住并加上<br>选择性的 ‘title’ 文字。</li>
</ul>
<p>参考式的图片语法则长得像这样：</p>
<pre><code>![Alt text][id]
</code></pre><p>「id」是图片参考的名称，图片参考的定义方式则和连结参考一样：</p>
<pre><code>[id]: url/to/image  &quot;Optional title attribute&quot;
</code></pre><p>到目前为止， Markdown 还没有办法指定图片的宽高，如果你需要的话，你可以使用普通的 <code>&lt;img&gt;</code> 标签。</p>
<hr>
<h2 id="misc">其它</h2>

<h3 id="autolink">自动链接</h3>

<p>Markdown 支持以比较简短的自动链接形式来处理网址和电子邮件信箱，只要是用方括号包起来， Markdown 就会自动把它转成链接。一般网址的链接文字就和链接地址一样，例如：</p>
<pre><code>&lt;http://example.com/&gt;
</code></pre><p>Markdown 会转为：</p>
<pre><code>&lt;a href=&quot;http://example.com/&quot;&gt;http://example.com/&lt;/a&gt;
</code></pre><p>邮址的自动链接也很类似，只是 Markdown 会先做一个编码转换的过程，把文字字符转成 16 进位码的 HTML 实体，这样的格式可以糊弄一些不好的邮址收集机器人，例如：</p>
<pre><code>&lt;address@example.com&gt;
</code></pre><p>Markdown 会转成：</p>
<pre><code>&lt;a href=&quot;&amp;#x6D;&amp;#x61;i&amp;#x6C;&amp;#x74;&amp;#x6F;:&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;
&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;
&amp;#109;&quot;&gt;&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;
&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&lt;/a&gt;
</code></pre><p>在浏览器里面，这段字串（其实是 <code>&lt;a href=&quot;mailto:address@example.com&quot;&gt;address@example.com&lt;/a&gt;</code>）会变成一个可以点击的「address@example.com」链接。</p>
<p>（这种作法虽然可以糊弄不少的机器人，但并不能全部挡下来，不过总比什么都不做好些。不管怎样，公开你的信箱终究会引来广告信件的。）</p>
<h3 id="backslash">反斜杠</h3>

<p>Markdown 可以利用反斜杠来插入一些在语法中有其它意义的符号，例如：如果你想要用星号加在文字旁边的方式来做出强调效果（但不用 <code>&lt;em&gt;</code> 标签），你可以在星号的前面加上反斜杠：</p>
<pre><code>\*literal asterisks\*
</code></pre><p>Markdown 支持以下这些符号前面加上反斜杠来帮助插入普通的符号：</p>
<pre><code>\   反斜线
`   反引号
*   星号
_   底线
{}  花括号
[]  方括号
()  括弧
#   井字号
+   加号
-   减号
.   英文句点
!   惊叹号
</code></pre><h2 id="acknowledgement">感谢</h2>

<p>感谢 <a href="https://twitter.com/#!/leafy7382" target="_blank" rel="external">leafy7382</a> 协助翻译，<a href="http://iamhlb.com/" target="_blank" rel="external">hlb</a>、<a href="http://twitter.com/randylien" target="_blank" rel="external">Randylien</a> 帮忙润稿，<a href="https://twitter.com/#!/ethantw" target="_blank" rel="external">ethantw</a> 的<a href="http://ethantw.net/projects/han/" target="_blank" rel="external">汉字标准格式・CSS Reset</a>， <a href="http://kidwm.net/" target="_blank" rel="external">WM</a> 回报文字错误。</p>
<p>感谢 <a href="https://github.com/fenprace" target="_blank" rel="external">fenprace</a>，<a href="https://github.com/addv" target="_blank" rel="external">addv</a>。</p>
]]></content>
    
    <summary type="html">
    
      markdown语法, markdown syntax
    
    </summary>
    
      <category term="markdown" scheme="https://roc-wong.github.io/categories/markdown/"/>
    
    
      <category term="markdown" scheme="https://roc-wong.github.io/tags/markdown/"/>
    
  </entry>
  
</feed>
